import{R as C,_ as f,j as e,a as P}from"./index-7g7M7zZQ.js";import{o as j,i as E,L as A}from"./react-USjiWj3t.js";import{u as R,F as q,T as v,L as I,c as O,a as x,b as M,S as z,P as D,d as V}from"./useErrorFocusField-gDAfnMzI.js";import{u as T}from"./useCustomQuery-XoKYMSEw.js";const L=d=>{const i=d.split(","),t=i[0].indexOf("base64")>=0?atob(i[1]):decodeURI(i[1]),o=i[0].split(":")[1].split(";")[0],m=new Uint8Array(t==null?void 0:t.length);for(let r=0;r<(t==null?void 0:t.length);r++)m[r]=t==null?void 0:t.charCodeAt(r);return new Blob([m],{type:o})},B=async d=>new Promise(t=>{C.imageFileResizer(d,500,500,"JPEG",60,0,o=>{t(o)},"base64")}).then(t=>L(t)),$=O().shape({mobile:x().required("Mobile is required").min(10).max(10)});function U({next:d,data:i,setData:t}){const{mutateAsync:o}=T({}),{sendOtp:m}=P,r=R({enableReinitialize:!0,initialValues:{mobile:i.mobileNo||""},validationSchema:$,onSubmit:async(u,{})=>{var c,s,g;try{const a=await o({api:m,data:{mobileNo:u.mobile,type:"Register"}});((c=a==null?void 0:a.data)==null?void 0:c.status)===!0?(d({...i,mobileNo:u.mobile}),f.success((s=a==null?void 0:a.data)==null?void 0:s.message)):f.error((g=a==null?void 0:a.data)==null?void 0:g.message)}catch(a){console.log(a)}}});return e.jsx(e.Fragment,{children:e.jsxs(q,{formik:r,children:[e.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Citizen Registration"}),e.jsx(v,{label:"Mobile",name:"mobile",type:"number",formik:r,onInput:u=>{u.target.value=Math.max(0,parseInt(u.target.value)).toString().slice(0,10)}}),e.jsx("div",{className:"text-center ",children:e.jsx(I,{type:"submit",loading:r==null?void 0:r.isSubmitting,disabled:r==null?void 0:r.isSubmitting,children:"Send OTP"})})]})})}const G=d=>{const[i,t]=j.useState(0),[o,m]=j.useState(!1);j.useEffect(()=>{let s;return o?(t(60*d),s=setInterval(()=>{t(g=>g-1)},1e3)):clearInterval(s),()=>clearInterval(s)},[o]),j.useEffect(()=>{i<0&&o&&(m(!1),t(0))},[i,o]);const r=()=>m(s=>!s),u=String(i%60).padStart(2,0);return{minutes:String(Math.floor(i/60)).padStart(2,0),seconds:u,togglerTimer:r,runTimer:o}},_=G,J=O().shape({otp:x().required("OTP is required").min(6).max(6)});function H({next:d,data:i,setData:t,prev:o}){const{mutateAsync:m}=T({}),{verifyOtp:r}=P,{minutes:u,seconds:c,togglerTimer:s,runTimer:g}=_(.1),a=R({enableReinitialize:!0,initialValues:{mobile:i.mobileNo||"",otp:i.otp||""},validationSchema:J,onSubmit:async(h,{})=>{var w,N,n;try{const l=await m({api:r,data:{mobileNo:h.mobile,otp:h.otp}});((w=l==null?void 0:l.data)==null?void 0:w.status)===!0?(d({...i,otp:h.otp}),f.success((N=l==null?void 0:l.data)==null?void 0:N.message)):f.error((n=l==null?void 0:l.data)==null?void 0:n.message)}catch(l){f.error("Invalid OTP")}}});j.useEffect(()=>(s(),()=>{s()}),[]);const F=async()=>{try{const h=await m({api:P.sendOtp,data:{mobileNo:a==null?void 0:a.values.mobile,type:"Register"}});s(),t({mobileNo:a==null?void 0:a.values.mobile,otp:""}),a.setFieldValue("otp","")}catch(h){console.log(h)}};return e.jsx(e.Fragment,{children:e.jsxs(q,{formik:a,children:[e.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number +91-",i==null?void 0:i.mobileNo," ",e.jsx("span",{className:"text-sm text-blue-700",onClick:()=>o({mobile:a==null?void 0:a.values.mobile,otp:""}),children:"Edit"})]}),e.jsx(v,{label:"Verify OTP",name:"otp",type:"number",formik:a,onInput:h=>{h.target.value=Math.max(0,parseInt(h.target.value)).toString().slice(0,6)}}),e.jsx("div",{className:"text-center",children:e.jsx(I,{type:"submit",loading:a==null?void 0:a.isSubmitting,disabled:a==null?void 0:a.isSubmitting,children:"Verify OTP"})}),e.jsxs("div",{className:"text-center mt-4 text-sm",children:["Didn't receive the code?"," ",g?e.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",u,":",c]}):e.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:F,children:"Resend OTP"})]})]})})}const K=O().shape({mobile:x().required("Mobile is required").min(10).max(10),name:x().required("Name is required"),email:x().required("Email is required").email("Invalid Email"),gender:x().required("Gender is required"),password:x().required("Password is required"),confirmPassword:x().required("Confirm Password is required").oneOf([V("password"),null],"Passwords must match"),dob:x().required("Date of Birth is required")});function Q({next:d,prev:i,data:t,setData:o}){var w,N;const{AutoFocusErrorField:m}=M(),{register:r}=P,u=E(),c=T({}),s=R({enableReinitialize:!0,initialValues:{otp:t.otp||"",mobile:t.mobileNo||"",name:t.name||"",email:t.email||"",gender:(t==null?void 0:t.gender)||"",password:t.password||"",confirmPassword:t.confirmPassword||"",dob:t.dob||"",photo:t.photo||""},validationSchema:K,onSubmit:async n=>{var l,S,y;try{const p=new FormData;p.append("mobile",n.mobile),p.append("name",n.name),p.append("email",n.email),p.append("dob",n.dob),p.append("gender",n.gender),p.append("password",n.password),p.append("confirmPassword",n.confirmPassword),p.append("photo",n.photo);const b=await c.mutateAsync({api:r,data:p});((l=b==null?void 0:b.data)==null?void 0:l.status)===!0?(f.success((S=b==null?void 0:b.data)==null?void 0:S.message),u("/juidco-app/auth/login")):f.error((y=b==null?void 0:b.data)==null?void 0:y.message)}catch(p){f.error("Something went wrong")}}}),g=async n=>{var y,p;const l=await B(n.target.files[0]),S=new File([l],(p=(y=n==null?void 0:n.target)==null?void 0:y.files[0])==null?void 0:p.name,{type:"image/*"});s.setFieldValue("photo",S)},{isSubmitting:a,submitCount:F,errors:h}=s;return j.useEffect(()=>{m({formik:s})},[h,F,a]),e.jsx(e.Fragment,{children:e.jsxs(q,{formik:s,children:[e.jsx("h2",{className:" font-semibold mb-4",children:"Citizen Registration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(v,{label:"Name",name:"name",type:"text",formik:s})}),e.jsx("div",{children:e.jsx(v,{label:"Mobile",name:"mobile",type:"number",formik:s,onInput:n=>{n.target.value=Math.max(0,parseInt(n.target.value)).toString().slice(0,10)}})}),e.jsx("div",{className:"-mt-2",children:e.jsx(v,{label:"Email",name:"email",type:"email",formik:s})}),e.jsxs("div",{className:"-mt-2",children:[e.jsx(v,{label:"Upload Photo",accept:"image/*",name:"photo",type:"file",onChange:n=>g(n)}),e.jsx("small",{className:"text-red-500 -mt-6",children:((w=s==null?void 0:s.errors)==null?void 0:w.photo)&&((N=s==null?void 0:s.touched)==null?void 0:N.photo)})]}),e.jsx("div",{className:"-mt-2",children:e.jsx(v,{label:"Date of Birth",name:"dob",type:"date",formik:s})}),e.jsx("div",{className:"-mt-2",children:e.jsxs(z,{formik:s,name:"gender",label:"Gender",children:[e.jsx("option",{value:"",children:"Select Date"}),["Male","Female","Other"].map((n,l)=>e.jsx("option",{value:n,children:n},l))]})}),e.jsx("div",{className:"-mt-2",children:e.jsx(D,{label:"Password",name:"password",formik:s})}),e.jsx("div",{className:"-mt-2",children:e.jsx(D,{label:"confirm password",name:"confirmPassword",formik:s})})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsx(I,{type:"submit",loading:c.isLoading,disabled:c.isLoading,children:"Register Now"})})]})})}function k(){const[d,i]=j.useState(0),[t,o]=j.useState({otp:"",mobileNo:"",name:"",email:"",password:"",dob:"",gender:"",aadhar:"",isSpeciallyAbled:0,isArmedForce:0,aadharDoc:null,photo:null}),m=c=>{console.log(c)},r=(c,s=!1)=>{if(o({...t,...c}),s){m(c);return}i(d+1)},u=c=>{o({...t,...c}),i(d-1)};return e.jsxs("div",{children:[{0:e.jsx(U,{data:t,next:r,setData:o}),1:e.jsx(H,{data:t,setData:o,next:r,prev:u}),2:e.jsx(Q,{data:t,setData:o,next:r,prev:u})}[d],e.jsx("div",{className:"text-center mt-4",children:e.jsx(A,{to:"/juidco-app/auth/login",className:"text-[#5846BE]",children:"Click here to Login"})})]})}export{k as default};
