import{R as C,_ as f,j as e,a as P}from"./index-YFtkVeJK.js";import{o as j,i as E,L as A}from"./router-kXW1V9st.js";import{u as R,F as q,T as w,L as I,c as D,a as x,b as M,S as z,P as T,d as V}from"./useErrorFocusField-eLlIkCHx.js";import{u as O}from"./useCustomQuery-3rrmdazv.js";import"./reactQuery-y2doqFVo.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-HRLWQzqE.js";import"./tailwind-NZBM7dkR.js";import"./reactIcons-o3wBAs33.js";import"./reactLazyLoadImageComponent-cDSN37jy.js";import"./headlessui-IkIVAZsJ.js";const L=d=>{const i=d.split(","),t=i[0].indexOf("base64")>=0?atob(i[1]):decodeURI(i[1]),o=i[0].split(":")[1].split(";")[0],c=new Uint8Array(t==null?void 0:t.length);for(let r=0;r<(t==null?void 0:t.length);r++)c[r]=t==null?void 0:t.charCodeAt(r);return new Blob([c],{type:o})},B=async d=>new Promise(t=>{C.imageFileResizer(d,500,500,"JPEG",60,0,o=>{t(o)},"base64")}).then(t=>L(t)),$=D().shape({mobile:x().required("Mobile is required").min(10).max(10)});function U({next:d,data:i,setData:t}){const{mutateAsync:o}=O({}),{sendOtp:c}=P,r=R({enableReinitialize:!0,initialValues:{mobile:i.mobileNo||""},validationSchema:$,onSubmit:async(m,{})=>{var p,a,g;try{const s=await o({api:c,data:{mobileNo:m.mobile,type:"Register"}});((p=s==null?void 0:s.data)==null?void 0:p.status)===!0?(d({...i,mobileNo:m.mobile}),f.success((a=s==null?void 0:s.data)==null?void 0:a.message)):f.error((g=s==null?void 0:s.data)==null?void 0:g.message)}catch(s){}}});return e.jsx(e.Fragment,{children:e.jsxs(q,{formik:r,children:[e.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Citizen Registration"}),e.jsx(w,{label:"Mobile",name:"mobile",type:"number",formik:r,onInput:m=>{m.target.value=Math.max(0,parseInt(m.target.value)).toString().slice(0,10)}}),e.jsx("div",{className:"text-center ",children:e.jsx(I,{type:"submit",loading:r==null?void 0:r.isSubmitting,disabled:r==null?void 0:r.isSubmitting,children:"Send OTP"})})]})})}const G=d=>{const[i,t]=j.useState(0),[o,c]=j.useState(!1);j.useEffect(()=>{let a;return o?(t(60*d),a=setInterval(()=>{t(g=>g-1)},1e3)):clearInterval(a),()=>clearInterval(a)},[o]),j.useEffect(()=>{i<0&&o&&(c(!1),t(0))},[i,o]);const r=()=>c(a=>!a),m=String(i%60).padStart(2,0);return{minutes:String(Math.floor(i/60)).padStart(2,0),seconds:m,togglerTimer:r,runTimer:o}},_=G,J=D().shape({otp:x().required("OTP is required").min(6).max(6)});function H({next:d,data:i,setData:t,prev:o}){const{mutateAsync:c}=O({}),{verifyOtp:r}=P,{minutes:m,seconds:p,togglerTimer:a,runTimer:g}=_(1),s=R({enableReinitialize:!0,initialValues:{mobile:i.mobileNo||"",otp:i.otp||""},validationSchema:J,onSubmit:async(h,{})=>{var v,N,n;try{const l=await c({api:r,data:{mobileNo:h.mobile,otp:h.otp}});((v=l==null?void 0:l.data)==null?void 0:v.status)===!0?(d({...i,otp:h.otp}),f.success((N=l==null?void 0:l.data)==null?void 0:N.message)):f.error((n=l==null?void 0:l.data)==null?void 0:n.message)}catch(l){f.error("Invalid OTP")}}});j.useEffect(()=>(a(),()=>{a()}),[]);const F=async()=>{try{const h=await c({api:P.sendOtp,data:{mobileNo:s==null?void 0:s.values.mobile,type:"Register"}});a(),t({mobileNo:s==null?void 0:s.values.mobile,otp:""}),s.setFieldValue("otp","")}catch(h){}};return e.jsx(e.Fragment,{children:e.jsxs(q,{formik:s,children:[e.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number +91-",i==null?void 0:i.mobileNo," ",e.jsx("span",{className:"text-sm text-blue-700",onClick:()=>o({mobile:s==null?void 0:s.values.mobile,otp:""}),children:"Edit"})]}),e.jsx(w,{label:"Verify OTP",name:"otp",type:"number",formik:s,onInput:h=>{h.target.value=Math.max(0,parseInt(h.target.value)).toString().slice(0,6)}}),e.jsx("div",{className:"text-center",children:e.jsx(I,{type:"submit",loading:s==null?void 0:s.isSubmitting,disabled:s==null?void 0:s.isSubmitting,children:"Verify OTP"})}),e.jsxs("div",{className:"text-center mt-4 text-sm",children:["Didn't receive the code?"," ",g?e.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",m,":",p]}):e.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:F,children:"Resend OTP"})]})]})})}const K=D().shape({mobile:x().required("Mobile is required").min(10).max(10),name:x().required("Name is required"),email:x().required("Email is required").email("Invalid Email"),gender:x().required("Gender is required"),password:x().required("Password is required"),confirmPassword:x().required("Confirm Password is required").oneOf([V("password"),null],"Passwords must match"),dob:x().required("Date of Birth is required")});function Q({next:d,prev:i,data:t,setData:o}){var v,N;const{AutoFocusErrorField:c}=M(),{register:r}=P,m=E(),p=O({}),a=R({enableReinitialize:!0,initialValues:{otp:t.otp||"",mobile:t.mobileNo||"",name:t.name||"",email:t.email||"",gender:(t==null?void 0:t.gender)||"",password:t.password||"",confirmPassword:t.confirmPassword||"",dob:t.dob||"",photo:t.photo||""},validationSchema:K,onSubmit:async n=>{var l,S,y;try{const u=new FormData;u.append("mobile",n.mobile),u.append("name",n.name),u.append("email",n.email),u.append("dob",n.dob),u.append("gender",n.gender),u.append("password",n.password),u.append("confirmPassword",n.confirmPassword),u.append("photo",n.photo);const b=await p.mutateAsync({api:r,data:u});((l=b==null?void 0:b.data)==null?void 0:l.status)===!0?(f.success((S=b==null?void 0:b.data)==null?void 0:S.message),m("/juidco-app/auth/login")):f.error((y=b==null?void 0:b.data)==null?void 0:y.message)}catch(u){f.error("Something went wrong")}}}),g=async n=>{var y,u;const l=await B(n.target.files[0]),S=new File([l],(u=(y=n==null?void 0:n.target)==null?void 0:y.files[0])==null?void 0:u.name,{type:"image/*"});a.setFieldValue("photo",S)},{isSubmitting:s,submitCount:F,errors:h}=a;return j.useEffect(()=>{c({formik:a})},[h,F,s]),e.jsx(e.Fragment,{children:e.jsxs(q,{formik:a,children:[e.jsx("h2",{className:" font-semibold mb-4",children:"Citizen Registration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(w,{label:"Name",name:"name",type:"text",formik:a})}),e.jsx("div",{children:e.jsx(w,{label:"Mobile",name:"mobile",type:"number",formik:a,onInput:n=>{n.target.value=Math.max(0,parseInt(n.target.value)).toString().slice(0,10)}})}),e.jsx("div",{className:"-mt-2",children:e.jsx(w,{label:"Email",name:"email",type:"email",formik:a})}),e.jsxs("div",{className:"-mt-2",children:[e.jsx(w,{label:"Upload Photo",accept:"image/*",name:"photo",type:"file",onChange:n=>g(n)}),e.jsx("small",{className:"text-red-500 -mt-6",children:((v=a==null?void 0:a.errors)==null?void 0:v.photo)&&((N=a==null?void 0:a.touched)==null?void 0:N.photo)})]}),e.jsx("div",{className:"-mt-2",children:e.jsx(w,{label:"Date of Birth",name:"dob",type:"date",formik:a})}),e.jsx("div",{className:"-mt-2",children:e.jsxs(z,{formik:a,name:"gender",label:"Gender",children:[e.jsx("option",{value:"",children:"Select Date"}),["Male","Female","Other"].map((n,l)=>e.jsx("option",{value:n,children:n},l))]})}),e.jsx("div",{className:"-mt-2",children:e.jsx(T,{label:"Password",name:"password",formik:a})}),e.jsx("div",{className:"-mt-2",children:e.jsx(T,{label:"confirm password",name:"confirmPassword",formik:a})})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsx(I,{type:"submit",loading:p.isLoading,disabled:p.isLoading,children:"Register Now"})})]})})}function re(){const[d,i]=j.useState(0),[t,o]=j.useState({otp:"",mobileNo:"",name:"",email:"",password:"",dob:"",gender:"",aadhar:"",isSpeciallyAbled:0,isArmedForce:0,aadharDoc:null,photo:null}),c=(m,p=!1)=>{o({...t,...m}),!p&&i(d+1)},r=m=>{o({...t,...m}),i(d-1)};return e.jsxs("div",{children:[{0:e.jsx(U,{data:t,next:c,setData:o}),1:e.jsx(H,{data:t,setData:o,next:c,prev:r}),2:e.jsx(Q,{data:t,setData:o,next:c,prev:r})}[d],e.jsx("div",{className:"text-center mt-4",children:e.jsx(A,{to:"/juidco-app/auth/e-praman-login",className:"text-[#5846BE] text-sm",children:"Click here to Login"})})]})}export{re as default};
