import{r as l,j as a,u as dt,g as st,d as Y,A as z,F as Q,b as f,L as mt,P as nt}from"./index-0e94f450.js";import{u as ut}from"./formik.esm-3041fe88.js";import{c as gt,b as ft,a as Z}from"./index.esm-53d0ef34.js";/* empty css                */import{R as ht}from"./Hourglass-60182635.js";import{T as b,F as wt}from"./LoadingButton-41bf7b10.js";import"./ThemeStyle-994f51bc.js";import"./index.esm-7ab12b54.js";const xt=()=>{const[s,h]=l.useState(""),u=()=>{const i=Math.random().toString(36).slice(2,8).toUpperCase();h(i)},w=(i,y)=>i===s?!0:(y({captcha:""},!1),u(),!1),r=document.createElement("canvas");r.style.margin="0",r.style.padding="0",r.width=100,r.height=22;const c=r.getContext("2d");c.font="bold 15px Arial",c.fillStyle="blue",c.fillText(s,21,16);const x=r.toDataURL();return l.useEffect(()=>{u()},[]),{catptchaTextField:i=>a("div",{children:a(b,{name:"captcha",placeholder:"Enter captcha",formik:i})}),captcha:s,dataUrl:x,verifyCaptcha:w,generateCaptcha:u}},Rt=()=>{const s=dt(),{catptchaTextField:h,dataUrl:u,generateCaptcha:w,verifyCaptcha:r}=xt(),{notify:c,setisLoggedIn:x,setheartBeatCounter:N}=l.useContext(st),[i,y]=l.useState(null),[o,tt]=l.useState(),{api_login:at,api_getPermission:et}=nt(),[it,E]=l.useState(!1),lt=gt({email:ft().required("Enter email"),password:Z().required("Enter password"),captcha:Z().required("Enter captcha")}),m=ut({initialValues:{email:"",password:"",type:"mobile",captcha:""},onSubmit:async(e,{resetForm:t})=>{r(e==null?void 0:e.captcha,t)?rt():c("Invalid Captcha")},validationSchema:lt}),I=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA","DRIVER","SEPTIC TANKER DRIVER","ENFORCEMENT OFFICER"],ct=l.useMemo(()=>Array.isArray(i)&&i.some(e=>I.includes(e)),[i]);l.useEffect(()=>{var e,t,n;i!=null&&(ct?(c("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((e=o==null?void 0:o.userDetails)==null?void 0:e.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((t=o==null?void 0:o.userDetails)==null?void 0:t.name)),window.localStorage.setItem("roles",JSON.stringify((n=o==null?void 0:o.userDetails)==null?void 0:n.role)),s("/dashboard")):c("You don't have permission of Tax Collector !!!","warn"))},[i]);const S=JSON.parse(window.localStorage.getItem("roles")),g=window.localStorage.getItem("token"),ot=l.useMemo(()=>Array.isArray(S)&&S.some(e=>I.includes(e)),[S,g]);l.useEffect(()=>{g!=""&&g!=null&&g!=null&&ot&&s("/dashboard")},[]);const rt=()=>{let e={email:m.values.email,password:m.values.password,type:"mobile"};Y.post(at,e,z()).then(function(t){var n,v,C,R,p,L,A,T,O,D,F,k,P,U,J,j,M,V,q,B,_,X,$,G,H;t.data.status==!0?(window.localStorage.setItem("token",(v=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:v.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(p=(R=(C=t==null?void 0:t.data)==null?void 0:C.data)==null?void 0:R.userDetails)==null?void 0:p.email),window.localStorage.setItem("userName",(T=(A=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:A.userDetails)==null?void 0:T.name),window.localStorage.setItem("userType",(F=(D=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:D.userDetails)==null?void 0:F.user_type),window.localStorage.setItem("userMobile",(U=(P=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:P.userDetails)==null?void 0:U.mobile),window.localStorage.setItem("ulbId",(M=(j=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:j.userDetails)==null?void 0:M.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((B=(q=(V=t==null?void 0:t.data)==null?void 0:V.data)==null?void 0:q.userDetails)==null?void 0:B.ulbName)),tt((_=t==null?void 0:t.data)==null?void 0:_.data),y((G=($=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:$.userDetails)==null?void 0:G.role),N(d=>d+1),x(!0),Y.post(et,{moduleId:1},z()).then(d=>{var K,W;d.data.status==!0&&window.localStorage.setItem("menuList",JSON.stringify((W=(K=d==null?void 0:d.data)==null?void 0:K.data)==null?void 0:W.permission))}).catch(d=>{})):(E(!1),c((H=t==null?void 0:t.data)==null?void 0:H.message,"error"))}).catch(function(t){E(!1),c("Something went wrong !!! ","error")})};return a(Q,{children:f(wt,{formik:m,children:[a("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:a(b,{name:"email",label:"Email",formik:m})}),a("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:a(b,{name:"password",label:"Password",formik:m})}),a("div",{className:"mt-6 flex flex-col flex-wrap gap-0",children:f("div",{className:"flex justify-between",children:[a("div",{className:"bg-gray-400 px-4 py-1 rounded-sm",children:a("img",{src:u,alt:"captcha"})}),a("div",{children:a("button",{type:"button",onClick:w,className:"text-[#5846BE] text-sm",children:"Reload Captcha"})})]})}),a("div",{className:"mt-2 flex flex-col flex-wrap gap-2",children:h(m)}),a("div",{className:"text-center mb-6 mt-4",children:it?a("div",{className:"flex justify-center",children:a(ht,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):f(Q,{children:[a("div",{className:"mb-1",children:a(mt,{to:"/forget-password",className:"text-xs text-indigo-600",children:"Forgot Password ?"})}),f("button",{type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ","Login"," "]})," "]})})]})})};export{Rt as default};
