import{u as et,r as o,g as it,d as B,A as U,j as a,F as X,b as m,L as lt,P as ot}from"./index-76367320.js";import{u as rt}from"./formik.esm-39b127b2.js";import{c as dt,b as st,a as mt}from"./index.esm-cd4f4d32.js";/* empty css                */import{R as ct}from"./Hourglass-ef0dccf3.js";const ft=()=>{const g=et(),{notify:c,setisLoggedIn:$,setheartBeatCounter:G}=o.useContext(it),[d,H]=o.useState(null),[i,K]=o.useState(),{api_login:W,api_getPermission:Y}=ot(),[z,w]=o.useState(!1),Q=dt({email:st().required("Enter email"),password:mt().required("Enter password")}),e=rt({initialValues:{email:"",password:""},onSubmit:l=>{at()},validationSchema:Q}),h=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA","DRIVER","SEPTIC TANKER DRIVER","ENFORCEMENT OFFICER"],Z=o.useMemo(()=>Array.isArray(d)&&d.some(l=>h.includes(l)),[d]);o.useEffect(()=>{var l,t,s;d!=null&&(Z?(c("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((l=i==null?void 0:i.userDetails)==null?void 0:l.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((t=i==null?void 0:i.userDetails)==null?void 0:t.name)),window.localStorage.setItem("roles",JSON.stringify((s=i==null?void 0:i.userDetails)==null?void 0:s.role)),g("/dashboard")):c("You don't have permission of Tax Collector !!!","warn"))},[d]);const n=JSON.parse(window.localStorage.getItem("roles")),u=window.localStorage.getItem("token"),tt=o.useMemo(()=>Array.isArray(n)&&n.some(l=>h.includes(l)),[n,u]);o.useEffect(()=>{u!=""&&u!=null&&u!=null&&tt&&g("/dashboard")},[]);const at=()=>{let l={email:e.values.email,password:e.values.password,type:"mobile"};B.post(W,l,U()).then(function(t){var s,f,x,b,S,N,I,E,y,R,v,L,A,O,C,D,T,k,F,J,P,j,M,p,V;t.data.status==!0?(window.localStorage.setItem("token",(f=(s=t==null?void 0:t.data)==null?void 0:s.data)==null?void 0:f.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(S=(b=(x=t==null?void 0:t.data)==null?void 0:x.data)==null?void 0:b.userDetails)==null?void 0:S.email),window.localStorage.setItem("userName",(E=(I=(N=t==null?void 0:t.data)==null?void 0:N.data)==null?void 0:I.userDetails)==null?void 0:E.name),window.localStorage.setItem("userType",(v=(R=(y=t==null?void 0:t.data)==null?void 0:y.data)==null?void 0:R.userDetails)==null?void 0:v.user_type),window.localStorage.setItem("userMobile",(O=(A=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:A.userDetails)==null?void 0:O.mobile),window.localStorage.setItem("ulbId",(T=(D=(C=t==null?void 0:t.data)==null?void 0:C.data)==null?void 0:D.userDetails)==null?void 0:T.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((J=(F=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:F.userDetails)==null?void 0:J.ulbName)),K((P=t==null?void 0:t.data)==null?void 0:P.data),H((p=(M=(j=t==null?void 0:t.data)==null?void 0:j.data)==null?void 0:M.userDetails)==null?void 0:p.role),G(r=>r+1),$(!0),B.post(Y,{moduleId:1},U()).then(r=>{var _,q;r.data.status==!0&&window.localStorage.setItem("menuList",JSON.stringify((q=(_=r==null?void 0:r.data)==null?void 0:_.data)==null?void 0:q.permission))}).catch(r=>{})):(w(!1),c((V=t==null?void 0:t.data)==null?void 0:V.message,"error"))}).catch(function(t){w(!1),c("Something went wrong !!! ","error")})};return a(X,{children:m("form",{onChange:e.handleChange,onSubmit:e.handleSubmit,children:[m("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:[a("label",{htmlFor:"email",className:"text-sm",children:"Email :"}),a("input",{type:"email",name:"email",id:"email",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter email"}),e.errors.email&&e.touched.email&&a("span",{className:"text-red-600 text-xs",children:e.errors.email})]}),m("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:[a("label",{htmlFor:"password",className:"text-sm",children:"Password :"}),a("input",{type:"password",name:"password",id:"password",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter password"}),e.errors.password&&e.touched.password&&a("span",{className:"text-red-600 text-xs",children:e.errors.password})]}),a("div",{className:"text-center mb-6 mt-4",children:z?a("div",{className:"flex justify-center",children:a(ct,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):m(X,{children:[a("div",{className:"mb-1",children:a(lt,{to:"/forget-password",className:"text-xs text-indigo-600",children:"Forgot Password ?"})}),m("button",{type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ","Login"," "]})," "]})})]})})};export{ft as default};
