import{j as e}from"./mui-d8134288.js";import{f as o,r as l,u as i,h as s}from"./router-a70afc62.js";import{z as t,c as r,d as a,u as n,C as d,a3 as c,b as m,a_ as u,k as b,r as p,E as v}from"./index-1c8a2e08.js";import{a as h}from"./axios-0f103e9d.js";import w from"./MobileNoCard-b107310f.js";import f from"./OtpCard-69be3233.js";import{S as x}from"./ServerErrorCard-e275c2e4.js";import{E as g}from"./EPramanLoginLoader-9232a089.js";import"./reactIcons-65f093d4.js";import"./materialTailwind-01b55b4e.js";import"./moment-494dae31.js";/* empty css                */import"./redux-c3344370.js";import"./i18next-524eea2d.js";const y=()=>{const{via:y}=o(),[N,j]=l.useState(!1),[C,z]=l.useState(!1),[P,S]=l.useState(!1),{api_citizenLogin2:M,api_ePramanLogin:E}=v(),[k,L]=l.useState(null),[_,T]=l.useState(!1),{notify:O,setheartBeatCounter:D}=l.useContext(t),V=i(),[B,F]=l.useState();l.useState(!0);const I=s();l.useEffect(()=>{"e-pramaan"==y?(()=>{let e=null==I?void 0:I.search,o=null==e?void 0:e.split("?")[1],l=null==o?void 0:o.split("&");const i={};null==l||l.forEach(e=>{const[o,l]=e.split("=");i[o]=l}),T(!0);let s={codeVerifier:window.localStorage.getItem("codeVerifier"),nonce:window.localStorage.getItem("nonce"),code:null==i?void 0:i.code,type:"citizen"};h.post(E,s,m()).then(e=>{var o,l,i,t,r,a,n,d,c,m,p,v,h;(null==(o=null==e?void 0:e.data)?void 0:o.status)?(window.localStorage.removeItem("codeVerifier"),window.localStorage.removeItem("nonce"),window.localStorage.setItem("citizenMobile",null==(i=null==(l=null==e?void 0:e.data)?void 0:l.data)?void 0:i.mobile),window.localStorage.setItem("citizenName",null==(r=null==(t=null==e?void 0:e.data)?void 0:t.data)?void 0:r.userName),window.localStorage.setItem("citizen_token",null==(n=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:n.token),window.localStorage.setItem("epramaanToken",null==(m=null==(c=null==(d=null==e?void 0:e.data)?void 0:d.data)?void 0:c.eparmanToken)?void 0:m.respose_json),window.localStorage.setItem("citizenId",null==(v=null==(p=null==e?void 0:e.data)?void 0:p.data)?void 0:v.id),V("/landingDashboard")):(u.error(b(null==(h=null==e?void 0:e.data)?void 0:h.message,E,s)),u.error("Oops! Please try again later."),V("/"))}).catch(e=>{u.error("Oops! Please try again later."),V("/")}).finally(()=>{T(!1)})})():window.localStorage.getItem("citizen_token")&&V("/landingDashboard")},[]);const A=r().shape({mobile:a().required("Enter mobile no. !").min(10).max(10),password:a().min(6,"Minimum six character !").max(50,"Too Long!").required("Enter password no. !").matches(/^(?=.*\d)(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z]).{6,}$/,"Password Must Contains (Capital, Smail, Number, Special) eg - Abc123#.")}),W=n({initialValues:{mobile:"",password:""},onSubmit:e=>{Y(e)},validationSchema:A}),Y=e=>{F(""),j(!0),R(!1),h.post(M,{mobile:null==e?void 0:e.mobile,password:null==e?void 0:e.password}).then(e=>{var o,l,i,s,t,r,a,n,d,c,m;!0===(null==(o=null==e?void 0:e.data)?void 0:o.status)?(localStorage.setItem("citizen_token",null==(i=null==(l=null==e?void 0:e.data)?void 0:l.data)?void 0:i.token),j(!1),O("Login Success","success"),window.localStorage.setItem("citizenMobile",null==(t=null==(s=null==e?void 0:e.data)?void 0:s.data)?void 0:t.mobile),window.localStorage.setItem("citizenName",null==(a=null==(r=null==e?void 0:e.data)?void 0:r.data)?void 0:a.userName),window.localStorage.setItem("citizenId",null==(d=null==(n=null==e?void 0:e.data)?void 0:n.data)?void 0:d.id),D(e=>e+1),V("/landingDashboard")):(O(b(null==(c=null==e?void 0:e.data)?void 0:c.message),"error"),j(!1)),F(b(null==(m=null==e?void 0:e.data)?void 0:m.message))}).catch(e=>{F("Oops! Please try again later."),j(!1),R(!0),O("something went wrong !!","error")})},[$,R]=l.useState(!1);return $?e.jsx(d,{children:e.jsx(x,{title:"Server is busy",desc:"Server is too busy to respond. Please try again later.",buttonText:"View Dashboard",buttonUrl:"/propertyDashboard"})}):C?e.jsx(w,{cardFor:"Login",closeMobileModal:()=>{z(!1)},headTitle:"Forgot Password",title:"Enter mobile to get OTP",desc:"Enter your mobile no, which is attached to your account.",setverifedMobileNo:L,setmobileCardStatus:z,setotpCardStatus:S}):P?e.jsx(f,{verifedMobileNo:k,closeOtpModal:()=>{S(!1)},bottomNaviation:!0,headTitle:"Forgot OTP",callback:()=>{O("Mobile no. has been verified successfully !","success"),V("/change-password/forgot")},setotpCardStatus:S}):e.jsxs(e.Fragment,{children:[_&&e.jsx(g,{message:"Login Via E-Pramaan"}),e.jsx("div",{className:" flex items-center justify-center text-center mt-6 md:p-0 mx-auto bg-white md:bg-none shadow-lg md:shadow-none w-full h-full",children:e.jsx("div",{className:" w-full h-full flex justify-center",children:e.jsx("form",{onChange:e=>{"mobile"==e.target.name&&W.setFieldValue("mobile",p(e.target.value,W.values.mobile,10))},onSubmit:W.handleSubmit,className:"md:w-[60%] w-full md:h-[60%]",children:e.jsxs("div",{className:"grid grid-cols-12 px-6 md:px-0 drop-shadow-md w-full",children:[e.jsx("div",{className:"col-span-6 hidden md:py-10 bg-slate-100 p-5 md:flex justify-center items-center border-r",children:e.jsx("img",{src:"/assets/login2-88f52aba.svg",className:"hue-rotate-[-30deg] w-[80%]"})}),e.jsx("div",{className:"w-full md:px-10 col-span-12 md:col-span-6 md:shadow-none bg-white py-10 px-4",children:e.jsxs("div",{className:"w-full  pb-6 pt-0 md:py-6 md:mt-10 text-gray-700",children:[e.jsx("h1",{className:"text-center text-md font-semibold md:my-1 capitalize w-full"}),e.jsx("h1",{className:"text-center font-semibold my-1 flex justify-center",children:e.jsxs("span",{className:"px-1 text-semibold text-2xl -mt-5 mb-4 border-b-2 border-b-[#99B37C]",children:["Log In"," "]})}),e.jsxs("div",{className:"my-3 relative text-sm",children:[e.jsxs("div",{className:"text-gray-600 static mb-1 font-semibold text-left px-8 md:px-10 ",children:["Mobile No.",e.jsx("span",{className:"text-red-500 font-bold",children:"*"})]}),e.jsx("input",{type:"text",min:0,...W.getFieldProps("mobile"),className:"cypress_mobile border-b border-b-gray-200 focus:border-b focus:border-b-indigo-500  pl-2 px-3 py-1 w-full md:w-5/6 shadow-sm h-10 outline-none border border-solid border-gray-300 rounded hover:bg-gray-100",placeholder:"Enter Your mobile"}),e.jsx("div",{children:e.jsx("span",{className:"text-red-600 absolute text-xs",children:W.touched.mobile&&W.errors.mobile?W.errors.mobile:null})})]}),e.jsxs("div",{className:"my-3 relative text-sm mt-4",children:[e.jsxs("div",{className:"text-gray-600 static mb-1 font-semibold text-left px-8 md:px-10",children:["Password"," ",e.jsx("span",{className:"text-red-500 font-bold",children:"*"})]}),e.jsx("input",{type:"password",...W.getFieldProps("password"),className:"cypress_password border-b border-b-gray-200 focus:border-b focus:border-b-indigo-500  pl-2 px-3 py-1 w-full md:w-5/6 shadow-sm h-10 outline-none border border-solid border-gray-300 rounded hover:bg-gray-100",placeholder:"Enter Your Password"}),e.jsx("div",{children:e.jsx("span",{className:"text-red-600 absolute text-xs",children:W.touched.password&&W.errors.password?W.errors.password:null})})]}),e.jsx("div",{className:" my-10"}),e.jsx("div",{className:"text-center mt-3 text-xs"}),e.jsxs("div",{className:"my-5 self-center justify-self-center relative",children:[e.jsxs("div",{className:"text-red-600 text-sm font-semibold my-3 ",children:[" ",e.jsxs("span",{className:"",children:[" ",B]})]}),N?e.jsx("div",{className:"flex justify-center",children:e.jsx(c,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):e.jsx("button",{type:"submit",disabled:N,className:"cypress_button_login bg-[#99B37C] hover:bg-[#99B37C] px-20 shadow-xl py-2  rounded-md text-white text-lg font-semibold",children:"Login"})]}),e.jsx("div",{className:"flex flex-row flex-wrap gapx-x-2 gap-y-2 w-full poppins justify-center",children:e.jsx("span",{className:"text-gray-700 text-sm font-semibold cursor-pointer md:w-[40%] w-full",onClick:()=>z(!0),children:"Forgot Password"})}),e.jsx("div",{className:"w-full flex justify-center mt-10",children:e.jsx("span",{onClick:()=>V("/register"),className:"hover:underline text-gray-700 font-semibold hover:bg-white px-3 py-1 cursor-pointer float-right",children:"Register"})})]})})]})})})})]})};export{y as default};
