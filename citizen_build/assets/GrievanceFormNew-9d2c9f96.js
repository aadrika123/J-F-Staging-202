import{j as e}from"./mui-d8134288.js";import{r as l,u as a}from"./router-a70afc62.js";import{W as i,z as r,c as n,d as t,u as d,A as s,a3 as c}from"./index-1c8a2e08.js";import{G as o}from"./GrievanceApiList-4e83b4c5.js";import"./axios-0f103e9d.js";import"./reactIcons-65f093d4.js";import"./materialTailwind-01b55b4e.js";import"./moment-494dae31.js";/* empty css                */import"./redux-c3344370.js";import"./i18next-524eea2d.js";function m(m){const[p,h]=l.useState(null),[u,v]=l.useState(),[N,g]=l.useState(),[x,b]=l.useState(),[f,y]=l.useState(),[w,j]=l.useState(!1),[S,I]=l.useState(!1),[G,H]=l.useState(),[A,R]=l.useState(),[F,C]=l.useState(),{api_distList:E,api_getAllUlbList:U,api_wardListByUlb:D,api_grievanceApplyForm:T}=o(),{api_getHoldingSafOfLogin:_,api_getSafHoldingDetails:q,header:$}=i(),{notify:O}=l.useContext(r);a();const{setBreadCrumbData:L}=l.useContext(r);l.useEffect(()=>{L(["Apply Grievance"])},[]);const W=n({applicantName:t().required("Require"),applyThrough:t().required("Require"),email:t().email("Invalid email address").required("Require"),grievanceHead:t().required("Require"),description:t().required("Require"),department:t().required("Require"),fileUpload:t().required("Require")}),z=d({initialValues:{mobileNo:null==m?void 0:m.mobileNo,applicantName:"",applyThrough:"",holdingNo:"",email:"",aadhar:"",gender:"",disability:"",department:"",grievanceHead:"",description:"",district:"",ulb:"",ward:"",address:"",otherInfo:"",fileUpload:""},enableReinitialize:!0,onSubmit:(e,l)=>{V(e)},validationSchema:W});l.useRef(null),l.useRef(null),l.useRef(null),l.useRef(null),l.useEffect(()=>{s.post(E,{}).then(e=>{e.data.status&&g(e.data.data)}).catch(e=>{})},[]),l.useEffect(()=>{s.get(U).then(e=>{e.data.status&&b(e.data.data)}).catch(e=>{})},[]),l.useEffect(()=>{s.post(D,{ulbId:2}).then(e=>{e.data.status&&y(e.data.data)}).catch(e=>{}),z.setFieldValue("mobileNo",M)},[z.values.ulb]);const V=e=>{var l;j();let a=new FormData;a.append("mobileNo",e.mobileNo),a.append("applicantName",e.applicantName),a.append("email",e.email),a.append("gender",e.gender),a.append("disability",e.disability),a.append("department",e.department),a.append("grievanceHead",e.grievanceHead),a.append("description",e.description),a.append("ulbId",2),a.append("address",e.address),a.append("otherInfo",e.otherInfo),a.append("document",u||""),a.append("docCode","GRIEVANCE_DOC"),a.append("docCategory","GRIEVANCE_DOC"),I(!0),null==(l=s)||l.post(T,a,$).then(e=>{var l;I(!1),e.data.status?(O("Grievance Submitted Successfully","success"),C(null==(l=null==e?void 0:e.data)?void 0:l.applicationNo),m.success(!0),m.data(e.data.data)):(O("Grievance not submitted","error"),j(e.data.message||"Failed to apply grievance"))}).catch(e=>{I(!1),O("Error while Grievance submitting","error"),j("Error While applying grievance")})},k="flex-1 w-full px-4 py-2 text-base text-gray-800 placeholder-gray-400 bg-white border border-gray-300 focus:outline-none focus:ring-1 focus:ring-indigo-800 focus:border-transparent",B="text-red-700 font-semibold";l.useEffect(()=>{s.post(_,{type:"holding",ulbId:2},$).then(e=>{e.data.status&&H(e.data.data)}).catch(e=>{})},[z.values.applyThrough]),l.useEffect(()=>{s.post(q,{connectionThrough:"1",id:z.values.holdingNo,ulbId:2},$).then(e=>{e.data.status&&R(e.data.data)}).catch(e=>{})},[z.values.holdingNo]),l.useEffect(()=>{var e,l,a;"holding"==z.values.applyThrough&&(z.setFieldValue("applicantName",null==(e=null==A?void 0:A.owners[0])?void 0:e.ownerName),z.setFieldValue("email",null==(l=null==A?void 0:A.owners[0])?void 0:l.email),z.setFieldValue("disability",null==(a=null==A?void 0:A.owners[0])?void 0:a.is_specially_abled),z.setFieldValue("address",null==A?void 0:A.prop_address)),"other"==z.values.applyThrough&&(z.setFieldValue("applicantName",""),z.setFieldValue("email",""),z.setFieldValue("address",""))},[A,z.values.applyThrough]);const M=localStorage.getItem("citizenMobile");return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-5 py-6 rounded-lg border border-indigo-300 bg-white",children:[e.jsx("div",{className:"text-center text-lg",children:" Submit Your Grievance "}),e.jsx("div",{children:e.jsxs("form",{onSubmit:z.handleSubmit,onChange:e=>{if("fileUpload"===e.target.name){const l=e.target.files[0],a=new FileReader;a.onload=()=>{h(a.result)},a.readAsDataURL(l),v(l)}},children:[e.jsxs("div",{className:"md:grid md:grid-flow-col justify-stretch",children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Apply Through",e.jsx("span",{className:B,children:"*"})]}),e.jsxs("select",{name:"applyThrough",...z.getFieldProps("applyThrough"),className:`${k} `,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"holding",children:"Holding"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.applicantName&&z.errors.applicantName?z.errors.applicantName:null})]}),"holding"===z.values.applyThrough&&e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Select Holding",e.jsx("span",{className:B,children:"*"})]}),e.jsxs("select",{name:"holdingNo",...z.getFieldProps("holdingNo"),className:`${k} `,children:[e.jsx("option",{value:"",children:"Select"}),null==G?void 0:G.map(l=>e.jsx("option",{value:l.new_holding_no,children:l.new_holding_no}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.applicantName&&z.errors.applicantName?z.errors.applicantName:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Applicant Name",e.jsx("span",{className:B,children:"*"})]}),e.jsx("input",{type:"text",...z.getFieldProps("applicantName"),name:"applicantName",className:`${k}`}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.applicantName&&z.errors.applicantName?z.errors.applicantName:null})]})]}),e.jsxs("div",{className:"md:grid md:grid-flow-col justify-stretch",children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Mobile No",e.jsx("span",{className:B,children:"*"})]}),e.jsx("input",{type:"text",...z.getFieldProps("mobileNo"),name:"mobileNo",className:`${k}`})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Email",e.jsx("span",{className:B,children:"*"})]}),e.jsx("input",{type:"text",...z.getFieldProps("email"),name:"email",className:` ${k}`}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.email&&z.errors.email?z.errors.email:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsx("label",{children:"Aadhar"}),e.jsx("input",{type:"text",...z.getFieldProps("aadhar"),name:"aadhar",className:`${k}`}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.aadhar&&z.errors.aadhar?z.errors.aadhar:null})]})]}),e.jsxs("div",{className:"md:grid md:grid-flow-col justify-stretch",children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Select Department ",e.jsx("span",{className:B,children:"*"})]}),e.jsxs("select",{...z.getFieldProps("department"),name:"department",className:`   ${k}`,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"1",children:"Property"}),e.jsx("option",{value:"2",children:"Water"}),e.jsx("option",{value:"3",children:"Trade"}),e.jsx("option",{value:"5",children:"Advertisement"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.department&&z.errors.department?z.errors.department:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"grievanceHead",children:["Select Grievance Head ",e.jsx("span",{className:B,children:"*"})]}),e.jsxs("select",{...z.getFieldProps("grievanceHead"),name:"grievanceHead",className:k,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"1",children:"Grievance Head 1"}),e.jsx("option",{value:"2",children:"Grievance Head 2"}),e.jsx("option",{value:"3",children:"Grievance Head 3"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.grievanceHead&&z.errors.grievanceHead?z.errors.grievanceHead:null})]})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"description",children:["Write Description ",e.jsx("span",{className:B,children:"*"})]}),e.jsx("textarea",{...z.getFieldProps("description"),name:"description",className:k,placeholder:"Enter your grievance",rows:"5",cols:"40"}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.description&&z.errors.description?z.errors.description:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"address",children:["Your Address ",e.jsx("span",{className:B,children:"*"})]}),e.jsx("textarea",{...z.getFieldProps("address"),name:"address",className:k,placeholder:"Enter your address",rows:"2"}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.address&&z.errors.address?z.errors.address:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"otherInfo",children:["Other Information ",e.jsx("span",{className:"text-xs italic",children:"(optional)"})]}),e.jsx("textarea",{...z.getFieldProps("otherInfo"),name:"otherInfo",className:k,placeholder:"Other Information",rows:"2"}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.otherInfo&&z.errors.otherInfo?z.errors.otherInfo:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"fileUpload",children:["Upload File ",e.jsx("span",{className:"text-xs italic",children:"(optional)"})," "]}),e.jsx("input",{...z.getFieldProps("fileUpload"),type:"file",accept:"image/*",name:"fileUpload",className:k}),e.jsx("p",{className:"text-red-500 text-xs",children:z.touched.fileUpload&&z.errors.fileUpload?z.errors.fileUpload:null})]}),e.jsx("div",{className:"flex justify-center",children:p&&e.jsx("img",{src:p,alt:"Preview",className:"border border-gray-300 px-4 py-2 rounded-lg mt-4 h-32"})}),e.jsx("p",{className:"text-center text-red-500 font-semibold",children:w&&w}),e.jsx("div",{className:"m-3 flex justify-center",children:e.jsx("button",{disabled:S,type:"submit",className:"px-4 py-2 mt-5 bg-indigo-600 hover:bg-indigo-700 text-gray-50 text-base shadow-md rounded-md",children:S?e.jsx("div",{children:e.jsx(c,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})}):"Submit Grievances"})})]})})]})})}export{m as default};
