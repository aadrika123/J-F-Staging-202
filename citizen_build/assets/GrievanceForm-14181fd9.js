import{j as e}from"./mui-105b4636.js";import{r as i,u as z}from"./router-894402c5.js";import{V as B}from"./index.esm-dd298bba.js";import{m as M,c as J,d,u as K,A as o,R as Q}from"./index-5f3b1ea2.js";import{G as T}from"./GrievanceApiList-1723cc35.js";import"./react-40db4358.js";import"./reactIcons-58c2a0d8.js";import"./axios-67d8a945.js";import"./redux-b8f144fa.js";import"./i18next-e2c66b9b.js";function ce(n){var q;const[N,I]=i.useState(null),[P,G]=i.useState(),[m,E]=i.useState(),[p,U]=i.useState(),[x,H]=i.useState(),[g,u]=i.useState(!1),[b,h]=i.useState(!1),[X,A]=i.useState(),{api_distList:C,api_getAllUlbList:D,api_wardListByUlb:_,api_grievanceApplyForm:$}=T(),{notify:j}=i.useContext(M);z();const L=J({applicantName:d().required("Require"),email:d().email("Invalid email address").required("Require"),gender:d().required("Require"),disability:d().required("Require"),grievanceHead:d().required("Require"),description:d().required("Require"),department:d().required("Require"),district:d().required("Require"),ulb:d().required("Require"),ward:d().required("Require"),fileUpload:d().required("Require")}),V={mobileNo:n==null?void 0:n.mobileNo,applicantName:"",email:"",aadhar:"",gender:"",disability:"",department:"",grievanceHead:"",description:"",district:"",ulb:"",ward:"",address:"",otherInfo:"",fileUpload:""},r=K({initialValues:V,enableReinitialize:!0,onSubmit:(a,t)=>{Y(a)},validationSchema:L}),W=a=>{let t=a.target.name;if(a.target.value,t==="fileUpload"){const c=a.target.files[0],l=new FileReader;l.onload=()=>{I(l.result)},l.readAsDataURL(c),G(c)}},v=i.useRef(null),y=i.useRef(null),f=i.useRef(null),F=i.useRef(null),k=()=>{if(r.errors.applicantName)return v.current.focus();if(r.errors.email)return y.current.focus();if(r.errors.gender)return f.current.focus();if(r.errors.department)return F.current.focus()};i.useEffect(()=>{o.post(C,{}).then(a=>{a.data.status&&E(a.data.data)}).catch(a=>{})},[]),i.useEffect(()=>{o.get(D).then(a=>{a.data.status&&U(a.data.data)}).catch(a=>{})},[]);const O=()=>{o.post(_,{ulbId:2}).then(a=>{a.data.status&&H(a.data.data)}).catch(a=>{})};i.useEffect(()=>{O()},[r.values.ulb]);const Y=a=>{var c;u();let t=new FormData;t.append("mobileNo",a.mobileNo),t.append("applicantName",a.applicantName),t.append("email",a.email),t.append("aadhar",a.aadhar),t.append("gender",a.gender),t.append("disability",a.disability),t.append("department",a.department),t.append("grievanceHead",a.grievanceHead),t.append("description",a.description),t.append("districtId",Number(a.district)),t.append("ulbId",a.ulb),t.append("wardId",a.ward),t.append("address",a.address),t.append("otherInfo",a.otherInfo),t.append("document",P||""),t.append("docCode","GRIEVANCE_DOC"),t.append("docCategory","GRIEVANCE_DOC"),h(!0),(c=o)==null||c.post($,t).then(l=>{var S,R,w;h(!1),l.data.status?(j("Grievance Submitted Successfully","success"),n.grievanceApplicationNo((R=(S=l==null?void 0:l.data)==null?void 0:S.data)==null?void 0:R.applicationNo),A((w=l==null?void 0:l.data)==null?void 0:w.applicationNo),n.screen()):(j("Grievance not submitted","error"),u(l.data.message||"Failed to apply grievance"))}).catch(l=>{h(!1),j("Error while Grievance submitting","error"),u("Error While applying grievance")})},s={filed:"flex-1 w-full px-4 py-2 text-base text-gray-800 placeholder-gray-400 bg-white border border-gray-300 focus:outline-none focus:ring-1 focus:ring-indigo-800 focus:border-transparent",required:"text-red-700 font-semibold"};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-5 py-6 rounded-lg border border-indigo-300 bg-white",children:[e.jsxs("p",{className:"absolute right-8 top-8 cursor-pointer bg-gray-100 hover:bg-gray-300",children:[" ",e.jsx(B,{size:30})," "]}),e.jsx("div",{className:"text-center text-lg",children:" Submit Your Grievance "}),e.jsx("div",{children:e.jsxs("form",{onSubmit:r.handleSubmit,onChange:W,onSubmitCapture:k,children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Mobile No",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("input",{type:"text",disabled:!0,...r.getFieldProps("mobileNo"),name:"mobileNo",className:`${s.filed} disabled:bg-gray-200`})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Applicant Name",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("input",{type:"text",...r.getFieldProps("applicantName"),name:"applicantName",ref:v,className:`${r.errors.applicantName&&"border-red-600"} ${s.filed}`}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.applicantName&&r.errors.applicantName?r.errors.applicantName:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Email",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("input",{type:"text",...r.getFieldProps("email"),name:"email",ref:y,className:` ${r.errors.email&&"border-red-600"} ${s.filed}`}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.email&&r.errors.email?r.errors.email:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsx("label",{children:"Aadhar"}),e.jsx("input",{type:"text",...r.getFieldProps("aadhar"),name:"aadhar",className:`${s.filed}`}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.aadhar&&r.errors.aadhar?r.errors.aadhar:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("div",{className:"flex justify-start",children:[e.jsxs("label",{children:["Gender",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("input",{type:"radio",...r.getFieldProps("gender"),name:"gender",ref:f,value:"male",className:"mx-2"}),"Male",e.jsx("input",{type:"radio",...r.getFieldProps("gender"),name:"gender",ref:f,value:"female",className:"mx-2"}),"Female"]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.gender&&r.errors.gender?r.errors.gender:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("div",{className:"flex justify-start",children:[e.jsxs("label",{children:["Specially abled ?",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("input",{type:"radio",...r.getFieldProps("disability"),name:"disability",value:"true",className:"mx-2"}),"Yes",e.jsx("input",{type:"radio",...r.getFieldProps("disability"),name:"disability",value:"false",className:"mx-2"}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.disability&&r.errors.disability?r.errors.disability:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Select Department ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("department"),name:"department",ref:F,className:` ${r.errors.department&&"border-red-600"} ${s.filed}`,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"1",children:"Department 1"}),e.jsx("option",{value:"2",children:"Department 2"}),e.jsx("option",{value:"3",children:"Department 3"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.department&&r.errors.department?r.errors.department:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"grievanceHead",children:["Select Grievance Head ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("grievanceHead"),name:"grievanceHead",className:s.filed,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"1",children:"Grievance Head 1"}),e.jsx("option",{value:"2",children:"Grievance Head 2"}),e.jsx("option",{value:"3",children:"Grievance Head 3"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.grievanceHead&&r.errors.grievanceHead?r.errors.grievanceHead:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"description",children:["Write Description ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("textarea",{...r.getFieldProps("description"),name:"description",className:s.filed,placeholder:"Enter your grievance",rows:"5",cols:"40"}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.description&&r.errors.description?r.errors.description:null})]}),e.jsxs("div",{className:"md:grid md:grid-flow-col justify-stretch",children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Select District ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("district"),name:"district",className:s.filed,children:[e.jsx("option",{children:"Select"}),m==null?void 0:m.map(a=>e.jsx("option",{value:a.district_code,children:a.district_name}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.district&&r.errors.district?r.errors.district:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"ulb",children:["Select ULB ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("ulb"),name:"ulb",className:s.filed,children:[e.jsx("option",{value:"",children:"Select"}),(q=p==null?void 0:p.filter(a=>a.district_id==r.values.district))==null?void 0:q.map(a=>e.jsx("option",{value:a.id,children:a.ulb_name}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.ulb&&r.errors.ulb?r.errors.ulb:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"ward",children:["Select Ward ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("ward"),name:"ward",className:s.filed,children:[e.jsx("option",{children:"Select"}),x==null?void 0:x.map(a=>e.jsx("option",{value:a.id,children:a.ward_name}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.ward&&r.errors.ward?r.errors.ward:null})]})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"address",children:["Your Address ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("textarea",{...r.getFieldProps("address"),name:"address",className:s.filed,placeholder:"Enter your address",rows:"2"}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.address&&r.errors.address?r.errors.address:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"otherInfo",children:["Other Information ",e.jsx("span",{className:"text-xs italic",children:"(optional)"})," ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("textarea",{...r.getFieldProps("otherInfo"),name:"otherInfo",className:s.filed,placeholder:"Other Information",rows:"2"}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.otherInfo&&r.errors.otherInfo?r.errors.otherInfo:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"fileUpload",children:["Upload File ",e.jsx("span",{className:"text-xs italic",children:"(optional)"})," ",e.jsx("span",{className:s.required,children:"*"})]}),e.jsx("input",{...r.getFieldProps("fileUpload"),type:"file",accept:"image/*",name:"fileUpload",className:s.filed}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.fileUpload&&r.errors.fileUpload?r.errors.fileUpload:null})]}),e.jsx("div",{className:"flex justify-center",children:N&&e.jsx("img",{src:N,alt:"Preview",className:"border border-gray-300 px-4 py-2 rounded-lg mt-4 h-32"})}),e.jsx("p",{className:"text-center text-red-500 font-semibold",children:g&&g}),e.jsx("div",{className:"m-3 flex justify-center",children:e.jsx("button",{disabled:b,type:"submit",className:"px-4 py-2 mt-5 bg-indigo-600 hover:bg-indigo-700 text-gray-50 text-base shadow-md rounded-md",children:b?e.jsx("div",{children:e.jsx(Q,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})}):"Submit Grievances"})})]})})]})})}export{ce as default};
