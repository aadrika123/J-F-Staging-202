import{j as e}from"./mui-d8134288.js";import{u as l,r as n,f as i,b as a}from"./router-a70afc62.js";import{U as t,z as d,W as o,c as r,d as s,u as c,A as m,h as u,a1 as p,a2 as v,a3 as h,b as g,ay as b,M as x}from"./index-1c8a2e08.js";import{i as y}from"./success-39308b33.js";import{a as N}from"./axios-0f103e9d.js";const f=i=>{var a,g,b,x,y,f,w,_,k;const{handlePayment:I}=t(),C=l(),[P,j]=n.useState(!1),[S,z]=n.useState(!1),[R,A]=n.useState(""),{notify:W}=n.useContext(d),{api_WaterGetDetailsById:O,header:D,api_rzpWaterOrderId:T,api_generatedreceipt:M}=o(),U=null==i?void 0:i.paymentData,B=e=>{if(null!=e&&""!=e)return JSON.parse(e)},F=r({isInstallment:s().required("Require"),installment:s().when([],{is:()=>"yes"==Y.values.isInstallment,then:s().required("Select Installment")})}),Y=c({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:e=>{q(e)},validationSchema:F});n.useEffect(()=>{var e,l;1==(null==(e=null==R?void 0:R.calculation)?void 0:e.paidStatus)&&2==(null==(l=null==R?void 0:R.calculation)?void 0:l.chargeCatagoryId)&&Y.setFieldValue("isInstallment","yes")},[R]),n.useEffect(()=>{var e;z(!0),N.post(O,{applicationId:null==(e=null==U?void 0:U.connectionCharges)?void 0:e.applicationId},D).then(function(e){A(e.data.data),z(!1)}).catch(function(e){z(!1),W("Something Went Wrong","error")})},[U]);const $=async e=>{let l={applicationId:null==e?void 0:e.applicationId,departmentId:null==e?void 0:e.departmentId,status:"",captured:"1",card_id:"",amount:null==e?void 0:e.amount,payment_method:"upi/netbanking",workflow_id:null==e?void 0:e.workflowId,user_id:null==e?void 0:e.userId,ulb_id:null==e?void 0:e.ulbId,user_id:localStorage.getItem("citizenId"),payment_order_id:null==e?void 0:e.razorpay_order_id,payment_id:null==e?void 0:e.razorpay_payment_id,created_at:""};m.post(M,l,D).then(e=>{var l;1==e.data.status?C(`/waterConnReceipt/${null==(l=null==e?void 0:e.data)?void 0:l.data}`,{replace:!0}):toast.error(e.data.message,"error")}).catch(e=>{toast.error(e.message,"error")})},q=e=>{var l,n,i;let a;"yes"==e.isInstallment&&(a=(null==(l=B(null==e?void 0:e.installment))?void 0:l.ids).split(","));const t={id:null==(n=null==U?void 0:U.connectionCharges)?void 0:n.applicationId,applycationType:null==(i=null==U?void 0:U.connectionCharges)?void 0:i.type,isInstallment:e.isInstallment,penaltyIds:a};j(!0),m.post(T,t,D).then(e=>{var l,n,i,a,t,d,o,r,s,c,m,p,v,h;j(!1),window.ReactNativeWebView?u({generatedOrder:null==(l=null==e?void 0:e.data)?void 0:l.data,payload:{applicationId:null==(i=null==(n=null==e?void 0:e.data)?void 0:n.data)?void 0:i.applicationId,departmentId:null==(t=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:t.departmentId,status:"",captured:"1",card_id:"",amount:null==(o=null==(d=null==e?void 0:e.data)?void 0:d.data)?void 0:o.amount,payment_method:"upi/netbanking",workflow_id:null==(s=null==(r=null==e?void 0:e.data)?void 0:r.data)?void 0:s.workflowId,user_id:null==(m=null==(c=null==e?void 0:e.data)?void 0:c.data)?void 0:m.userId,ulb_id:null==(v=null==(p=null==e?void 0:e.data)?void 0:p.data)?void 0:v.ulbId,user_id:localStorage.getItem("citizenId"),created_at:""},api:M,returnUrl:"/citizen/waterConnReceipt",isParam:!1}):I(null==(h=null==e?void 0:e.data)?void 0:h.data,$)}).catch(e=>{j(!1),W(e.message,"error")})};let J,V=0;return"yes"==Y.values.isInstallment&&(J=0),"no"==Y.values.isInstallment&&(J=Number(null==(a=null==R?void 0:R.calculation)?void 0:a.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:Y.handleSubmit,onChange:e=>{var l,n,i;const a=e.target.name,t=e.target.value;"no"==t&&Y.setFieldValue("installment",""),"installment"==a&&(null==(l=B(t))?void 0:l.amount)==Number(null==(n=null==R?void 0:R.calculation)?void 0:n.penalty)&&1!=(null==(i=null==R?void 0:R.calculation)?void 0:i.paidStatus)&&(Y.setFieldValue("installment",""),Y.setFieldValue("isInstallment","no"))},children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:()=>{i.closeModal()},className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(p,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(v,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:null==(g=null==U?void 0:U.connectionCharges)?void 0:g.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:["yes"===Y.values.isInstallment&&Number(null==(b=null==R?void 0:R.calculation)?void 0:b.connectionFee)+Number((E=null==(x=B(Y.values.installment))?void 0:x.amount,NaN==E||null==E?0:E))-J,"no"===Y.values.isInstallment&&Number(null==(y=null==R?void 0:R.calculation)?void 0:y.connectionFee)+Number(null==(f=null==R?void 0:R.calculation)?void 0:f.penalty)-J]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",null==(w=null==R?void 0:R.calculation)?void 0:w.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",null==(_=null==R?void 0:R.calculation)?void 0:_.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",null==(k=null==R?void 0:R.calculation)?void 0:k.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",J]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:"yes"===Y.values.isInstallment,onChange:Y.handleChange,onBlur:Y.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:"no"===Y.values.isInstallment,onChange:Y.handleChange,onBlur:Y.handleBlur}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:Y.touched.isInstallment&&Y.errors.isInstallment?Y.errors.isInstallment:null})]})}),e.jsxs("div",{className:("no"===Y.values.isInstallment?"opacity-50":"")+" flex gap-2 disabled:opacity-60",children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:Y.handleChange,disabled:"no"===Y.values.isInstallment,value:Y.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),R&&(null==R?void 0:R.penaltyInstallments.map((l,n)=>(V+=Number(l.balance_amount),e.jsx("option",{value:JSON.stringify({ids:l.ids,amount:V}),children:V},n))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:Y.touched.installment&&Y.errors.installment?Y.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:P?e.jsx(h,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})});var E},w=a=>{var r,s,c,x,y;const{handlePayment:N}=t(),f=l(),[w,_]=n.useState(!1);n.useState();const k=null==a?void 0:a.paymentData;i();const{notify:I}=n.useContext(d),{api_rzpWaterOrderId:C,header:P,api_generatedreceipt:j}=o(),S=()=>{a.closeModal()},z=async e=>{let l={applicationId:null==e?void 0:e.applicationId,departmentId:null==e?void 0:e.departmentId,status:"",captured:"1",card_id:"",amount:null==e?void 0:e.amount,payment_method:"upi/netbanking",workflow_id:null==e?void 0:e.workflowId,user_id:null==e?void 0:e.userId,ulb_id:null==e?void 0:e.ulbId,user_id:localStorage.getItem("citizenId"),payment_order_id:null==e?void 0:e.razorpay_order_id,payment_id:null==e?void 0:e.razorpay_payment_id,created_at:""};m.post(j,l,g()).then(l=>{1==l.data.status?f(`/application-payment-history/${null==e?void 0:e.applicationId}`,{replace:!0}):b.error(l.data.message,"error")}).catch(e=>{b.error(e.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:S,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:[" ",e.jsx(p,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(v,{size:20,className:"mt-0.5 mr-1"}),"Make Payment"," "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No:-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:null==(r=null==k?void 0:k.connectionCharges)?void 0:r.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs:"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:(null==(s=null==k?void 0:k.connectionCharges)?void 0:s.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",null==(c=null==k?void 0:k.connectionCharges)?void 0:c.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",null==(x=null==k?void 0:k.connectionCharges)?void 0:x.penalty]}),e.jsxs("h1",{children:["Connection Fee : ₹ ",null==(y=null==k?void 0:k.connectionCharges)?void 0:y.conn_fee]})]})}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2 max-sm:mb-2",children:e.jsx("div",{className:"flex justify-center",children:w?e.jsx(h,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:()=>{var e,l;_(!0);const n={id:null==(e=null==k?void 0:k.connectionCharges)?void 0:e.applicationId,applycationType:null==(l=null==k?void 0:k.connectionCharges)?void 0:l.type};m.post(C,n,P).then(e=>{var l,n,i,a,t,d,o,r,s,c,m,p,v,h;_(!1),window.ReactNativeWebView?u({generatedOrder:null==(l=null==e?void 0:e.data)?void 0:l.data,payload:{applicationId:null==(i=null==(n=null==e?void 0:e.data)?void 0:n.data)?void 0:i.applicationId,departmentId:null==(t=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:t.departmentId,status:"",captured:"1",card_id:"",amount:null==(o=null==(d=null==e?void 0:e.data)?void 0:d.data)?void 0:o.amount,payment_method:"upi/netbanking",workflow_id:null==(s=null==(r=null==e?void 0:e.data)?void 0:r.data)?void 0:s.workflowId,user_id:null==(m=null==(c=null==e?void 0:e.data)?void 0:c.data)?void 0:m.userId,ulb_id:null==(v=null==(p=null==e?void 0:e.data)?void 0:p.data)?void 0:v.ulbId,user_id:localStorage.getItem("citizenId"),created_at:""},api:j,returnUrl:"/citizen/waterConnReceipt",isParam:!1}):N(null==(h=null==e?void 0:e.data)?void 0:h.data,z)}).catch(e=>{_(!1),I(e.message,"error")})},className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},_={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function k(i){var t,r,s;const[c,m]=a.useState(!1),[u,p]=n.useState(!1),[v,h]=n.useState(),[g,b]=n.useState(),N=l();n.useContext(d),o();const k=i.paymentData;function I(){m(!1),p(!1),h(!1),b(!1),null==i||i.openPaymentModal(!1)}n.useEffect(()=>{m(!0)},[]);const C=e=>{(null==e?void 0:e.status)&&p(!0)};return e.jsx("div",{className:"",children:e.jsxs(x,{isOpen:c,onAfterOpen:function(){},onRequestClose:I,style:_,contentLabel:"Example Modal",children:[u&&e.jsxs("div",{className:(v?"bg-green-200":"bg-yellow-50")+" shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:"flex justify-center",children:[v&&e.jsx("img",{src:y,className:"h-16",alt:"Payment Success",srcset:""}),!v&&e.jsx("img",{src:"/assets/pending-daaf9508.png",className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[v?"Payment Completed Successfully":"Payment Under Processing"," "]}),(null==v?void 0:v.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:null==v?void 0:v.transectionNo})]}),!(null==v?void 0:v.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Transaction Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:(null==(t=null==k?void 0:k.connectionCharges)?void 0:t.applicationNo)||"NA"}),e.jsx("p",{children:(null==(r=null==k?void 0:k.connectionCharges)?void 0:r.charge_category)||"NA"})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(null==v?void 0:v.amount)||(null==(s=null==k?void 0:k.connectionCharges)?void 0:s.amount)}),e.jsx("p",{children:(null==v?void 0:v.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:I,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),v&&e.jsx("button",{onClick:()=>N(`/waterConnReceipt/${null==v?void 0:v.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!v&&e.jsx("button",{onClick:()=>C(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!u&&e.jsx("Regulaization"==(null==i?void 0:i.category)?f:w,{closeModal:I,fetchTransactionDetails:C,paymentData:k})]})})}export{k as W};
