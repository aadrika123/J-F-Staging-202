import{N as Pe,u as Re,r as l,b as oe,o as ie,s as V,g as N,j as e,F as he,t as ue,v as xe,H as me,w as ge,S as je,x as pe,O as Ae,y as J,c as fe,d as I,k as be,P as ye,_ as j,z as Ne,D as $e,J as Fe,B as Ie,G as D,Q as We}from"./index-B8giLIPt.js";import{P as Ue}from"./index-Bt2U7eUv.js";import{T as Me,a as we,b as O,c as h,d as ke,e as u}from"./table-PYFPDVh5.js";import{g as de}from"./services-KQnp_8oA.js";import{P as ve}from"./index-Dz4d8v-Y.js";import{S as Se}from"./index-yOYdZJv3.js";import{D as qe}from"./index-Dbe6xaRi.js";import{q as Le}from"./switch-mQcsElDi.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=Pe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=fe().shape({ulbId:I().required("ulb is required"),moduleId:I().required("Module  is required"),workFlowName:I().required("workFlow Name is required"),parentId:I().notRequired(),levelSerial:I().notRequired()});function Be({open:p,setOpen:x,title:A,edit:v,setEdit:W,refetch:M}){var d,r,o,z,G,C,_,B,T,E,Y;const $=Re({}),[w,S]=l.useState(1),[c,m]=l.useState(10),[F,U]=l.useState("");let f=new URLSearchParams(be().search).get("parentId");const b=oe({resolver:ie(_e)}),n=async()=>{},s=V({api:`${N.getAllUser}?page=${w}&limit=${c}&q=${F}`,key:"getAllUserData",value:[w,c],options:{enabled:!0}}),L=g=>{ye("Are you sure ?","Please confirm",async()=>{var H,Q;const y=await $.mutateAsync({api:N.createWFUserMapping,data:{workflowId:f,userId:g}});(H=y.data)!=null&&H.success?(M(),j.success((Q=y==null?void 0:y.data)==null?void 0:Q.message)):j.error("workflow user not created successfully")}),x(!1)};return e.jsx(qe,{open:p,setOpen:x,title:A,setEdit:W,edit:v,isLoading:s==null?void 0:s.isFetching,children:e.jsx(he,{methods:b,onSubmit:b.handleSubmit(n),children:e.jsx("div",{className:"grid gap-x-2 gap-y-4",children:e.jsxs(ue,{children:[e.jsx("div",{className:"mx-5 p-2",children:e.jsx(Se,{search:F,setPage:S,setSearch:U,refetch:s.refetch,isFetching:s.isLoading})}),e.jsx(xe,{className:"px-7",children:e.jsxs(me,{children:["Workflow Member List (",(r=(d=s.data)==null?void 0:d.data)==null?void 0:r.totalDocs,")"]})}),e.jsx(ge,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(je,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(we,{children:e.jsxs(O,{children:[e.jsx(h,{className:"",children:"#"}),e.jsx(h,{className:"",children:"User Name"}),e.jsx(h,{className:"",children:"Role"}),e.jsx(h,{className:"",children:"Created at"}),e.jsx(h,{children:"Action"})]})}),e.jsx(ke,{children:(G=(z=(o=s==null?void 0:s.data)==null?void 0:o.data)==null?void 0:z.docs)==null?void 0:G.map((g,y)=>e.jsxs(O,{children:[e.jsx(u,{children:y+1}),e.jsx(u,{children:g.fullName}),e.jsx(u,{children:g.role}),e.jsx(u,{children:pe(g.createdAt).format("DD-MM-YYYY")}),e.jsx(u,{className:"",children:e.jsx(Ae,{className:"bg-primary ",onClick:()=>L(g._id),children:"Add Member"})})]},g._id))})]}),e.jsx(J,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ve,{page:w,perPage:c,totalPage:(_=(C=s==null?void 0:s.data)==null?void 0:C.data)==null?void 0:_.totalDocs,hasNextPage:(T=(B=s==null?void 0:s.data)==null?void 0:B.data)==null?void 0:T.hasNextPage,hasPrevPage:(Y=(E=s==null?void 0:s.data)==null?void 0:E.data)==null?void 0:Y.hasPrevPage,setPage:S,setPerPage:m})})]})})]})})})})}const Te=fe().shape({roleName:I().required("Role Name is required")});function Ee({open:p,setOpen:x,title:A,id:v,wrkId:W,edit:M,setEdit:$,refetch:w}){var P,q,f,b;const S=Ne({}),{data:c}=V({api:`${N.getWFUserMappingById}/${W}`,key:"getWFUserMappingById",options:{enabled:M}}),m=oe({defaultValues:{roleName:((P=c==null?void 0:c.data)==null?void 0:P._id)||""},resolver:ie(Te)}),F=async n=>{var s,L;try{const d=await S.mutateAsync({api:`${N.updateWFUserAndMemberMapping}/${v}`,data:{workflowUserMappingId:v,workflowRoleId:n==null?void 0:n.roleName}});(s=d.data)!=null&&s.success?j.success((L=d==null?void 0:d.data)==null?void 0:L.message):j.error("Member Role not updated successfully"),x(!1),$(!1),w()}catch(d){console.log(d)}};l.useEffect(()=>{var n;M?m.reset({roleName:(n=c==null?void 0:c.data)==null?void 0:n._id}):m.reset({roleName:""})},[M,c]);const U=V({api:`${N.getAllWorkFlowRole}?page=1&limit=1000`,key:"getAllWorkFlowRole",options:{enabled:!0}});return e.jsx($e,{open:p,setOpen:x,title:A,setEdit:$,edit:M,children:e.jsx(he,{methods:m,onSubmit:m.handleSubmit(F),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(Fe,{name:"roleName",data:((b=(f=(q=U.data)==null?void 0:q.data)==null?void 0:f.docs)==null?void 0:b.map(n=>({value:n._id,label:n.workFlowRoleName})))??[]})}),e.jsx(J,{}),e.jsx("div",{children:e.jsx(Ie,{isLoading:m.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ye(p){var C,_,B,T,E,Y,g,y,H,Q,K,X,Z,ee,ae;const[x,A]=l.useState(1),[v,W]=l.useState(10),[M,$]=l.useState(""),[w,S]=l.useState(!1),[c,m]=l.useState(!1),[F,U]=l.useState(""),[P,q]=l.useState(""),[f,b]=l.useState(!1),n=Ne({}),d=new URLSearchParams(be().search).get("parentId"),r=V({api:`${N.getAllWFUserMapping}?workflowId=${d}`,key:"getAllWFUserMapping",value:[x,v,d],options:{enabled:!0}}),o=V({api:`${N.checkGeneralActions}`,key:"generalActionPermission",options:{enabled:!0}}),z=async a=>{var R,i,k,se,re,te,le,ce,ne;try{const t=await n.mutateAsync({api:`${(R=N)==null?void 0:R.updateWFUserMappingStatus}/${a}`,data:{id:P}});(i=t==null?void 0:t.data)!=null&&i.success?(r.refetch(),((se=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:se.status)==1&&j.success((re=t.data)==null?void 0:re.message),((le=(te=t==null?void 0:t.data)==null?void 0:te.data)==null?void 0:le.status)==0&&j.error((ce=t.data)==null?void 0:ce.message)):j.error((ne=t.data)==null?void 0:ne.message)}catch(t){j.error(de(t))}};l.useEffect(()=>{p==null||p.settitle()},[]);const G=a=>{ye("Are you sure ?","Please confirm",async()=>{var R;We.delete(`${(R=N)==null?void 0:R.deleteWFUserMapping}/${a}`).then(i=>{var k;j.success((k=i==null?void 0:i.data)==null?void 0:k.message),r.refetch()}).catch(i=>{j.error(de(i))})})};return e.jsxs("main",{className:"grid items-start",children:[w&&e.jsx(Be,{open:w,setOpen:S,title:f?"Edit Workflow Member":"Add Workflow Member",id:P,edit:f,setEdit:b,refetch:r.refetch}),e.jsx(Ee,{open:c,setOpen:m,title:f?"Edit Workflow Member Role":"Add Workflow Member Role",id:P,wrkId:F,edit:f,setEdit:b,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Se,{search:M,setPage:A,setSearch:$,refetch:r.refetch,isFetching:r.isLoading})}),((_=(C=o==null?void 0:o.data)==null?void 0:C.permission)==null?void 0:_.canModifyMembers)&&e.jsx("div",{children:e.jsx(D,{className:"flex items-center gap-2",onClick:()=>S(!0),children:"Add New"})})]}),e.jsxs(ue,{children:[e.jsx(xe,{className:"px-7",children:e.jsxs(me,{children:["Workflow Member List (",(T=(B=r.data)==null?void 0:B.data)==null?void 0:T.totalDocs,")"]})}),e.jsx(ge,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(je,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(we,{children:e.jsxs(O,{children:[e.jsx(h,{className:"",children:"#"}),e.jsx(h,{className:"",children:"Workflow Member"}),e.jsx(h,{className:"",children:"Role"}),((Y=(E=o==null?void 0:o.data)==null?void 0:E.permission)==null?void 0:Y.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"",children:"Created at"}),e.jsx(h,{className:"",children:"Status"}),e.jsx(h,{children:"Action"})]})]})}),e.jsx(ke,{children:(H=(y=(g=r==null?void 0:r.data)==null?void 0:g.data)==null?void 0:y.docs)==null?void 0:H.map((a,R)=>{var i,k;return e.jsxs(O,{children:[e.jsxs(u,{children:[R+1," "]}),e.jsx(u,{className:"font-semibold",children:a.UserName}),e.jsx(u,{children:a.workflowRoleName||"N/A"}),((k=(i=o==null?void 0:o.data)==null?void 0:i.permission)==null?void 0:k.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(u,{children:pe(a.createdAt).format("DD-MM-YYYY")}),e.jsx(u,{children:e.jsxs(Le,{checked:(a==null?void 0:a.status)==1,onChange:()=>z(a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),e.jsxs(u,{className:"space-x-5 ",children:[e.jsx(D,{type:"button",className:"",variant:"secondary",onClick:()=>{q(a._id),U(a==null?void 0:a.workflowRoleId),m(!0),b(!!a.workflowRoleId)},children:a.workflowRoleName?e.jsx("div",{children:" Update Member Role "}):e.jsx("div",{className:"ml-5",children:"Add Member Role"})}),e.jsx(D,{className:"bg-red-500 hover:bg-red-700  pt-2",onClick:()=>G(a._id),children:e.jsx(Ce,{size:18})})]})]})]},a._id)})})]}),e.jsx(J,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ve,{page:x,perPage:v,totalPage:(K=(Q=r==null?void 0:r.data)==null?void 0:Q.data)==null?void 0:K.totalDocs,hasNextPage:(Z=(X=r==null?void 0:r.data)==null?void 0:X.data)==null?void 0:Z.hasNextPage,hasPrevPage:(ae=(ee=r==null?void 0:r.data)==null?void 0:ee.data)==null?void 0:ae.hasPrevPage,setPage:A,setPerPage:W})})]})})]})]})]})}function Ke(){const[p,x]=l.useState("Workflow Member List");return e.jsx(Ue,{title:p||"Workflow Member List",subTitle:"Manage all the work Flow List here",children:e.jsx("div",{className:"py-12",children:e.jsx(Ye,{settitle:x})})})}export{Ke as default};
