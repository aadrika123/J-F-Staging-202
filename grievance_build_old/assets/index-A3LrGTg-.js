import{r as b,a as me,u as de,f as ue,s as h,g as x,b as xe,o as Ne,T as be,U as he,V as ge,W as je,j as s,F as Ie,y as Z,X as ye,Y as fe,Z as Te,$ as ve,a0 as c,J as y,R as N,A as Le,K as Ae,I as ee,B as Fe,c as De,d as r,M as we,k as Ce,_ as se}from"./index-DBck6a3F.js";import{P as Se}from"./index-BseS38rg.js";const ke=De().shape({ulbId:r().required("ULB  is required"),moduleId:r().required("Module  is required"),citizenName:r().required("citizen name is required"),mobileNo:r().required("mobile no. is required"),email:r().required("email is required"),complaintTypeId:r(),priorityId:r(),targetTypeId:r(),complaintTitle:r().required("complaint title is required"),complaintDescription:r().required("complaint description is required"),complaintDocument:we().nullable(),tempNo:r(),fixedNo:r(),isTransactionIssue:r(),transactionNo:r()});function _e(){var D,w,C,S,k,_,R,q,U,$,M,z,E,P,B,V,H,G,O,J,K,Q,W,X,Y;const[le,ie]=b.useState(!1),[L,oe]=b.useState(""),[A,ne]=b.useState(""),{user:i}=me(),ce=de({}),re=ue(),m=new URLSearchParams(Ce().search).get("complaintId"),{data:l,refetch:pe}=h({api:`${(D=x)==null?void 0:D.getComplaintDetailsById}/${m}`,key:"getApplicationDetails",options:{enabled:!!m}}),o=xe({resolver:Ne(ke),defaultValues:{ulbId:(i==null?void 0:i.roleId)===be||(i==null?void 0:i.roleId)===he||(i==null?void 0:i.roleId)===ge||(i==null?void 0:i.roleId)===je?"":i==null?void 0:i.userUlbId,moduleName:""}}),te=async e=>{var d,u,t,a,g,j;try{const n=new FormData;n.append("citizenName",e==null?void 0:e.citizenName),n.append("email",e==null?void 0:e.email),n.append("mobileNo",e==null?void 0:e.mobileNo),n.append("complaintTitle",e==null?void 0:e.complaintTitle),n.append("complaintDescription",e==null?void 0:e.complaintDescription),n.append("ulbName",e==null?void 0:e.ulbName),n.append("moduleId",e==null?void 0:e.moduleId),n.append("ulbId",e==null?void 0:e.ulbId),n.append("imageUrl",e==null?void 0:e.complaintDocument),(e==null?void 0:e.tempNo)!==""&&(e==null?void 0:e.tempNo)!==void 0&&n.append("tempNo",e==null?void 0:e.tempNo),(e==null?void 0:e.fixedNo)!==""&&(e==null?void 0:e.fixedNo)!==void 0&&n.append("fixedNo",e==null?void 0:e.fixedNo),(e==null?void 0:e.tempNoLabel)!==""&&(e==null?void 0:e.tempNoLabel)!==void 0&&n.append("tempNoLabel",e==null?void 0:e.tempNoLabel),(e==null?void 0:e.fixedNoLabel)!==""&&(e==null?void 0:e.fixedNoLabel)!==void 0&&n.append("fixedNoLabel",e==null?void 0:e.fixedNoLabel),e!=null&&e.complaintTypeId&&n.append("complaintTypeId",e==null?void 0:e.complaintTypeId),e!=null&&e.priorityId&&n.append("priorityId",e==null?void 0:e.priorityId),e!=null&&e.targetTypeId&&n.append("targetTypeId",e==null?void 0:e.targetTypeId),n.append("isCitizen","2"),n.append("moduleName",e==null?void 0:e.moduleName);let I=x.createComplaintApplication;m&&(n.append("id",m),I=x.updateComplaintApplication);const p=await ce.mutateAsync({api:I,data:n});if((d=p.data)!=null&&d.success){if(se.success((u=p==null?void 0:p.data)==null?void 0:u.message),m){pe();return}re(`/grievance/dashboard/management-complaint-success?complaintRefNo=${(a=(t=p==null?void 0:p.data)==null?void 0:t.data)==null?void 0:a.complaintRefNo}&complaintId=${(j=(g=p==null?void 0:p.data)==null?void 0:g.data)==null?void 0:j._id}`)}else se.error("Complaint not created successfully");o.reset({ulbId:"",moduleId:""})}catch(n){console.log(n)}};b.useEffect(()=>{var e,d,u,t,a,g,j,n,I,p;m&&l?o.reset({ulbId:((e=l==null?void 0:l.data)==null?void 0:e.ulbId)||"",moduleId:((d=l==null?void 0:l.data)==null?void 0:d.moduleId)||"",citizenName:((u=l==null?void 0:l.data)==null?void 0:u.citizenName)||"",mobileNo:((t=l==null?void 0:l.data)==null?void 0:t.mobileNo)||"",email:((a=l==null?void 0:l.data)==null?void 0:a.email)||"",complaintTypeId:((g=l==null?void 0:l.data)==null?void 0:g.complaintTypeId)||"",priorityId:((j=l==null?void 0:l.data)==null?void 0:j.priorityId)||"",targetTypeId:((n=l==null?void 0:l.data)==null?void 0:n.targetTypeId)||"",complaintTitle:((I=l==null?void 0:l.data)==null?void 0:I.complaintTitle)||"",complaintDescription:((p=l==null?void 0:l.data)==null?void 0:p.complaintDescription)||""}):(o.reset({ulbId:""}),o.reset({moduleId:""}),o.reset({citizenName:""}),o.reset({mobileNo:""}),o.reset({email:""}),o.reset({complaintTypeId:""}),o.reset({priorityId:""}),o.reset({targetTypeId:""}),o.reset({complaintTitle:""}),o.reset({complaintDescription:""}))},[m,l]);const ae=h({api:`${(w=x)==null?void 0:w.getAllUlb}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}}),F=h({api:`${(C=x)==null?void 0:C.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}}),f=h({api:`${(S=x)==null?void 0:S.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),T=h({api:`${(k=x)==null?void 0:k.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}}),v=h({api:`${(_=x)==null?void 0:_.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}});return b.useEffect(()=>{var e,d,u;if(o.watch("moduleId")){const t=(u=(d=(e=F.data)==null?void 0:e.data)==null?void 0:d.docs)==null?void 0:u.find(a=>(a==null?void 0:a._id)===(o==null?void 0:o.watch("moduleId")));ne(t==null?void 0:t.fixedNoLabel),oe(t==null?void 0:t.tempNoLabel)}},[o.watch("moduleId")]),b.useEffect(()=>{ie(o.watch("isTransactionIssue"))},[o.watch("isTransactionIssue")]),s.jsx(Ie,{methods:o,onSubmit:o.handleSubmit(te),children:s.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 bg-background p-10",children:[s.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Basic Info"}),s.jsx(Z,{className:"col-span-4"}),s.jsxs("div",{className:`${((i==null?void 0:i.roleId)===ye||(i==null?void 0:i.roleId)===fe||(i==null?void 0:i.roleId)===Te||(i==null?void 0:i.roleId)===ve)&&"hidden"}`,children:[s.jsxs(c,{htmlFor:"ulbId",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"ULB"]}),s.jsx(y,{className:"bg-background cursor-pointer",name:"ulbId",data:((U=(q=(R=ae.data)==null?void 0:R.data)==null?void 0:q.docs)==null?void 0:U.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.ulbName})))??[]})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"moduleId",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Module"]}),s.jsx(y,{selectedText:"moduleName",className:"bg-background cursor-pointer",name:"moduleId",data:((z=(M=($=F.data)==null?void 0:$.data)==null?void 0:M.docs)==null?void 0:z.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.moduleName})))??[]})]}),A&&s.jsxs("div",{children:[s.jsxs(c,{children:[A,s.jsx("span",{className:"text-xs opacity-80"})]}),s.jsx(N,{name:"fixedNo",placeholder:""})]}),L&&s.jsxs("div",{children:[s.jsxs(c,{children:[L,s.jsx("span",{className:"text-xs opacity-80"})]}),s.jsx(N,{name:"tempNo",placeholder:""})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Citizen Name"]}),s.jsx(N,{className:"bg-background",name:"citizenName",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Mobile No."]}),s.jsx(N,{className:"bg-background",name:"mobileNo",inputValidation:["mobile","number"],placeholder:""})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Email"]}),s.jsx(N,{className:"bg-background",name:"email",inputValidation:["email"],placeholder:""})]}),s.jsxs("div",{children:[s.jsx(c,{htmlFor:"complaintTypeId",children:"Complaint Type"}),s.jsx(y,{className:"bg-background cursor-pointer",name:"complaintTypeId",data:((B=(P=(E=f==null?void 0:f.data)==null?void 0:E.data)==null?void 0:P.docs)==null?void 0:B.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),s.jsxs("div",{children:[s.jsx(c,{htmlFor:"priorityId",children:"Priority"}),s.jsx(y,{className:"bg-background cursor-pointer",name:"priorityId",data:((G=(H=(V=T==null?void 0:T.data)==null?void 0:V.data)==null?void 0:H.docs)==null?void 0:G.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),s.jsxs("div",{children:[s.jsx(c,{htmlFor:"targetTypeId",children:"Target Type"}),s.jsx(y,{className:"bg-background cursor-pointer",name:"targetTypeId",data:((K=(J=(O=v==null?void 0:v.data)==null?void 0:O.data)==null?void 0:J.docs)==null?void 0:K.map(e=>({value:e._id,label:e==null?void 0:e.targetType})))??[]})]}),s.jsx("div",{className:"col-span-4"}),s.jsxs("div",{className:"  flex items-center space-x-2",children:[s.jsx(N,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"isTransactionIssue",placeholder:""}),s.jsx(c,{className:"text-amber-600 opacity-80",children:"Is issue related with financial transaction"})]}),le&&s.jsxs("div",{children:[s.jsx(c,{children:"Transaction No."}),s.jsx(N,{name:"transactionNo",placeholder:""})]}),s.jsx("div",{className:"col-span-4"}),s.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Complaint Info"}),s.jsx(Z,{className:"col-span-4"}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Complain Title"]}),s.jsx(N,{className:"bg-background",name:"complaintTitle",placeholder:""})]}),s.jsx("div",{className:"col-span-4"}),s.jsxs("div",{className:"col-span-3",children:[s.jsxs(c,{htmlFor:"complaintDescription",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Complain Description"]}),s.jsx(Le,{className:"bg-background w-full rounded-md p-4 h-20 border",name:"complaintDescription",placeholder:"write complaint"})]}),s.jsx("div",{className:"col-span-4"}),s.jsxs("div",{className:"col-span-1",children:[s.jsxs(c,{children:["Complaint Document",s.jsx("span",{className:"text-xs opacity-80",children:"(acceptable formats are jpg, jpeg, png, pdf)"})]}),s.jsx(Ae,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"complaintDocument",placeholder:"Select document"})]}),s.jsxs("div",{className:"col-span-1",children:[(((Q=o.watch("complaintDocument"))==null?void 0:Q.type)=="image/png"||((W=o.watch("complaintDocument"))==null?void 0:W.type)=="image/jpg"||((X=o.watch("complaintDocument"))==null?void 0:X.type)=="image/jpeg")&&s.jsx(ee,{className:"w-28",src:URL.createObjectURL(o.watch("complaintDocument"))}),((Y=o.watch("complaintDocument"))==null?void 0:Y.type)=="application/pdf"&&s.jsx(ee,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]}),s.jsx("div",{className:"col-span-4"}),s.jsx("div",{className:"col-span-4",children:s.jsx(Fe,{isLoading:o.formState.isSubmitting,type:"submit",className:" w-auto rounded-xl px-10 float-right",children:m?"Update":"Submit"})})]})})}function Me(){return s.jsx(s.Fragment,{children:s.jsx(Se,{title:"Complaint Details",subTitle:"Complaint Registration Form",children:s.jsx("div",{className:"",children:s.jsx(_e,{})})})})}export{Me as default};
