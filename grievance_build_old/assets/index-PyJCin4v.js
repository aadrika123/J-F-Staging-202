import{r as I,b as xe,o as ue,s as t,g as o,j as a,F as je,y as de,a0 as c,R as A,J as i,B as ge,t as ye,v as be,H as ve,w as Ne,S as fe,x as w,a2 as u,L as Te,G as Ie,c as Ae,d as s}from"./index-DJa4CByP.js";import{T as we,a as Pe,b as ce,c as n,d as $e,e as d}from"./table-D9uG1PwF.js";import{P as Se}from"./index-CiqmYlfa.js";import{P as me}from"./index-BRad_aIw.js";const Le=Ae().shape({ulbId:s(),moduleId:s(),complaintTypeId:s(),priorityId:s(),targetTypeId:s(),complaintSourceTypeId:s(),departmentId:s(),fDate:s(),type:s(),toDate:s(),complaintRefNo:s()});function Re(){var P,$,S,m,L,R,k,D,F,C,_,G,H,M,B,E,Y,U,V,J,O,W,q,z,K,Q,X,Z,ee,ae,le;const[j,te]=I.useState(1),[x,oe]=I.useState(10),r=xe({resolver:ue(Le),defaultValues:{ulbId:"",moduleId:"",complaintTypeId:"",priorityId:"",targetTypeId:"",type:"",complaintSourceTypeId:"",departmentId:"",fDate:"",toDate:"",complaintRefNo:""}});console.log("methods");const pe=async()=>{l.refetch()},l=t({api:`${o.complaintReport}?page=${j}&limit=${x}&priority=${r.watch("priorityId")}&ulb=${r.watch("ulbId")}&departmentId=${r.watch("departmentId")}&complaintType=${r.watch("complaintTypeId")}&targetType=${r.watch("targetTypeId")}&module=${r.watch("moduleId")}&source=${r.watch("complaintSourceTypeId")}&fDate=${r.watch("fDate")}&toDate=${r.watch("toDate")}&complaintRefNo=${r.watch("complaintRefNo")}&type=${r.watch("type")}`,key:"searchAllComplaints",value:[j,x],options:{enabled:!0}});t({api:`${(P=o)==null?void 0:P.getAllUlb}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}}),t({api:`${($=o)==null?void 0:$.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}});const b=t({api:`${(S=o)==null?void 0:S.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),v=t({api:`${(m=o)==null?void 0:m.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}});t({api:`${(L=o)==null?void 0:L.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}});const N=t({api:`${o.getAllComplaintSource}?page=1&limit=10000`,key:"getAllComplaintSource",options:{enabled:!0}}),f=t({api:`${o.getAllDepartment}?page=1&limit=10000`,key:"getAllDepartment",options:{enabled:!0,refetchOnMount:!1}}),T=t({api:`${o.getAllProblemDirect}?page=1&limit=10000`,key:"getProblemData",options:{enabled:!0,refetchOnMount:!1}}),ie=I.useRef(null),he=(e,h)=>{const g=new Date,y=new Date(e),p=(g.getTime()-y.getTime())/(1e3*60*60);return console.log("Time Difference (in hours):",p),console.log("SLA Levels:",h),p<=h.sla1?"L1":p<=h.sla2?"L2":(p<=h.sla3,"L3")};return a.jsxs(a.Fragment,{children:[a.jsx(je,{methods:r,onSubmit:r.handleSubmit(pe),children:a.jsxs("div",{className:"grid grid-cols-6 gap-x-2 gap-y-4 bg-background px-10 py-4",children:[a.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase col-span-4",children:"Grievance Report"}),a.jsx(de,{className:"col-span-6"}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"complaintRefNo",children:"Grievance No."}),a.jsx(A,{name:"complaintRefNo",className:"",placeholder:"Enter Grievance number"})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"fDate",children:"From Date"}),a.jsx(A,{name:"fDate",type:"date",className:""})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"toDate",children:"Upto Date"}),a.jsx(A,{name:"toDate",type:"date",className:""})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"departmentId",children:"Department"}),a.jsx(i,{className:"bg-background cursor-pointer",name:"departmentId",data:((D=(k=(R=f==null?void 0:f.data)==null?void 0:R.data)==null?void 0:k.docs)==null?void 0:D.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.department})))??[]})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"targetTypeId",children:"Grievance Type"}),a.jsx(i,{className:"bg-background cursor-pointer",name:"targetTypeId",data:((_=(C=(F=T==null?void 0:T.data)==null?void 0:F.data)==null?void 0:C.docs)==null?void 0:_.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.problem})))??[]})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"complaintTypeId",children:"Entry Type"}),a.jsx(i,{className:"bg-background cursor-pointer",name:"complaintTypeId",data:((M=(H=(G=b==null?void 0:b.data)==null?void 0:G.data)==null?void 0:H.docs)==null?void 0:M.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"priorityId",children:"Priority"}),a.jsx(i,{className:"bg-background cursor-pointer",name:"priorityId",data:((Y=(E=(B=v==null?void 0:v.data)==null?void 0:B.data)==null?void 0:E.docs)==null?void 0:Y.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"complaintSourceTypeId",children:"Entry Modes"}),a.jsx(i,{className:"bg-background cursor-pointer",name:"complaintSourceTypeId",data:((J=(V=(U=N==null?void 0:N.data)==null?void 0:U.data)==null?void 0:V.docs)==null?void 0:J.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.source})))??[]})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"type",children:"Grievance Status"}),a.jsx(i,{name:"type",data:[{value:"0",label:"Pending"},{value:"1",label:"Resolved"},{value:"2",label:"Rejected"},{value:"3",label:"Pending (Re-Opened)"},{value:"4",label:"Withdrawn"}]})]}),a.jsxs("div",{children:[a.jsx(c,{htmlFor:"type",children:"Level Status"}),a.jsx(i,{name:"type",data:[{value:"L1",label:"L1"},{value:"L2",label:"L2"},{value:"L3",label:"L3"}]})]}),a.jsx("div",{}),a.jsx("div",{className:"mt-6",children:a.jsx(ge,{isLoading:r.formState.isSubmitting,type:"submit",className:" w-auto  px-10 float-right",children:"Search"})})]})}),a.jsx("div",{className:"mt-2",children:a.jsxs(ye,{children:[a.jsx(be,{className:"px-7",children:a.jsxs(ve,{className:"flex justify-between",children:[a.jsxs("h1",{children:["Grievance List (",(W=(O=l.data)==null?void 0:O.data)==null?void 0:W.totalDocs,")"]}),a.jsx("h1",{className:"flex gap-2 "})]})}),a.jsx(Ne,{children:l.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(fe,{})}):a.jsxs("div",{children:[a.jsxs(we,{ref:ie,children:[a.jsx(Pe,{children:a.jsxs(ce,{className:"text-xs",children:[a.jsx(n,{className:"",children:"#"}),a.jsx(n,{className:"",children:"Grievance No."}),a.jsx(n,{className:"",children:"Department"}),a.jsx(n,{className:"",children:"Received Date"}),a.jsx(n,{className:"",children:"Source"}),a.jsx(n,{className:"",children:"Pending At"}),a.jsx(n,{className:"",children:"Redressal Days"}),a.jsx(n,{className:"",children:"Status"}),a.jsx(n,{className:"",children:"Level Status"}),a.jsx(n,{className:"",children:"Priority"}),a.jsx(n,{className:"",children:"View"})]})}),a.jsx($e,{children:(K=(z=(q=l==null?void 0:l.data)==null?void 0:q.data)==null?void 0:z.docs)==null?void 0:K.map((e,h)=>{var g,y,p,re,se,ne;return a.jsxs(ce,{className:"text-xs",children:[a.jsx(d,{children:j*x-x+h+1}),a.jsx(d,{children:(e==null?void 0:e.complaintRefNo)||"N/A"}),a.jsx(d,{children:((g=e==null?void 0:e.department)==null?void 0:g.department)||"N/A"}),a.jsx(d,{children:w(e==null?void 0:e.createdAt).format("DD-MM-YYYY")||"N/A"}),a.jsx(d,{children:((y=e==null?void 0:e.source)==null?void 0:y.source)||"N/A"}),a.jsx(d,{children:(e==null?void 0:e.pendingAt)||"N/A"}),a.jsxs(d,{children:[" ",w().diff(w(e==null?void 0:e.createdAt),"days")," days"]}),a.jsxs(d,{children:[(e==null?void 0:e.wf_status)===4&&a.jsx(u,{variant:"destructive",children:"Closed"}),(e==null?void 0:e.wf_status)===3&&a.jsx(u,{className:"bg-amber-500 text-white",children:"Pending(Re-Opened)"}),(e==null?void 0:e.wf_status)===2&&a.jsx(u,{variant:"destructive",children:"Rejected"}),(e==null?void 0:e.wf_status)===1&&a.jsx(u,{variant:"success",children:"Resolved"}),(e==null?void 0:e.wf_status)===0&&a.jsx(u,{variant:"secondary",children:"Pending"})]}),a.jsx(d,{children:he(e==null?void 0:e.createdAt,{sla1:(p=e==null?void 0:e.problemType)==null?void 0:p.sla1,sla2:(re=e==null?void 0:e.problemType)==null?void 0:re.sla2,sla3:(se=e==null?void 0:e.problemType)==null?void 0:se.sla3})}),a.jsx(d,{children:((ne=e==null?void 0:e.priority)==null?void 0:ne.priorityName)||"N/A"}),a.jsx(d,{children:a.jsx(Te,{to:`/grievance/dashboard/management-complaint-details?complaintRefNo=${e==null?void 0:e.complaintRefNo}
                         &complaintId=${e==null?void 0:e._id}`,children:a.jsx(Ie,{className:"bg-primary",onClick:()=>{},children:"View"})})})]},e._id)})})]}),a.jsx(de,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(Se,{page:j,perPage:x,totalPage:(X=(Q=l==null?void 0:l.data)==null?void 0:Q.data)==null?void 0:X.totalDocs,hasNextPage:(ee=(Z=l==null?void 0:l.data)==null?void 0:Z.data)==null?void 0:ee.hasNextPage,hasPrevPage:(le=(ae=l==null?void 0:l.data)==null?void 0:ae.data)==null?void 0:le.hasPrevPage,setPage:te,setPerPage:oe})})]})})]})})]})}function _e(){return a.jsx(me,{title:"",subTitle:"",children:a.jsx("div",{className:"",children:a.jsx(Re,{})})})}export{_e as default};
