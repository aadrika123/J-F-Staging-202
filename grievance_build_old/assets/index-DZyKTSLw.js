import{K as ve,u as Pe,r as l,b as oe,o as ie,s as H,g as b,j as e,F as he,t as ue,v as me,A as xe,w as pe,D as ge,M as Ae,S as O,c as fe,d as F,k as je,N as be,_ as m,x as ye,G as Re,B as $e,z as G,O as Fe}from"./index-BPLd3KZk.js";import{P as Ie}from"./index-umKarMZc.js";import{T as Ne,a as Me,b as D,c as x,d as we,e as p}from"./table-BZJ3KWET.js";import{g as de}from"./services-KQnp_8oA.js";import{P as ke}from"./index-mRPt8p1x.js";import{S as We}from"./index-YVfI5Jq0.js";import{S as Se}from"./Spinner-DL6YUnjb.js";import{D as Ue}from"./index-C3GWxWpB.js";import{D as qe}from"./index-Dm_ftrZJ.js";import{q as Ce}from"./switch-Dsz5nzAb.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=ve("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=fe().shape({ulbId:F().required("ulb is required"),moduleId:F().required("Module  is required"),workFlowName:F().required("workFlow Name is required"),parentId:F().notRequired(),levelSerial:F().notRequired()});function Be({open:g,setOpen:i,title:I,edit:k,setEdit:W,refetch:y}){var $,c,r,d,V,z,C,L,_,B,T;const P=Pe({}),[N,A]=l.useState(1),[n,h]=l.useState(10),[U]=l.useState("");let R=new URLSearchParams(je().search).get("parentId");const u=oe({resolver:ie(_e)}),M=async()=>{},a=H({api:`${b.getAllUser}?page=${N}&limit=${n}&q=${U}`,key:"getAllUserData",value:[N,n],options:{enabled:!0}}),q=f=>{be("Are you sure ?","Please confirm",async()=>{var E,Y;const j=await P.mutateAsync({api:b.createWFUserMapping,data:{workflowId:R,userId:f}});(E=j.data)!=null&&E.success?(y(),m.success((Y=j==null?void 0:j.data)==null?void 0:Y.message)):m.error("workflow user not created successfully")}),i(!1)};return e.jsx(Ue,{open:g,setOpen:i,title:I,setEdit:W,edit:k,isLoading:a==null?void 0:a.isFetching,children:e.jsx(he,{methods:u,onSubmit:u.handleSubmit(M),children:e.jsx("div",{className:"grid gap-x-2 gap-y-4",children:e.jsxs(ue,{children:[e.jsx(me,{className:"px-7",children:e.jsxs(xe,{children:["Workflow Member List (",(c=($=a.data)==null?void 0:$.data)==null?void 0:c.totalDocs,")"]})}),e.jsx(pe,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(Se,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(Me,{children:e.jsxs(D,{children:[e.jsx(x,{className:"",children:"#"}),e.jsx(x,{className:"",children:"User Name"}),e.jsx(x,{className:"",children:"Created at"}),e.jsx(x,{children:"Action"})]})}),e.jsx(we,{children:(V=(d=(r=a==null?void 0:a.data)==null?void 0:r.data)==null?void 0:d.docs)==null?void 0:V.map((f,j)=>e.jsxs(D,{children:[e.jsx(p,{children:j+1}),e.jsx(p,{children:f.fullName}),e.jsx(p,{children:ge(f.createdAt).format("DD-MM-YYYY")}),e.jsx(p,{className:"",children:e.jsx(Ae,{className:"bg-primary ",onClick:()=>q(f._id),children:"Add Member"})})]},f._id))})]}),e.jsx(O,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ke,{page:N,perPage:n,totalPage:(C=(z=a==null?void 0:a.data)==null?void 0:z.data)==null?void 0:C.totalDocs,hasNextPage:(_=(L=a==null?void 0:a.data)==null?void 0:L.data)==null?void 0:_.hasNextPage,hasPrevPage:(T=(B=a==null?void 0:a.data)==null?void 0:B.data)==null?void 0:T.hasPrevPage,setPage:A,setPerPage:h})})]})})]})})})})}const Te=fe().shape({roleName:F().required("Role Name is required")});function Ee({open:g,setOpen:i,title:I,id:k,wrkId:W,edit:y,setEdit:P,refetch:N}){var S,R,u,M;const A=ye({}),{data:n}=H({api:`${b.getWFUserMappingById}/${W}`,key:"getWFUserMappingById",options:{enabled:y}}),h=oe({defaultValues:{roleName:((S=n==null?void 0:n.data)==null?void 0:S._id)||""},resolver:ie(Te)}),U=async a=>{var q,$;try{const c=await A.mutateAsync({api:`${b.updateWFUserAndMemberMapping}/${k}`,data:{workflowUserMappingId:k,workflowRoleId:a==null?void 0:a.roleName}});(q=c.data)!=null&&q.success?m.success(($=c==null?void 0:c.data)==null?void 0:$.message):m.error("Member Role not updated successfully"),i(!1),P(!1),N()}catch(c){console.log(c)}};l.useEffect(()=>{var a;y?h.reset({roleName:(a=n==null?void 0:n.data)==null?void 0:a._id}):h.reset({roleName:""})},[y,n]);const Q=H({api:`${b.getAllWorkFlowRole}?page=1&limit=1000`,key:"getAllWorkFlowRole",options:{enabled:!0}});return e.jsx(qe,{open:g,setOpen:i,title:I,setEdit:P,edit:y,children:e.jsx(he,{methods:h,onSubmit:h.handleSubmit(U),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(Re,{name:"roleName",data:((M=(u=(R=Q.data)==null?void 0:R.data)==null?void 0:u.docs)==null?void 0:M.map(a=>({value:a._id,label:a.workFlowRoleName})))??[]})}),e.jsx(O,{}),e.jsx("div",{children:e.jsx($e,{isLoading:h.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ye(g){var C,L,_,B,T,f,j,E,Y,K,J,X,Z,ee,ae;const[i,I]=l.useState(1),[k,W]=l.useState(10),[y,P]=l.useState(""),[N,A]=l.useState(!1),[n,h]=l.useState(!1),[U,Q]=l.useState(""),[S,R]=l.useState(""),[u,M]=l.useState(!1),a=ye({}),c=new URLSearchParams(je().search).get("parentId"),r=H({api:`${b.getAllWFUserMapping}?workflowId=${c}`,key:"getAllWFUserMapping",value:[i,k,c],options:{enabled:!0}}),d=H({api:`${b.checkGeneralActions}`,key:"generalActionPermission",options:{enabled:!0}}),V=async s=>{var v,o,w,se,re,te,le,ne,ce;try{const t=await a.mutateAsync({api:`${(v=b)==null?void 0:v.updateWFUserMappingStatus}/${s}`,data:{id:S}});(o=t==null?void 0:t.data)!=null&&o.success?(r.refetch(),((se=(w=t==null?void 0:t.data)==null?void 0:w.data)==null?void 0:se.status)==1&&m.success((re=t.data)==null?void 0:re.message),((le=(te=t==null?void 0:t.data)==null?void 0:te.data)==null?void 0:le.status)==0&&m.error((ne=t.data)==null?void 0:ne.message)):m.error((ce=t.data)==null?void 0:ce.message)}catch(t){m.error(de(t))}};l.useEffect(()=>{g==null||g.settitle()},[]);const z=s=>{be("Are you sure ?","Please confirm",async()=>{var v;Fe.delete(`${(v=b)==null?void 0:v.deleteWFUserMapping}/${s}`).then(o=>{var w;m.success((w=o==null?void 0:o.data)==null?void 0:w.message),r.refetch()}).catch(o=>{m.error(de(o))})})};return e.jsxs("main",{className:"grid items-start",children:[N&&e.jsx(Be,{open:N,setOpen:A,title:u?"Edit Workflow Member":"Add Workflow Member",id:S,edit:u,setEdit:M,refetch:r.refetch}),e.jsx(Ee,{open:n,setOpen:h,title:u?"Edit Workflow Member Role":"Add Workflow Member Role",id:S,wrkId:U,edit:u,setEdit:M,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(We,{search:y,setSearch:P,refetch:r.refetch,isFetching:r.isLoading})}),((L=(C=d==null?void 0:d.data)==null?void 0:C.permission)==null?void 0:L.canModifyMembers)&&e.jsx("div",{children:e.jsx(G,{className:"flex items-center gap-2",onClick:()=>A(!0),children:"Add New"})})]}),e.jsxs(ue,{children:[e.jsx(me,{className:"px-7",children:e.jsxs(xe,{children:["Workflow Member List (",(B=(_=r.data)==null?void 0:_.data)==null?void 0:B.totalDocs,")"]})}),e.jsx(pe,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(Se,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(Me,{children:e.jsxs(D,{children:[e.jsx(x,{className:"",children:"#"}),e.jsx(x,{className:"",children:"Workflow Member"}),e.jsx(x,{className:"",children:"Role"}),((f=(T=d==null?void 0:d.data)==null?void 0:T.permission)==null?void 0:f.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"",children:"Created at"}),e.jsx(x,{className:"",children:"Status"}),e.jsx(x,{children:"Action"})]})]})}),e.jsx(we,{children:(Y=(E=(j=r==null?void 0:r.data)==null?void 0:j.data)==null?void 0:E.docs)==null?void 0:Y.map((s,v)=>{var o,w;return e.jsxs(D,{children:[e.jsxs(p,{children:[v+1," "]}),e.jsx(p,{className:"font-semibold",children:s.UserName}),e.jsx(p,{children:s.workflowRoleName||"N/A"}),((w=(o=d==null?void 0:d.data)==null?void 0:o.permission)==null?void 0:w.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(p,{children:ge(s.createdAt).format("DD-MM-YYYY")}),e.jsx(p,{children:e.jsxs(Ce,{checked:(s==null?void 0:s.status)==1,onChange:()=>V(s._id),className:`${s!=null&&s.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${s!=null&&s.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),e.jsxs(p,{className:"space-x-5 ",children:[e.jsx(G,{type:"button",className:"",variant:"secondary",onClick:()=>{R(s._id),Q(s==null?void 0:s.workflowRoleId),h(!0),M(!!s.workflowRoleId)},children:s.workflowRoleName?e.jsx("div",{children:" Update Member Role "}):e.jsx("div",{className:"ml-5",children:"Add Member Role"})}),e.jsx(G,{className:"bg-red-500 hover:bg-red-700  pt-2",onClick:()=>z(s._id),children:e.jsx(Le,{size:18})})]})]})]},s._id)})})]}),e.jsx(O,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ke,{page:i,perPage:k,totalPage:(J=(K=r==null?void 0:r.data)==null?void 0:K.data)==null?void 0:J.totalDocs,hasNextPage:(Z=(X=r==null?void 0:r.data)==null?void 0:X.data)==null?void 0:Z.hasNextPage,hasPrevPage:(ae=(ee=r==null?void 0:r.data)==null?void 0:ee.data)==null?void 0:ae.hasPrevPage,setPage:I,setPerPage:W})})]})})]})]})]})}function Ze(){const[g,i]=l.useState("Workflow Member List");return e.jsx(Ie,{title:g||"Workflow Member List",subTitle:"Manage all the work Flow List here",children:e.jsx("div",{className:"py-12",children:e.jsx(Ye,{settitle:i})})})}export{Ze as default};
