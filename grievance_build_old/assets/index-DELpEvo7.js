import{u as X,x as O,s as Q,g as y,b as ee,o as ae,r as p,j as e,F as ie,R as te,y as se,Z as Y,G,H as ne,S as W,B as ce,c as re,d as J,a9 as V,J as de,_ as m,z as Z,t as oe,v as le,A as me,w as ue,I as pe,D as he}from"./index-BPLd3KZk.js";import{P as xe}from"./index-umKarMZc.js";import{T as fe,a as ge,b as K,c as o,d as je,e as l}from"./table-BZJ3KWET.js";import{D as Ne}from"./index-Dm_ftrZJ.js";import{g as ye}from"./services-KQnp_8oA.js";import{P as Se}from"./index-mRPt8p1x.js";import{S as be}from"./index-YVfI5Jq0.js";import{S as Te}from"./Spinner-DL6YUnjb.js";import{q as ve}from"./switch-Dsz5nzAb.js";const we=re().shape({title:J().required("Title  is required"),description:J().required("Description is required"),notificationSide:V().required("Notification Side is required"),notificationType:V().required("Notification Type is required"),imageUrl:de().nullable()});function Pe({open:h,setOpen:S,title:w,id:d,edit:u,setEdit:x,refetch:P}){const F=X({}),f=O({}),{data:n,isFetching:$}=Q({api:`${y.getNotificationById}/${d}`,key:"getNotificationById",options:{enabled:u}}),c=ee({defaultValues:{title:"",description:"",notificationSide:"",notificationType:""},resolver:ae(we)}),b=async a=>{var T,g,j,N;const r=new FormData;r.append("title",a.title),r.append("description",a.description),r.append("notificationSide",a.notificationSide),r.append("notificationType",String(a==null?void 0:a.notificationType)),r.append("imageUrl",a.imageUrl);try{if(u&&a){const t=await f.mutateAsync({api:`${y.updateNotification}/${d}`,data:r});(T=t.data)!=null&&T.success?m.success((g=t==null?void 0:t.data)==null?void 0:g.message):m.error("Notification not updated successfully")}else{const t=await F.mutateAsync({api:y.createNotification,data:r});(j=t.data)!=null&&j.success?m.success((N=t==null?void 0:t.data)==null?void 0:N.message):m.error("Notification not created successfully"),c.reset({title:"",description:"",notificationSide:"",notificationType:""})}S(!1),x(!1),P()}catch(t){console.log(t)}};return p.useEffect(()=>{u&&n?c.reset({title:n.data.title,description:n.data.description,notificationSide:n.data.notificationSide,notificationType:n.data.notificationType,imageUrl:n.data.imageUrl}):c.reset({title:"",description:"",notificationSide:"",notificationType:""})},[u,n]),e.jsx(Ne,{open:h,setOpen:S,title:w,setEdit:x,edit:u,isLoading:$,children:e.jsx(ie,{methods:c,onSubmit:c.handleSubmit(b),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(te,{name:"title",placeholder:"Enter your Title"})}),e.jsx("div",{children:e.jsx(se,{name:"description",placeholder:"Enter your description"})}),e.jsx(Y,{htmlFor:"notificationSide",children:"Notification Side"}),e.jsx("div",{children:e.jsx(G,{name:"notificationSide",data:[{value:"1",label:"Citizen"},{value:"0",label:"management"}]})}),e.jsx(Y,{htmlFor:"notificationType",children:"Notification Type"}),e.jsx("div",{children:e.jsx(G,{name:"notificationType",data:[{value:"0",label:"Notification"},{value:"1",label:"Recent News"}]})}),e.jsx("div",{children:e.jsx(ne,{name:"imageUrl",placeholder:"Upload your Images"})}),e.jsx(W,{}),e.jsx("div",{children:e.jsx(ce,{isLoading:c.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Fe(){var g,j,N,t,C,A,q,E,I,R,U;const[h,S]=p.useState(1),w=O({}),[d,u]=p.useState(10),[x,P]=p.useState(""),[F,f]=p.useState(!1),[n,$]=p.useState(""),[c,b]=p.useState(!1),a=Q({api:`${y.getAllNotification}?page=${h}&limit=${d}&q=${x}`,key:"getAllNotification",value:[h,d],options:{enabled:!0}}),r=i=>{b(!0),f(!0),$(i)},T=async i=>{var v,k,H,M,B,L,_,z,D;try{const s=await w.mutateAsync({api:`${(v=y)==null?void 0:v.updateNotificationStatus}/${i}`,data:{id:n}});(k=s==null?void 0:s.data)!=null&&k.success?(a.refetch(),((M=(H=s==null?void 0:s.data)==null?void 0:H.data)==null?void 0:M.status)==1&&m.success((B=s.data)==null?void 0:B.message),((_=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:_.status)==0&&m.error((z=s.data)==null?void 0:z.message)):m.error((D=s.data)==null?void 0:D.message)}catch(s){m.error(ye(s))}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(Pe,{open:F,setOpen:f,title:c?"Edit News":"Add News",id:n,edit:c,setEdit:b,refetch:a.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(be,{search:x,setSearch:P,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx("div",{children:e.jsx(Z,{className:"flex items-center gap-2",onClick:()=>f(!0),children:"Add New"})})]}),e.jsxs(oe,{children:[e.jsx(le,{className:"px-7",children:e.jsxs(me,{children:["News List (",(j=(g=a.data)==null?void 0:g.data)==null?void 0:j.totalDocs,")"]})}),e.jsx(ue,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(Te,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(fe,{children:[e.jsx(ge,{children:e.jsxs(K,{children:[e.jsx(o,{className:"",children:"#"}),e.jsx(o,{className:"",children:"Images"}),e.jsx(o,{className:"",children:"Title"}),e.jsx(o,{className:"",children:"Notification Side"}),e.jsx(o,{className:"",children:"Notification Type"}),e.jsx(o,{className:"",children:"Created at"}),e.jsx(o,{className:"",children:"Status"}),e.jsx(o,{children:"Action"})]})}),e.jsx(je,{children:(C=(t=(N=a==null?void 0:a.data)==null?void 0:N.data)==null?void 0:t.docs)==null?void 0:C.map((i,v)=>e.jsxs(K,{children:[e.jsx(l,{children:h*d-d+v+1}),e.jsx(l,{style:{margin:5,width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",padding:0},children:e.jsx(pe,{src:i==null?void 0:i.fullImgUrl,alt:i.imageUrl,className:"h-12 w-12 rounded-full"})}),e.jsx(l,{children:i.title}),e.jsx(l,{children:i.notificationSide==0?"Management":"Citizen"}),e.jsx(l,{children:i.notificationType==0?"Notification":"Recent News"}),e.jsx(l,{children:he(i.createdAt).format("DD-MM-YYYY")}),e.jsx(l,{children:e.jsxs(ve,{checked:(i==null?void 0:i.status)==1,onChange:()=>T(i._id),className:`${i!=null&&i.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${i!=null&&i.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(l,{children:e.jsx(Z,{onClick:()=>r(i._id),children:"Edit"})})]},i._id))})]}),e.jsx(W,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(Se,{page:h,perPage:d,totalPage:(q=(A=a==null?void 0:a.data)==null?void 0:A.data)==null?void 0:q.totalDocs,hasNextPage:(I=(E=a==null?void 0:a.data)==null?void 0:E.data)==null?void 0:I.hasNextPage,hasPrevPage:(U=(R=a==null?void 0:a.data)==null?void 0:R.data)==null?void 0:U.hasPrevPage,setPage:S,setPerPage:u})})]})})]})]})]})}function He(){return e.jsx(xe,{title:"News List",subTitle:"Manage all the News here",children:e.jsx("div",{className:"py-12",children:e.jsx(Fe,{})})})}export{He as default};
