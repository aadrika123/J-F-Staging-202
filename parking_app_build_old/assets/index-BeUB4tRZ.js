import{u as S,j as e,C as V,p as q,_ as d}from"./index-DpHqwdtG.js";import{u as F,r as l}from"./router-DLL89Qev.js";import{u as E}from"./useCustomQuery-BSIQ25LZ.js";import{P as C}from"./index-BjjuLB76.js";import{s as H}from"./index-DXEukT1i.js";import{o as I,c as P,a as c}from"./yup-Bw0qBjzS.js";import{b as Y,F as z,R as u,B}from"./switch-C_UWQcPx.js";import{h}from"./moment-BjLXg0w5.js";import{S as A}from"./separator-Cs7eiq44.js";import{u as D}from"./useScheduleIncharge-CA5cxT5p.js";import"./axios-DmypytPv.js";import"./headlessui-DXpdh5LM.js";const L=P().shape({vehicleType:c().required("Vehicle Type is required"),vehicleNumber:c().required("Vehicle Number is required"),date:c().required("Date is required"),inTime:c().required("In Time is required")});function ae(){var x;const b=F(),p=E({}),o=D(),{user:n}=S(),[m]=l.useState(),[M,f]=l.useState(!1),[R,T]=l.useState(null),t=Y({defaultValues:{vehicleType:"",vehicleNumber:"",date:h().format("YYYY-MM-DD"),inTime:h().format("HH:mm")},resolver:I(L)}),{handleSubmit:N}=t,_=async a=>{var s,r,g,v,w,y,j;if(await V("Are you sure you want to book ticket?",{title:"Please Confirm",subTitle:"You will be redirected to receipt page",buttonTitle:"Yes, I am sure"}))try{const i=await p.mutateAsync({api:(s=q)==null?void 0:s.bookTicket,data:{vehicle_no:a.vehicleNumber,vehicle_type:a.vehicleType,type_parking_space:"Organized",incharge_id:n==null?void 0:n.emp_id,area_id:(v=(g=(r=o==null?void 0:o.data)==null?void 0:r.data)==null?void 0:g.data[0])==null?void 0:v.location_id,in_time:h().format("HH:mm")}});(w=i==null?void 0:i.data)!=null&&w.success?(d.success("Ticket Booked Successfully"),b(`/parking-app/in-receipt?receipt_no=${(j=(y=i==null?void 0:i.data)==null?void 0:y.data)==null?void 0:j.receipt_no}`,{replace:!0})):d.error("Something went wrong")}catch{d.error("Something went wrong")}},k=async()=>{f(!0),T(null);const a=await H.createWorker({});await a.load(),await a.loadLanguage("eng"),await a.initialize("eng");const{data:{text:s}}=await a.recognize(m),r=s.split(`
`);t.setValue("vehicleNumber",r&&r.length>0?r[0].trim():""),await a.terminate(),f(!1)};return l.useEffect(()=>{m&&k()},[m]),e.jsx(C,{title:"Home",children:e.jsx("div",{className:"py-8 mx-auto px-4",children:e.jsx("div",{children:e.jsx("div",{className:"px-8",children:e.jsxs(z,{methods:t,onSubmit:N(_),children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex justify-center items-center gap-1 ",children:[e.jsx("input",{type:"radio",id:"two_wheeler",name:"vehicleType",value:"two_wheeler",className:"w-4 h-4",onChange:a=>t.setValue("vehicleType",a.target.value),checked:t.watch("vehicleType")==="two_wheeler"}),e.jsx("label",{htmlFor:"two_wheeler",className:"text-gray-800 text-sm font-semibold",children:"Two Wheeler"})]}),e.jsxs("div",{className:"flex justify-center items-center gap-1 ",children:[e.jsx("input",{type:"radio",id:"four_wheeler",name:"vehicleType",value:"four_wheeler",className:"w-4 h-4",onChange:a=>t.setValue("vehicleType",a.target.value),checked:t.watch("vehicleType")==="four_wheeler"}),e.jsx("label",{htmlFor:"four_wheeler",className:"text-gray-800 text-sm font-semibold",children:"Four Wheeler"})]})]}),(t==null?void 0:t.formState.errors.vehicleType)&&!(t!=null&&t.watch("vehicleType"))&&e.jsx("small",{className:"text-red-500 text-xs flex justify-center mt-2",children:(x=t==null?void 0:t.formState.errors.vehicleType)==null?void 0:x.message})]}),e.jsx("div",{className:"py-3",children:e.jsx(A,{})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 w-full",children:[e.jsx("div",{children:e.jsx(u,{className:"w-full h-10 border border-gray-300 rounded-lg",name:"vehicleNumber",label:"Vehicle Number",placeholder:"Enter Vehicle Number",inputValidation:["removeSpace","Uppercase","vehicleNumber"]})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"date",label:"Date",type:"date",placeholder:"Enter Date"})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"inTime",type:"time",label:"In Time",placeholder:"Enter In Time"})}),e.jsx("div",{className:"flex justify-center w-full mt-4",children:e.jsx(B,{isLoading:p.isPending,type:"submit",size:"sm",className:"w-full",children:"Book Ticket"})})]})]})})})})})}export{ae as default};
