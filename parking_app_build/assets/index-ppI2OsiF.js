import{u as V,j as e,C as q,p as F,_ as d}from"./index-BnXRY-Ni.js";import{u as C,r as l}from"./router-DLL89Qev.js";import{u as E}from"./useCustomQuery-B_kJ_PS9.js";import{P as H}from"./index-Dc-eSCVp.js";import{s as I}from"./index-DXEukT1i.js";import{o as P,c as Y,a as c}from"./yup-mk4M_ysM.js";import{b as z,F as B,R as u,B as A}from"./switch-Bi1QhvMI.js";import{h as p}from"./moment-BjLXg0w5.js";import{S as D}from"./separator-lcNwpbji.js";import{u as L}from"./useScheduleIncharge-CzP1HQaW.js";import"./axios-DmypytPv.js";import"./headlessui-DXpdh5LM.js";const M=Y().shape({vehicleType:c().required("Vehicle Type is required"),vehicleNumber:c().required("Vehicle Number is required"),date:c().required("Date is required"),inTime:c().required("In Time is required")});function ie(){var f;const T=C(),h=E({}),o=L(),{user:n}=V(),[m]=l.useState(),[R,x]=l.useState(!1),[W,N]=l.useState(null),a=z({defaultValues:{vehicleType:"",vehicleNumber:"",date:p().format("YYYY-MM-DD"),inTime:p().format("HH:mm")},resolver:P(M)}),{handleSubmit:_}=a,k=async t=>{var s,r,g,v,y,w,j,b;if(await q("Are you sure you want to book ticket?",{title:"Please Confirm",subTitle:"You will be redirected to receipt page",buttonTitle:"Yes, I am sure"}))try{const i=await h.mutateAsync({api:(s=F)==null?void 0:s.bookTicket,data:{vehicle_no:t.vehicleNumber.toUpperCase(),vehicle_type:t.vehicleType,type_parking_space:"Organized",incharge_id:n==null?void 0:n.emp_id,area_id:(v=(g=(r=o==null?void 0:o.data)==null?void 0:r.data)==null?void 0:g.data[0])==null?void 0:v.location_id,in_time:p().format("HH:mm")}});(y=i==null?void 0:i.data)!=null&&y.success?(d.success("Ticket Booked Successfully"),T(`/parking-app/in-receipt?receipt_no=${(j=(w=i==null?void 0:i.data)==null?void 0:w.data)==null?void 0:j.receipt_no}`,{replace:!0})):d.error((b=i==null?void 0:i.data)==null?void 0:b.message)}catch{d.error("Something went wrong")}},S=async()=>{x(!0),N(null);const t=await I.createWorker({});await t.load(),await t.loadLanguage("eng"),await t.initialize("eng");const{data:{text:s}}=await t.recognize(m),r=s.split(`
`);a.setValue("vehicleNumber",r&&r.length>0?r[0].trim():""),await t.terminate(),x(!1)};return l.useEffect(()=>{m&&S()},[m]),e.jsx(H,{title:"Home",children:e.jsx("div",{className:"py-8 mx-auto px-4",children:e.jsx("div",{children:e.jsx("div",{className:"px-8",children:e.jsxs(B,{methods:a,onSubmit:_(k),children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex justify-center items-center gap-1 ",children:[e.jsx("input",{type:"radio",id:"two_wheeler",name:"vehicleType",value:"two_wheeler",className:"w-4 h-4",onChange:t=>a.setValue("vehicleType",t.target.value),checked:a.watch("vehicleType")==="two_wheeler"}),e.jsx("label",{htmlFor:"two_wheeler",className:"text-gray-800 text-sm font-semibold",children:"Two Wheeler"})]}),e.jsxs("div",{className:"flex justify-center items-center gap-1 ",children:[e.jsx("input",{type:"radio",id:"four_wheeler",name:"vehicleType",value:"four_wheeler",className:"w-4 h-4",onChange:t=>a.setValue("vehicleType",t.target.value),checked:a.watch("vehicleType")==="four_wheeler"}),e.jsx("label",{htmlFor:"four_wheeler",className:"text-gray-800 text-sm font-semibold",children:"Four Wheeler"})]})]}),(a==null?void 0:a.formState.errors.vehicleType)&&!(a!=null&&a.watch("vehicleType"))&&e.jsx("small",{className:"text-red-500 text-xs flex justify-center mt-2",children:(f=a==null?void 0:a.formState.errors.vehicleType)==null?void 0:f.message})]}),e.jsx("div",{className:"py-3",children:e.jsx(D,{})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 w-full",children:[e.jsx("div",{children:e.jsx(u,{type:"text",className:"w-full h-10 border border-gray-300 rounded-lg uppercase",name:"vehicleNumber",label:"Vehicle Number",placeholder:"Enter Vehicle Number",inputValidation:["removeSpace","vehicleNumber"]})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"date",label:"Date",type:"date",placeholder:"Enter Date"})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"inTime",type:"time",label:"In Time",placeholder:"Enter In Time"})}),e.jsx("div",{className:"flex justify-center w-full mt-4",children:e.jsx(A,{isLoading:h.isPending,type:"submit",size:"sm",className:"w-full",children:"Book Ticket"})})]})]})})})})})}export{ie as default};
