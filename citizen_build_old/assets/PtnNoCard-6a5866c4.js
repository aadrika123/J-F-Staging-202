import{j as a}from"./mui-8bd1858b.js";import{r as i,u as te}from"./router-56e993c5.js";import{M as ae,z as le,c as oe,d as w,u as ne,D as se,L as ie,A as de,n as v,b as P,k as M,E as re}from"./index-150a104f.js";import{a as A}from"./axios-ab7cc016.js";import"./reactIcons-d26c0b2d.js";import"./materialTailwind-92b297b6.js";import"./moment-a9aaa855.js";/* empty css                */import"./redux-a3f69129.js";import"./i18next-2edfafb0.js";ae.setAppElement("#root");function Se(n){i.useState(!0);const[j,g]=i.useState(!1),[y,h]=i.useState(!1),[N,S]=i.useState(""),{api_sendMobileOtpAttachment:F,api_verifyHolding:ce,api_filterPropertyDetails:k,api_getAllUlb:V,header:T}=re(),{notify:m}=i.useContext(le);te();const[O,L]=i.useState(!1),[z,D]=i.useState(null),[q,R]=i.useState(""),[ue,W]=i.useState(""),[b,p]=i.useState([]),[ge,$]=i.useState(""),[G,J]=i.useState([]),[x,I]=i.useState(!1),K=()=>{I(!0),de.get(V,{},T).then(t=>{var o,e;(o=t==null?void 0:t.data)!=null&&o.status?J(((e=t==null?void 0:t.data)==null?void 0:e.data)||[]):m("Failed to fetch ULB list","error")}).catch(t=>{console.log("Error while fetching ulb list",t),m("Error occurred while fetching ULB list","error")}).finally(()=>I(!1))};i.useEffect(()=>{K()},[]);const Q=oe({ptn:w(),holdingNo:w(),ulbId:w().required("Please select ULB")}),l=ne({initialValues:{ptn:"",holdingNo:"",ulbId:""},onSubmit:t=>{console.log("at submit form.....",t)},validationSchema:Q}),f=(t,o,e)=>{const s=t!==""&&t!==null&&t!==void 0,d=o&&o.length>=14,r=e&&e.length>=14;return s&&(d||r)},E=t=>{let o=t.target.name,e=t.target.value;if(o==="ulbId"){$(e),l.setFieldValue("ulbId",e),p([]);const s=f(e,l.values.ptn,l.values.holdingNo);h(s)}if(o=="ptn"){l.setFieldValue("holdingNo",""),n==null||n.setholdingNo(""),l.setFieldValue("ptn",e);const s=f(l.values.ulbId,e,"");h(s)}else if(o=="holdingNo"){l.setFieldValue("ptn",""),n==null||n.setptnNo(""),l.setFieldValue("holdingNo",e);const s=f(l.values.ulbId,"",e);h(s)}N&&S("")},X=t=>{L(!1),g(!0),h(!1);let o;t.ptn.length==0?o={holdingNo:t.holdingNo,ulbId:t.ulbId}:o={ptNo:t.ptn,ulbId:t.ulbId},console.log("before send otp for attachment...",o),A.post(F,o,P()).then(e=>{var s,d,r,u;console.log("otp send for attachment response",e==null?void 0:e.data),(s=e==null?void 0:e.data)!=null&&s.status?(n==null||n.setpropertyAttachedMobileNo((r=(d=e==null?void 0:e.data)==null?void 0:d.data)==null?void 0:r.mobileNo),n==null||n.setptnCardStatus(!1),n==null||n.setotpCardStatus(!0)):c(!0,M((u=e==null?void 0:e.data)==null?void 0:u.message)),g(!1)}).catch(e=>{console.log("error otp send",e),m("Something went wrong in attachment...","error"),g(!1),c(!0,"Error occured. Please try again later."),h(!0)})},c=(t,o)=>{D(o),L(t)},Y=(t,o,e)=>{if(l.values.holdingNo==""&&l.values.ptn==""){c(!0,"Enter holding or pt no.");return}if(!l.values.ulbId||l.values.ulbId===""){c(!0,"Please select ULB.");return}console.log("attach holding => ",t,o,e),R(""),console.log("otp send..."),g(!0),h(!1),o?n==null||n.setholdingNo(o):n==null||n.setptnNo(t),X(l.values)},Z=[{Header:"Ward No.",accessor:"ward_name"},{Header:"Owner's Name",accessor:"owner_name"},{Header:"PT No.",accessor:"pt_no",Cell:({cell:t})=>a.jsx("span",{children:v(t.row.original.pt_no)})},{Header:"Holding No",accessor:"new_holding_no",Cell:({cell:t})=>a.jsx("span",{children:v(t.row.original.new_holding_no)})},{Header:"Mobile No",accessor:"mobile_no",Cell:({cell:t})=>a.jsx("span",{children:v(t.row.original.mobile_no)})},{Header:"Action",accessor:"id",Cell:({cell:t})=>a.jsx("button",{onClick:()=>{var o,e,s,d,r,u;return Y((e=(o=t==null?void 0:t.row)==null?void 0:o.original)==null?void 0:e.pt_no,(d=(s=t==null?void 0:t.row)==null?void 0:s.original)==null?void 0:d.new_holding_no,(u=(r=t==null?void 0:t.row)==null?void 0:r.original)==null?void 0:u.ulb_id)},className:"bg-indigo-500 px-3 py-1 rounded-lg shadow-lg hover:shadow-xl hover:bg-indigo-700 text-white",children:"Attach"})}],ee=()=>{var o;if(!l.values.ulbId||l.values.ulbId===""){S("Please select ULB.");return}let t;(o=Object.entries(l==null?void 0:l.values))==null||o.map(([e,s],d)=>{s!=""&&e!=="ulbId"&&(t={filteredBy:e,parameter:s,isLegacy:!1,page:1,perPage:100,ulbId:l.values.ulbId},W(e))}),g(!0),console.log("getting body => ",t),A.post(k,t,P()).then(e=>{var s,d,r,u,C,_,U,B,H;console.log("holding list => ",(d=(s=e==null?void 0:e.data)==null?void 0:s.data)==null?void 0:d.data),(r=e==null?void 0:e.data)!=null&&r.status?(p((C=(u=e==null?void 0:e.data)==null?void 0:u.data)==null?void 0:C.data),((B=(U=(_=e==null?void 0:e.data)==null?void 0:_.data)==null?void 0:U.data)==null?void 0:B.length)==0&&c(!0,"No Data Found !!!")):c(!0,M((H=e==null?void 0:e.data)==null?void 0:H.message))}).catch(e=>{console.log("error getting holding list => ",e),c(!0,"Error occurred while fetching data.")}).finally(()=>g(!1))};return a.jsxs(a.Fragment,{children:[O&&a.jsx(se,{activateBottomErrorCard:c,errorTitle:z}),a.jsx("div",{class:"w-full sm:w-full  mx-auto",children:a.jsx("div",{class:"container mx-auto",children:a.jsxs("div",{class:"mx-auto flex flex-wrap gap-4 justify-center items-center",children:[a.jsx("div",{class:"w-max bg-white rounded text-center shadow-xl relative py-10 px-8",children:a.jsxs("div",{class:"",children:[a.jsx("button",{onClick:()=>n==null?void 0:n.closeModal(!1),type:"button",class:"absolute top-6 right-6 bg-transparent bg-gray-200 text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center shadow-sm  hover:bg-red-200 hover:border-none",children:a.jsx("svg",{class:"w-5 h-5",fill:"currentColor",children:a.jsx("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})})}),a.jsx("div",{class:"text-2xl font-bold px-10",children:"Enter Holding or PT no."}),a.jsx("div",{class:"flex flex-col mt-4 text-center",children:a.jsxs("span",{className:"text-center",children:["Select ULB and enter 14 digit PTN no, or Holding no.",a.jsx("br",{}),"to attach a property"]})}),a.jsx("div",{class:"flex flex-col mt-4 text-center",children:a.jsx("span",{className:"text-center text-red-400",children:q})}),a.jsx("div",{class:"flex flex-row justify-center text-center mt-5",children:a.jsxs("form",{onSubmit:l.handleSubmit,onChange:E,children:[a.jsxs("div",{className:"mb-4",children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold w-full text-left",children:["Select ULB",a.jsx("span",{className:"text-red-600",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsxs("select",{name:"ulbId",value:l.values.ulbId,onChange:E,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md appearance-none",disabled:x,children:[a.jsx("option",{value:"",children:x?"Loading ULBs...":"Select ULB"}),!x&&G.map(t=>a.jsx("option",{value:t.id,children:t.ulb_name||t.name},t.id))]}),x&&a.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-600"})})]}),l.touched.ulbId&&l.errors.ulbId&&a.jsx("div",{className:"text-red-500 text-xs mt-1",children:l.errors.ulbId})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold w-full text-left",children:["PTN",a.jsx("span",{className:"text-red-600",children:"*"})]}),a.jsx("input",{type:"text",...l.getFieldProps("ptn"),className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})]}),a.jsx("div",{className:"font-semibold text-indigo-500 mt-2",children:"Or"}),a.jsxs("div",{children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold w-full text-left",children:["Holding No.",a.jsx("span",{className:"text-red-600",children:"*"})]}),a.jsx("input",{type:"text",...l.getFieldProps("holdingNo"),className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})]}),a.jsx("div",{className:"text-red-500 mt-4",children:N}),a.jsxs("div",{class:"w-full text-center mt-4",children:[y&&!x&&a.jsx("button",{type:"button",onClick:ee,disabled:j,className:"w-full  py-2.5 bg-indigo-600 text-white font-medium text-xs leading-tight  rounded shadow-md hover:bg-indigo-700 hover:shadow-lg focus:bg-indigo-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-indigo-800 active:shadow-lg transition duration-150 ease-in-out",children:j?"Fetching...":"Submit"}),(!y||x)&&a.jsx("button",{type:"button",className:"w-full  py-2.5 bg-gray-400 text-white font-medium text-xs leading-tight  rounded shadow-md  hover:shadow-lg  focus:shadow-lg focus:outline-none focus:ring-0  transition duration-150 ease-in-out cursor-default ",children:"Submit"})]})]})})]})}),(b==null?void 0:b.length)>0&&a.jsx("div",{class:"bg-white py-10 px-8 rounded text-center shadow-xl relative md:w-auto w-[97vw]",children:a.jsx(ie,{dataList:b,columns:Z})})]})})})]})}export{Se as default};
