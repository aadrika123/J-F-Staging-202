import{_ as f,j as e,a as P}from"./index-_DxpNxuQ.js";import{d as j,h as C,L as E}from"./router-FGqGJA6w.js";import{u as q,F as R,T as v,L as D,S as M,P as T}from"./TextArea-unHzRU-d.js";import{c as I,a as x,b as A}from"./index.esm-EAT-qbPU.js";import{u as O}from"./useCustomQuery-KuDqgh29.js";import{r as V}from"./resizeImage-ZSUeJisn.js";import{u as L}from"./useErrorFocusField-pQC1FiIu.js";import"./reactQuery-FJqsWYpp.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-HRLWQzqE.js";import"./tailwind-tCHD1pCF.js";import"./reactIcons-e-z9r7Pm.js";import"./reactLazyLoadImageComponent-iRaVQCNa.js";import"./headlessui-KSSrLZ1r.js";const z=I().shape({mobile:x().required("Mobile is required").min(10).max(10)});function $({next:p,data:r,setData:i}){const{mutateAsync:l}=O({}),{sendOtp:c}=P,n=q({enableReinitialize:!0,initialValues:{mobile:r.mobileNo||""},validationSchema:z,onSubmit:async(m,{})=>{var u,s,g;try{const t=await l({api:c,data:{mobileNo:m.mobile,type:"Register"}});((u=t==null?void 0:t.data)==null?void 0:u.status)===!0?(p({...r,mobileNo:m.mobile}),f.success((s=t==null?void 0:t.data)==null?void 0:s.message)):f.error((g=t==null?void 0:t.data)==null?void 0:g.message)}catch(t){}}});return e.jsx(e.Fragment,{children:e.jsxs(R,{formik:n,children:[e.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Citizen Registration"}),e.jsx(v,{label:"Mobile",name:"mobile",type:"number",formik:n,onInput:m=>{m.target.value=Math.max(0,parseInt(m.target.value)).toString().slice(0,10)}}),e.jsx("div",{className:"text-center ",children:e.jsx(D,{type:"submit",loading:n==null?void 0:n.isSubmitting,disabled:n==null?void 0:n.isSubmitting,children:"Send OTP"})})]})})}const B=p=>{const[r,i]=j.useState(0),[l,c]=j.useState(!1);j.useEffect(()=>{let s;return l?(i(60*p),s=setInterval(()=>{i(g=>g-1)},1e3)):clearInterval(s),()=>clearInterval(s)},[l]),j.useEffect(()=>{r<0&&l&&(c(!1),i(0))},[r,l]);const n=()=>c(s=>!s),m=String(r%60).padStart(2,0);return{minutes:String(Math.floor(r/60)).padStart(2,0),seconds:m,togglerTimer:n,runTimer:l}},G=B,_=I().shape({otp:x().required("OTP is required").min(6).max(6)});function U({next:p,data:r,setData:i,prev:l}){const{mutateAsync:c}=O({}),{verifyOtp:n}=P,{minutes:m,seconds:u,togglerTimer:s,runTimer:g}=G(.1),t=q({enableReinitialize:!0,initialValues:{mobile:r.mobileNo||"",otp:r.otp||""},validationSchema:_,onSubmit:async(h,{})=>{var N,w,a;try{const o=await c({api:n,data:{mobileNo:h.mobile,otp:h.otp}});((N=o==null?void 0:o.data)==null?void 0:N.status)===!0?(p({...r,otp:h.otp}),f.success((w=o==null?void 0:o.data)==null?void 0:w.message)):f.error((a=o==null?void 0:o.data)==null?void 0:a.message)}catch(o){f.error("Invalid OTP")}}});j.useEffect(()=>(s(),()=>{s()}),[]);const F=async()=>{try{const h=await c({api:P.sendOtp,data:{mobileNo:t==null?void 0:t.values.mobile,type:"Register"}});s(),i({mobileNo:t==null?void 0:t.values.mobile,otp:""}),t.setFieldValue("otp","")}catch(h){}};return e.jsx(e.Fragment,{children:e.jsxs(R,{formik:t,children:[e.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number +91-",r==null?void 0:r.mobileNo," ",e.jsx("span",{className:"text-sm text-blue-700",onClick:()=>l({mobile:t==null?void 0:t.values.mobile,otp:""}),children:"Edit"})]}),e.jsx(v,{label:"Verify OTP",name:"otp",type:"number",formik:t,onInput:h=>{h.target.value=Math.max(0,parseInt(h.target.value)).toString().slice(0,6)}}),e.jsx("div",{className:"text-center",children:e.jsx(D,{type:"submit",loading:t==null?void 0:t.isSubmitting,disabled:t==null?void 0:t.isSubmitting,children:"Verify OTP"})}),e.jsxs("div",{className:"text-center mt-4 text-sm",children:["Didn't receive the code?"," ",g?e.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",m,":",u]}):e.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:F,children:"Resend OTP"})]})]})})}const H=I().shape({mobile:x().required("Mobile is required").min(10).max(10),name:x().required("Name is required"),email:x().required("Email is required").email("Invalid Email"),gender:x().required("Gender is required"),password:x().required("Password is required"),confirmPassword:x().required("Confirm Password is required").oneOf([A("password"),null],"Passwords must match"),dob:x().required("Date of Birth is required")});function J({next:p,prev:r,data:i,setData:l}){var N,w;const{AutoFocusErrorField:c}=L(),{register:n}=P,m=C(),u=O({}),s=q({enableReinitialize:!0,initialValues:{otp:i.otp||"",mobile:i.mobileNo||"",name:i.name||"",email:i.email||"",gender:(i==null?void 0:i.gender)||"",password:i.password||"",confirmPassword:i.confirmPassword||"",dob:i.dob||"",photo:i.photo||""},validationSchema:H,onSubmit:async a=>{var o,y,S;try{const d=new FormData;d.append("mobile",a.mobile),d.append("name",a.name),d.append("email",a.email),d.append("dob",a.dob),d.append("gender",a.gender),d.append("password",a.password),d.append("confirmPassword",a.confirmPassword),d.append("photo",a.photo);const b=await u.mutateAsync({api:n,data:d});((o=b==null?void 0:b.data)==null?void 0:o.status)===!0?(f.success((y=b==null?void 0:b.data)==null?void 0:y.message),m("/juidco-app/auth/login")):f.error((S=b==null?void 0:b.data)==null?void 0:S.message)}catch(d){f.error("Something went wrong")}}}),g=async a=>{var S,d;const o=await V(a.target.files[0]),y=new File([o],(d=(S=a==null?void 0:a.target)==null?void 0:S.files[0])==null?void 0:d.name,{type:"image/*"});s.setFieldValue("photo",y)},{isSubmitting:t,submitCount:F,errors:h}=s;return j.useEffect(()=>{c({formik:s})},[h,F,t]),e.jsx(e.Fragment,{children:e.jsxs(R,{formik:s,children:[e.jsx("h2",{className:" font-semibold mb-4",children:"Citizen Registration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(v,{label:"Name",name:"name",type:"text",formik:s})}),e.jsx("div",{children:e.jsx(v,{label:"Mobile",name:"mobile",type:"number",formik:s,onInput:a=>{a.target.value=Math.max(0,parseInt(a.target.value)).toString().slice(0,10)}})}),e.jsx("div",{className:"-mt-2",children:e.jsx(v,{label:"Email",name:"email",type:"email",formik:s})}),e.jsxs("div",{className:"-mt-2",children:[e.jsx(v,{label:"Upload Photo",accept:"image/*",name:"photo",type:"file",onChange:a=>g(a)}),e.jsx("small",{className:"text-red-500 -mt-6",children:((N=s==null?void 0:s.errors)==null?void 0:N.photo)&&((w=s==null?void 0:s.touched)==null?void 0:w.photo)})]}),e.jsx("div",{className:"-mt-2",children:e.jsx(v,{label:"Date of Birth",name:"dob",type:"date",formik:s})}),e.jsx("div",{className:"-mt-2",children:e.jsxs(M,{formik:s,name:"gender",label:"Gender",children:[e.jsx("option",{value:"",children:"Select Date"}),["Male","Female","Other"].map((a,o)=>e.jsx("option",{value:a,children:a},o))]})}),e.jsx("div",{className:"-mt-2",children:e.jsx(T,{label:"Password",name:"password",formik:s})}),e.jsx("div",{className:"-mt-2",children:e.jsx(T,{label:"confirm password",name:"confirmPassword",formik:s})})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsx(D,{type:"submit",loading:u.isLoading,disabled:u.isLoading,children:"Register Now"})})]})})}function oe(){const[p,r]=j.useState(0),[i,l]=j.useState({otp:"",mobileNo:"",name:"",email:"",password:"",dob:"",gender:"",aadhar:"",isSpeciallyAbled:0,isArmedForce:0,aadharDoc:null,photo:null}),c=(m,u=!1)=>{l({...i,...m}),!u&&r(p+1)},n=m=>{l({...i,...m}),r(p-1)};return e.jsxs("div",{children:[{0:e.jsx($,{data:i,next:c,setData:l}),1:e.jsx(U,{data:i,setData:l,next:c,prev:n}),2:e.jsx(J,{data:i,setData:l,next:c,prev:n})}[p],e.jsx("div",{className:"text-center mt-4",children:e.jsx(E,{to:"/juidco-app/auth/login",className:"text-[#5846BE]",children:"Click here to Login"})})]})}export{oe as default};
