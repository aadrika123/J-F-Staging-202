import{r as d,j as a,f as ce,V as ae,S as xe,A as E,k as I,n as me,l as ne,P as he,z as Me,c as Ee,a as Ie,u as He,B as ze,Y as De,Z as de,_ as ee,F as $e,J as w,E as te}from"./index-8642254f.js";import{c as Be}from"./index.esm-6b69a74e.js";const Pe=n=>{var b,f,L,v,V,B,M,P;const{api_assignViolation:U}=he(),[u,F]=d.useState(0),[j,p]=d.useState([]),[H,z]=d.useState(!1),[_,D]=d.useState(!1);d.useEffect(()=>{var c,h;const i=(h=(c=n==null?void 0:n.dataList)==null?void 0:c.filter(l=>(l==null?void 0:l.on_spot)==!0))==null?void 0:h.map(l=>l==null?void 0:l.id);p(i)},[n==null?void 0:n.dataList]);const Y=i=>j.some(c=>parseInt(c)==parseInt(i)),$=(i,c="")=>{var A,T;const h=i.target.name,l=i.target.value,S=i.target.checked;if(h=="violationAll")if(z(S),S){const m=(T=(A=n==null?void 0:n.dataList)==null?void 0:A.filter(g=>parseFloat(g==null?void 0:g.penalty_amount)<=parseFloat(u)))==null?void 0:T.map(g=>g==null?void 0:g.id);p(m)}else p([]);if(h=="violationSingle"){if(S)p(m=>[...m,l]);else if(!S&&H!=!0){let m=j==null?void 0:j.filter(g=>g!=l);p(m)}}},G=()=>{n==null||n.closeFun(),z(!1),F(0),n==null||n.refresh()},J=()=>{D(!0);let i={violationId:j};E.post(U,i,I()).then(c=>{var h,l;(h=c==null?void 0:c.data)!=null&&h.status?me.success("Violation Assigned Successfully !!!"):n==null||n.activateBottomErrorCard(!0,ne((l=c==null?void 0:c.data)==null?void 0:l.message)),console.log("fp violation assign response => ",c)}).catch(c=>{n==null||n.activateBottomErrorCard(!0,"Server Error! Please try again later."),console.log("error fp violation assign => ",c)}).finally(()=>{D(!1),n==null||n.refresh()})};return a.jsxs(a.Fragment,{children:[a.jsx("span",{onClick:()=>G(),className:"block p-1 bg-red-100 hover:bg-red-500 rounded-full hover:text-white cursor-pointer transition-all duration-200 absolute top-2 right-2",children:a.jsx(ce,{})}),a.jsxs("div",{className:"p-4 px-6",children:[a.jsx("h1",{className:"font-semibold text-sky-700 border-b pb-1 text-center my-4 text-xl ",children:"Penalty Amount Assignment for On-Spot Challan Generation"}),a.jsxs("div",{className:"bg-sky-50 p-4",children:[a.jsx("label",{for:"minmax-range",class:"block mb-2 font-medium text-gray-900 text-lg",children:"Select Penalty Range"}),a.jsx("input",{id:"minmax-range",type:"range",min:"0",max:n==null?void 0:n.maxAmount,onChange:i=>F(i.target.value),value:u,class:"w-full h-2 range-input bg-sky-800 rounded-lg appearance-none cursor-pointer darks:bg-gray-700"}),a.jsxs("div",{className:"w-full flex justify-between text-xs font-semibold",children:[a.jsx("span",{children:ae(0)}),a.jsx("span",{children:ae(n==null?void 0:n.maxAmount)})]})]}),a.jsxs("div",{className:"my-4 font-semibold",children:[a.jsx("span",{className:"text-sm font-normal",children:"Amount:"})," â‚¹ ",a.jsx("input",{type:"number",className:"focus:outline-none border-b border-gray-300 w-28 bg-white",name:"",value:u,onChange:i=>F(i.target.value),max:parseFloat(n==null?void 0:n.maxAmount),placeholder:"0.00",id:""})]}),!_&&Array.isArray(n==null?void 0:n.dataList)&&((f=(b=n==null?void 0:n.dataList)==null?void 0:b.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(u)))==null?void 0:f.length)>0&&a.jsx("div",{className:"px-2 animate__animated animate__fadeIn animate__faster",children:a.jsx("button",{onClick:()=>J(),className:"float-right bg-green-500 px-3 py-1 rounded-sm shadow-lg hover:shadow-xl hover:bg-green-600 hover:text-white text-white flex items-center mb-1",children:"Assign"})}),a.jsxs("div",{className:"flex flex-col h-[60vh] w-full overflow-y-auto md:overflow-x-hidden",children:[a.jsxs("div",{className:"w-full grid grid-cols-12 items-center gap-2 bg-slate-500 text-white font-semibold border border-slate-200 px-4 py-2",children:[a.jsx("div",{className:"col-span-1",children:"Section"}),a.jsx("div",{className:"col-span-10 text-center",children:"Violation Name"}),a.jsxs("div",{className:"col-span-1 flex",children:[a.jsx("span",{children:"Action"}),Array.isArray(n==null?void 0:n.dataList)&&((v=(L=n==null?void 0:n.dataList)==null?void 0:L.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(u)))==null?void 0:v.length)>0&&a.jsx("label",{class:"inline-flex items-center px-4 animate__animated animate__fadeIn animate__faster",children:a.jsx("input",{type:"checkbox",name:"violationAll",onChange:i=>$(i),class:"cursor-pointer form-checkbox h-5 w-5 text-slate-800"})})]})]}),_&&a.jsx(xe,{}),!_&&Array.isArray(n==null?void 0:n.dataList)&&((B=(V=n==null?void 0:n.dataList)==null?void 0:V.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(u)))==null?void 0:B.map((i,c)=>a.jsx(a.Fragment,{children:a.jsxs("div",{className:"w-full grid grid-cols-12 items-center gap-2 bg-slate-100 border-b hover:bg-white pb-1 p-4 animate__animated animate__fadeIn animate__faster",children:[a.jsx("div",{className:"col-span-1",children:i==null?void 0:i.violation_section}),a.jsx("div",{className:"col-span-10",children:i==null?void 0:i.violation_name}),a.jsx("div",{className:"col-span-1",children:a.jsx("label",{class:"inline-flex items-center px-4",children:a.jsx("input",{type:"checkbox",name:"violationSingle",checked:H||Y(i==null?void 0:i.id)?!0:null,value:i==null?void 0:i.id,onChange:h=>$(h,i==null?void 0:i.id),class:"cursor-pointer form-checkbox h-5 w-5 text-slate-800"})})})]},c)}))),!_&&Array.isArray(n==null?void 0:n.dataList)&&((P=(M=n==null?void 0:n.dataList)==null?void 0:M.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(u)))==null?void 0:P.length)==0&&a.jsx("div",{className:"w-full text-center text-red-400 font-semibold pb-1 p-4",children:"No Violation Available"})]})]})]})},Ue=()=>{var se,le;Me("Violation Master");const{api_violationMasterList:n,api_updateViolation:U,api_deleteViolation:u,api_addViolation:F,api_listDepartment:j,api_addDepartment:p,api_updateDepartment:H,api_deleteDepartment:z,api_listSection:_,api_addSection:D,api_updateSection:Y,api_deleteSection:$,api_getSectionList:G,api_getDepartmentList:J}=he(),b=d.useRef(),[f,L]=d.useState([]),[v,V]=d.useState(!1),[B,M]=d.useState(!1),[P,i]=d.useState(""),[c,h]=d.useState(!1),[l,S]=d.useState(""),[A,T]=d.useState(null),[m,g]=d.useState(null),[fe,ge]=d.useState([]),[ue,be]=d.useState([]),[je,Te]=d.useState([]),[pe,q]=d.useState(!1),[o,Z]=d.useState("department"),K="border border-red-300 text-red-400 mx-1 px-3 py-1 rounded-sm shadow-lg hover:shadow-xl hover:bg-red-800 hover:text-white",Q="float-right bg-[#1A4D8C] px-3 py-1 rounded-sm shadow-lg hover:shadow-xl hover:bg-[#113766] hover:text-white text-white flex items-center",ye="text-gray-800 text-sm",ie="border focus:outline-none drop-shadow-sm focus:drop-shadow-md px-4 py-1 text-gray-700 shadow-black placeholder:text-sm",Ne=e=>`px-4 py-1 text-sm bg-${e}-500 hover:bg-${e}-600 select-none rounded-sm hover:drop-shadow-md text-white`,W=e=>`border border-slate-700 ${e?"bg-slate-700 text-white":"text-slate-700 shadow-2xl shadow-slate-700"} mx-1 px-3 py-1 rounded-sm hover:bg-slate-700 hover:text-white text-sm`,C=(e,t)=>{h(e),i(t)},k=(e,t=null)=>{switch(S(e),console.log(e,":::::::::",t),e){case"add":break;case"edit":g(t),o=="department"&&x.setFieldValue("department",t==null?void 0:t.department_name),o=="section"&&(x.setFieldValue("violationSection",t==null?void 0:t.violation_section),x.setFieldValue("department",t==null?void 0:t.department_id)),o=="violation"&&(x.setFieldValue("violationName",t==null?void 0:t.violation_name),x.setFieldValue("violationSection",t==null?void 0:t.violation_section_id),x.setFieldValue("department",t==null?void 0:t.department_id),x.setFieldValue("penaltyAmount",t==null?void 0:t.penalty_amount));break;case"delete":T(t);break}b.current.showModal()},we=[{Header:"#",Cell:({row:e})=>a.jsx("div",{className:"pr-2",children:(e==null?void 0:e.index)+1})},{Header:"Department",accessor:"department_name",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.department_name)}},{Header:"Created At",accessor:"date",Cell:({cell:e})=>{var t;return te((t=e.row.original)==null?void 0:t.date)}},{Header:"Action",accessor:"id",Cell:({cell:e})=>a.jsx("div",{className:"flex flex-row flex-wrap gap-2",children:a.jsx("button",{onClick:()=>{var t,s;return k("delete",(s=(t=e==null?void 0:e.row)==null?void 0:t.original)==null?void 0:s.id)},className:K,children:"Delete"})})}],_e=[{Header:"#",Cell:({row:e})=>a.jsx("div",{className:"pr-2",children:(e==null?void 0:e.index)+1})},{Header:"Department",accessor:"department_name",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.department_name)}},{Header:"Violation Section",accessor:"violation_section",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.violation_section)}},{Header:"Created At",Cell:({cell:e})=>{var t;return te((t=e.row.original)==null?void 0:t.date)}},{Header:"Action",accessor:"id",Cell:({cell:e})=>a.jsx("div",{className:"flex flex-row flex-wrap gap-2",children:a.jsx("button",{onClick:()=>{var t,s;return k("delete",(s=(t=e==null?void 0:e.row)==null?void 0:t.original)==null?void 0:s.id)},className:K,children:"Delete"})})}],ve=[{Header:"#",Cell:({row:e})=>a.jsx("div",{className:"pr-2",children:(e==null?void 0:e.index)+1})},{Header:"Department",accessor:"department_name",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.department_name)}},{Header:"Violation Section",accessor:"violation_section",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.violation_section)}},{Header:"Violation Name",accessor:"violation_name",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.violation_name)}},{Header:"Penalty Amount",accessor:"penalty_amount",Cell:({cell:e})=>{var t;return ae((t=e.row.original)==null?void 0:t.penalty_amount)}},{Header:"On Spot",accessor:"on_spot",Cell:({cell:e})=>{var t;return a.jsx(a.Fragment,{children:(t=e.row.original)!=null&&t.on_spot?a.jsx("span",{className:"text-green-400 font-semibold",children:"Yes"}):a.jsx("span",{className:"text-red-400 font-semibold",children:"No"})})}},{Header:"Created By",accessor:"created_by",Cell:({cell:e})=>{var t;return w((t=e.row.original)==null?void 0:t.created_by)}},{Header:"Created At",accessor:"date",Cell:({cell:e})=>{var t;return te((t=e.row.original)==null?void 0:t.date)},className:" w-[7%] "},{Header:"Action",accessor:"id",Cell:({cell:e})=>a.jsx("div",{className:"flex flex-row flex-wrap gap-2",children:a.jsx("button",{onClick:()=>{var t,s;return k("delete",(s=(t=e==null?void 0:e.row)==null?void 0:t.original)==null?void 0:s.id)},className:K,children:"Delete"})})}],O=[{title:"Department",key:"department",width:`${o=="department"?" md:w-full ":o=="section"?" md:w-[45%] ":" md:w-[20%] "} w-full `,type:o=="department"?"text":"select",hint:"Enter department",required:!0,options:ue,okey:"id",ovalue:"department_name"},{title:"Violation Section",key:"violationSection",width:`${o=="section"?" md:w-[45%] ":" md:w-[20%] "} w-full ${o!="department"?"block ":"hidden "}`,type:o=="section"?"number":"select",hint:"Enter violation section",required:o!="department"&&!0,options:fe,okey:"id",ovalue:"violation_section"},{title:"Violation Name",key:"violationMade",width:`md:w-[20%] w-full ${o!="department"&&o!="section"?"block ":"hidden "}`,type:"text",hint:"Enter violation name",required:o!="department"&&o!="section"&&!0,options:je,okey:"id",ovalue:"violation_name"},{title:"Penalty Amount",key:"penaltyAmount",width:`md:w-[20%] w-full ${o=="violation"?"block ":"hidden "}`,type:"number",hint:"Enter penalty Amount",required:o=="violation"&&!0}],Se=Ee().shape([...O].reduce((e,t)=>(t!=null&&t.required&&(e[t.key]=Ie().required(t==null?void 0:t.hint)),e),{})),x=He({initialValues:{department:"",violationMade:"",violationSection:"",penaltyAmount:""},enableReinitialize:!0,validationSchema:Se,onSubmit:e=>{oe(e)}}),X=()=>{L([]),V(!0);let e;o=="department"&&(e=j),o=="section"&&(e=_),o=="violation"&&(e=n),E.post(e,{},I()).then(t=>{var s,r,y;(s=t==null?void 0:t.data)!=null&&s.status?L((r=t==null?void 0:t.data)==null?void 0:r.data):C(!0,ne((y=t==null?void 0:t.data)==null?void 0:y.message)),console.log("fp violation list response => ",t)}).catch(t=>{C(!0,"Server Error! Please try again later."),console.log("error fp violation list => ",t)}).finally(()=>{V(!1)})},Ae=(e,t="",s,r="",y="",R=!1,N=[],Le="",Ve="")=>a.jsxs("div",{className:`flex flex-col ${r} `,children:[t!=""&&a.jsxs("label",{htmlFor:e,className:ye,children:[t," ",R&&a.jsx("span",{className:"text-red-500 text-xs font-bold",children:"*"})," : "]}),s!="select"&&s!="file"&&a.jsx("input",{...x.getFieldProps(e),type:s,className:ie+` ${x.touched[e]&&x.errors[e]?" border-red-200 placeholder:text-red-400 ":" focus:border-zinc-300 border-zinc-200"}`,name:e,id:"",placeholder:y}),s=="select"&&a.jsx("select",{...x.getFieldProps(e),className:ie+` ${x.touched[e]&&x.errors[e]?" border-red-200 placeholder:text-red-400 text-red-400":" focus:border-zinc-300 border-zinc-200 "}`,children:pe?a.jsx("option",{children:"Loading..."}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:null,children:"Select"}),typeof N=="object"&&(N==null?void 0:N.map(re=>a.jsx("option",{className:"",value:re[Le],children:re[Ve]})))]})})]}),oe=e=>{M(!0),b.current.close(),console.log(l,e);let t,s;switch(l){case"add":o=="department"&&(t={departmentName:e==null?void 0:e.department},s=p),o=="section"&&(t={violationSection:e==null?void 0:e.violationSection,departmentId:e==null?void 0:e.department},s=D),o=="violation"&&(t={violationName:e==null?void 0:e.violationMade,sectionId:e==null?void 0:e.violationSection,penaltyAmount:e==null?void 0:e.penaltyAmount,departmentId:e==null?void 0:e.department},s=F);break;case"edit":o=="department"&&(t={id:m==null?void 0:m.id,departmentName:e==null?void 0:e.department},s=H),o=="section"&&(t={id:m==null?void 0:m.id,violationSection:e==null?void 0:e.violationSection,department:e==null?void 0:e.department},s=Y),o=="violation"&&(t={id:m==null?void 0:m.id,violationName:e==null?void 0:e.violationMade,violationSection:e==null?void 0:e.violationSection,penaltyAmount:e==null?void 0:e.penaltyAmount,department:e==null?void 0:e.department},s=U);break;case"delete":o=="department"&&(s=z,t={departmentId:A}),o=="section"&&(s=$,t={sectionId:A}),o=="violation"&&(s=u,t={id:A});break}E.post(s,t,I()).then(r=>{var y,R,N;(y=r==null?void 0:r.data)!=null&&y.status?(me.success((R=r==null?void 0:r.data)==null?void 0:R.message),X()):C(!0,ne((N=r==null?void 0:r.data)==null?void 0:N.message)),console.log("fp violation response => ",r)}).catch(r=>{C(!0,"Server Error! Please try again later."),console.log("error violation list => ",r)}).finally(()=>{M(!1),x.resetForm()})},Ce=()=>{q(!0),E.post(J,{},I()).then(e=>{var t,s;(t=e==null?void 0:e.data)!=null&&t.status&&be((s=e==null?void 0:e.data)==null?void 0:s.data),console.log("fp department list response => ",e)}).catch(e=>{console.log("error fp department list => ",e)}).finally(()=>{q(!1)})},ke=e=>{console.log(e),q(!0),E.post(G,{departmentId:e},I()).then(t=>{var s,r;(s=t==null?void 0:t.data)!=null&&s.status&&ge((r=t==null?void 0:t.data)==null?void 0:r.data),console.log("fp violation section list response => ",t)}).catch(t=>{console.log("error fp violation section list => ",t)}).finally(()=>{q(!1)})},Fe=e=>{const t=e.target.name,s=e.target.value;console.log(t),t=="department"&&ke(s)};return d.useEffect(()=>{o!="department"&&Ce(),X()},[o]),a.jsxs(a.Fragment,{children:[B&&a.jsx(ze,{}),c&&a.jsx(De,{activateBottomErrorCard:C,errorTitle:P}),a.jsxs("div",{className:"poppins p-4 px-6",children:[a.jsx("div",{className:"uppercase font-semibold text-gray-700 text-2xl py-2 text-center tracking-[0.7rem]",children:"Violation   Master"}),a.jsx("div",{className:"w-full h-[0.15rem] bg-gray-400 mb-6"}),a.jsxs("div",{className:"flex gap-1 w-full flex-wrap my-6",children:[a.jsx("button",{onClick:()=>Z("department"),className:W(o=="department"),children:"Department Master"}),a.jsx("button",{onClick:()=>Z("section"),className:W(o=="section"),children:"Section Master"}),a.jsx("button",{onClick:()=>Z("violation"),className:W(o=="violation"),children:"Violation Master"})]}),v&&a.jsx(xe,{}),!v&&o=="violation"&&a.jsxs("button",{onClick:()=>k("assign"),className:Q+" bg-orange-500 hover:bg-orange-600 capitalize flex gap-1 items-center ml-2",children:[a.jsx(Be,{}),"Assign On Spot Violation"]}),!v&&a.jsx(a.Fragment,{children:(f==null?void 0:f.length)>0?a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>k("add"),className:Q+"capitalize flex gap-1 items-center",children:[a.jsx(de,{})," Add ",a.jsx("span",{className:"capitalize",children:o})]}),o=="department"&&a.jsx(ee,{columns:we,dataList:f}),o=="section"&&a.jsx(ee,{columns:_e,dataList:f}),o=="violation"&&a.jsx(ee,{columns:ve,dataList:f})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex justify-end mb-2",children:a.jsxs("button",{onClick:()=>k("add"),className:Q+"capitalize flex gap-1 items-center",children:[a.jsx(de,{})," Add ",a.jsx("span",{className:"capitalize",children:o})]})}),a.jsx("div",{className:"bg-red-100 text-red-500 py-2 text-lg font-semibold text-center border border-red-500 drop-shadow-sm",children:"Oops! No Data Found."})]})})]}),a.jsxs("dialog",{ref:b,className:`relative overflow-clip animate__animated animate__zoomIn animate__faster ${l!="delete"&&o=="violation"&&" w-[90vw] md:max-w-[1080px]"}`,children:[l!="assign"&&l!="delete"&&a.jsx("span",{onClick:()=>(b.current.close(),x.resetForm()),className:"block p-1 bg-red-100 hover:bg-red-500 rounded-full hover:text-white cursor-pointer transition-all duration-200 absolute top-2 right-2",children:a.jsx(ce,{})}),l!="assign"&&l!="delete"&&a.jsxs("form",{onChange:e=>(x.handleChange(e),Fe(e)),onSubmit:x.handleSubmit,className:"p-4 px-8 py-6 shadow-lg",children:[a.jsxs("section",{className:"flex gap-4 flex-wrap",children:[a.jsxs("header",{className:"w-full font-semibold text-xl capitalize text-sky-700 border-b pb-1 text-center",children:[l," ",o]}),O==null?void 0:O.map(e=>Ae(e==null?void 0:e.key,e==null?void 0:e.title,e==null?void 0:e.type,e==null?void 0:e.width,e==null?void 0:e.hint,e==null?void 0:e.required,e==null?void 0:e.options,e==null?void 0:e.okey,e==null?void 0:e.ovalue)),((se=x.values)==null?void 0:se.violationMade)!=""&&a.jsxs("div",{className:"flex flex-wrap gap-2 text-sm w-full",children:[a.jsx("span",{className:"block w-full md:w-[15%]",children:"Violation Name :"}),(le=x.values)==null?void 0:le.violationMade,a.jsx("span",{className:"animate-ping",children:"|"})]})]}),a.jsx("footer",{className:"mt-4 flex justify-center",children:a.jsxs("button",{type:"submit",className:Ne("green"),children:[l=="add"&&"Add",l=="edit"&&"Update"]})})]}),l=="delete"&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:" z-50 px-6 py-4 flex flex-col gap-4 ",children:[a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsx("span",{className:"text-red-500 bg-red-100 p-2 block rounded-full drop-shadow-md shadow-red-300",children:a.jsx($e,{size:25})}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("span",{className:"text-xl font-semibold border-b pb-1",children:"Confirmation"}),a.jsx("span",{className:"text-base",children:"Are you sure want to delete ?"})]})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{className:"text-white bg-slate-400 hover:bg-slate-500 px-4 py-1 text-sm ",onClick:()=>b.current.close(),children:"No"}),a.jsx("button",{className:"text-white bg-red-500 hover:bg-red-600 px-4 py-1 text-sm ",onClick:()=>oe(),children:"Yes"})]})]})}),l=="assign"&&a.jsx(Pe,{closeFun:()=>b.current.close(),refresh:()=>X(),maxAmount:Math.max(...f.map(e=>parseInt(e==null?void 0:e.penalty_amount,10))),dataList:f,activateBottomErrorCard:C})]})]})};export{Ue as default};
