import{r as n,k as U,d as k,m as C,f as h,g as S,j as r,F as E,b as e,E as f}from"./index-e9aaf946.js";import{C as P}from"./ConsumerButtons-6e87a37b.js";import{h as j}from"./moment-4682f801.js";import{W as L}from"./WaterApiList-ff6a5dd8.js";const A=()=>{var m,c,g,p,u,x,b;const[t,N]=n.useState(),[y,v]=n.useState(),{id:i}=U(),{api_waterListDemand:w,api_waterGenerateDemand:R,header:d}=L(),I=()=>{f.post(w,{ConsumerId:i},d).then(s=>{N(s.data.data)}).catch(s=>{})};n.useEffect(()=>{I()},[i]);const M=s=>{const l={consumerId:i,demandUpto:s.demandUpto,finalRading:s.meterReading,meterImage:s.meterImage};f.post(R,l,d).then(o=>{o.data.status&&setRefetchData(F=>F+1)}).catch(o=>{})},D=k({meterReading:C().required("Enter Meter Reading").min(((m=t==null?void 0:t.meterDetails)==null?void 0:m.final_meter_reading)+1,`Reading must be greater previous ${(c=t==null?void 0:t.meterDetails)==null?void 0:c.final_meter_reading}`),demandUpto:h().required("Select Upto Data"),meterImage:h().required("Select Image")}),a=S({enableReinitialize:!0,initialValues:{demandUpto:"",meterReading:"",meterImage:y},onSubmit:(s,{resetForm:l})=>{l(),M(s)},validationSchema:D}),_=s=>{let l=s.target.name,o=s.target.value;l=="meterReading"&&a.setFieldValue("meterReading",allowFloatInput(o,a.values.meterReading,20)),l=="meterImage"&&v(s.currentTarget.files[0])};return r(E,{children:[e(P,{active:"meter"}),e("h1",{className:"px-1 mt-3 text-center font-semibold text-gray-700",children:" Meter/Fixed Connection Details"}),e("p",{className:"border-b border-gray-700 mx-5"}),r("div",{className:"py-6 mt-2 m-2 bg-white rounded-lg shadow-xl p-4 space-y-5",children:[r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-sm",children:(g=t==null?void 0:t.meterDetails)==null?void 0:g.connectionName}),e("div",{className:"text-gray-500 text-xs",children:"Connection Type"})]}),r("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:(p=t==null?void 0:t.meterDetails)==null?void 0:p.meter_no}),e("div",{className:"text-gray-500 text-xs",children:"Meter No."})]})]}),r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:(u=t==null?void 0:t.meterDetails)!=null&&u.final_meter_reading?(x=t==null?void 0:t.meterDetails)==null?void 0:x.final_meter_reading:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Last Meter Reading"})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[j((b=t==null?void 0:t.meterDetails)==null?void 0:b.connection_date,"YYYY-MM-DD").format("DD-MMM-yy")," "]}),e("div",{className:"text-gray-500 text-xs",children:"Meter Connection Date"})]})]})]}),e("p",{className:"border-b"}),e("div",{className:"py-2 bg-white rounded-lg shadow-xl p-4",children:r("form",{onSubmit:a.handleSubmit,onChange:_,className:"p-4 relative",children:[r("div",{className:"space-y-5 ",children:[e("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Upload Meter Image ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...a.getFieldProps("meterImage"),name:"meterImage",type:"file",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),e("span",{className:"text-red-600 absolute text-xs",children:a.touched.meterImage&&a.errors.meterImage?a.errors.meterImage:null})]})}),e("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Final Meter Reading ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...a.getFieldProps("meterReading"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),e("span",{className:"text-red-600 absolute text-xs",children:a.touched.meterReading&&a.errors.meterReading?a.errors.meterReading:null})]})}),e("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Demand Upto Date ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...a.getFieldProps("demandUpto"),type:"date",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer"}),e("span",{className:"text-red-600 absolute text-xs",children:a.touched.demandUpto&&a.errors.demandUpto?a.errors.demandUpto:null})]})})]}),e("div",{className:"flex justify-center",children:e("button",{type:"submit",className:"bg-indigo-700 px-6 py-2 text-sm text-white rounded",children:"Generate Demand"})})]})})]})};export{A as default};
