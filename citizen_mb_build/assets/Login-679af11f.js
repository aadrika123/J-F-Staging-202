import{u as et,r,g as lt,d as U,A as V,j as a,F as X,b as m,L as it,P as ot}from"./index-a5fcf8e9.js";import{u as rt}from"./formik.esm-87560db8.js";import{c as dt,b as st,a as mt}from"./index.esm-de8323ef.js";/* empty css                */import{R as ct}from"./Hourglass-42df2cfa.js";const ft=()=>{const g=et(),{notify:c,setisLoggedIn:$,setheartBeatCounter:G}=r.useContext(lt),[d,H]=r.useState(null),[i,W]=r.useState(),{api_login:Y,api_getPermission:z}=ot(),[K,w]=r.useState(!1),Q=dt({email:st().required("Enter email"),password:mt().required("Enter password")}),e=rt({initialValues:{email:"",password:""},onSubmit:l=>{at()},validationSchema:Q}),h=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA","DRIVER"],Z=r.useMemo(()=>Array.isArray(d)&&d.some(l=>h.includes(l)),[d]);r.useEffect(()=>{var l,t,s;d!=null&&(Z?(c("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((l=i==null?void 0:i.userDetails)==null?void 0:l.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((t=i==null?void 0:i.userDetails)==null?void 0:t.name)),window.localStorage.setItem("roles",JSON.stringify((s=i==null?void 0:i.userDetails)==null?void 0:s.role)),g("/dashboard")):c("You don't have permission of Tax Collector !!!","warn"))},[d]);const u=JSON.parse(window.localStorage.getItem("roles")),n=window.localStorage.getItem("token"),tt=r.useMemo(()=>Array.isArray(u)&&u.some(l=>h.includes(l)),[u,n]);r.useEffect(()=>{n!=""&&n!=null&&n!=null&&tt&&g("/dashboard")},[]);const at=()=>{let l={email:e.values.email,password:e.values.password,type:"mobile"};console.log("--1--before login send...",l),U.post(Y,l,V()).then(function(t){var s,f,x,b,S,N,I,y,E,v,L,A,R,O,D,k,C,P,T,J,F,j,p,M,_;console.log("login response => ",t),t.data.status==!0?(console.log("--2--login response...",t),window.localStorage.setItem("token",(f=(s=t==null?void 0:t.data)==null?void 0:s.data)==null?void 0:f.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(S=(b=(x=t==null?void 0:t.data)==null?void 0:x.data)==null?void 0:b.userDetails)==null?void 0:S.email),window.localStorage.setItem("userName",(y=(I=(N=t==null?void 0:t.data)==null?void 0:N.data)==null?void 0:I.userDetails)==null?void 0:y.name),window.localStorage.setItem("userType",(L=(v=(E=t==null?void 0:t.data)==null?void 0:E.data)==null?void 0:v.userDetails)==null?void 0:L.user_type),window.localStorage.setItem("userMobile",(O=(R=(A=t==null?void 0:t.data)==null?void 0:A.data)==null?void 0:R.userDetails)==null?void 0:O.mobile),window.localStorage.setItem("ulbId",(C=(k=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:k.userDetails)==null?void 0:C.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((J=(T=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:T.userDetails)==null?void 0:J.ulbName)),W((F=t==null?void 0:t.data)==null?void 0:F.data),H((M=(p=(j=t==null?void 0:t.data)==null?void 0:j.data)==null?void 0:p.userDetails)==null?void 0:M.role),G(o=>o+1),$(!0),U.post(z,{moduleId:1},V()).then(o=>{var q,B;console.log("getPermission response => ",o),o.data.status==!0&&window.localStorage.setItem("menuList",JSON.stringify((B=(q=o==null?void 0:o.data)==null?void 0:q.data)==null?void 0:B.permission))}).catch(o=>{console.log("getPermission error => ",o)})):(w(!1),c((_=t==null?void 0:t.data)==null?void 0:_.message,"error"))}).catch(function(t){w(!1),console.log("--2--login error...",t),c("Something went wrong !!! ","error")})};return a(X,{children:m("form",{onChange:e.handleChange,onSubmit:e.handleSubmit,children:[m("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:[a("label",{htmlFor:"email",className:"text-sm",children:"Email :"}),a("input",{type:"email",name:"email",id:"email",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter email"}),e.errors.email&&e.touched.email&&a("span",{className:"text-red-600 text-xs",children:e.errors.email})]}),m("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:[a("label",{htmlFor:"password",className:"text-sm",children:"Password :"}),a("input",{type:"password",name:"password",id:"password",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter password"}),e.errors.password&&e.touched.password&&a("span",{className:"text-red-600 text-xs",children:e.errors.password})]}),a("div",{className:"text-center mb-6 mt-4",children:K?a("div",{className:"flex justify-center",children:a(ct,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):m(X,{children:[a("div",{className:"mb-1",children:a(it,{to:"/forget-password",className:"text-xs text-indigo-600",children:"Forgot Password ?"})}),m("button",{type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ","Login"," "]})," "]})})]})})};export{ft as default};
