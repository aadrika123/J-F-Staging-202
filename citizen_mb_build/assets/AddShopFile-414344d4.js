import{e as oe,u as se,r as C,R as E,j as r,F as P,b as n,Q as T}from"./index-481f3b0d.js";import{u as ue}from"./formik.esm-c1310e6f.js";import{c as ae,a as R}from"./index.esm-57bb3718.js";import{T as ce}from"./ThemeStyle-994f51bc.js";import{R as v}from"./RentalApiList-f433da8b.js";import{F as pe,S as y,T as q,a as de}from"./LoadingButton-7f090c18.js";import{b as he,a as _,c as A}from"./useCustomQuery-ba715aa4.js";import{u as be}from"./useCustomGeoLocation-e46ac181.js";import{r as me}from"./resizeImage-f1558408.js";import{O as fe}from"./OverLayLoader-46b05c6a.js";import{R as ye}from"./RotatingLoader-6792a3ab.js";import"./hoist-non-react-statics.cjs-99c288db.js";import"./index.esm-125eb0db.js";import"./ApiHeader2-b363f7b8.js";import"./Hourglass-aeef106a.js";const ge=()=>{const N=a=>{const p=typeof a;return a!=null&&(p==="object"||p==="function")},u=(a,p=[])=>{const b=Object==null?void 0:Object.keys(a)[0];return N(a[b])?u(a[b],[...p,b]):[...p,b].join(".")};return{AutoFocusErrorField:({isValid:a,submitCount:p,isSubmitting:b,errors:S})=>{var F,L;if(!a&&p!==0&&b){const d=u(S);(F=window.document.getElementsByName(d))!=null&&F.length&&((L=window.document.getElementsByName(d)[0])==null||L.focus())}}}},H=[{isRequired:!0,isVisible:!0,name:"shopNo",label:"Shop no",type:"text",isDisabled:!0},{isRequired:!0,isVisible:!0,name:"circle",label:"Market",type:"select"},{isRequired:!0,isVisible:!0,name:"market",label:"Floor",type:"select"},{isRequired:!0,isVisible:!0,name:"location",label:"Location",type:"text"},{isRequired:!0,isVisible:!0,name:"building_name",label:"Building name",type:"text"},{isRequired:!0,isVisible:!0,name:"wardNo",label:"Ward no",type:"select"},{isRequired:!0,isVisible:!0,name:"allottee",label:"Allottee",type:"text",inputValidation:["removeDoubleSpace","string"]},{isRequired:!0,isVisible:!0,name:"address",label:"Address",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"rate",label:"Rate",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"arrear",label:"Arrear",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"lastPayDt",label:"Last payment date",type:"date"},{isRequired:!0,isVisible:!0,name:"lastPayAmt",label:"Last payment amount",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"allottedLength",label:"Allotted Length",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"allottedBreadth",label:"Allotted Breadth",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"allottedHeight",label:"Allotted Height",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"area",label:"Area",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"presentLength",label:"Present Length",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"presentBreadth",label:"Present Breadth",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"presentHeight",label:"Present Height",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"noOfFloors",label:"No. Of Floors",type:"text",inputValidation:["number"]},{isRequired:!0,isVisible:!0,name:"presentOccupier",label:"Present Occupier",type:"text",inputValidation:["removeDoubleSpace","string"]},{isRequired:!0,isVisible:!0,name:"tradeLicense",label:"Trade license no.",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"construction",label:"Construction",type:"select",options:N=>N.map(u=>r("option",{value:u==null?void 0:u.id,children:u==null?void 0:u.construction_type},u.id))},{isRequired:!0,isVisible:!0,name:"electricity",label:"Electricity",type:"select",options:[{value:1,label:"Yes"},{value:0,label:"No"}]},{isRequired:!1,isVisible:!1,name:"electricityNo",label:"Electricity no.",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"water",label:"Water",type:"select",options:[{value:1,label:"Yes"},{value:0,label:"No"}]},{isRequired:!1,isVisible:!1,name:"waterConsumerNo",label:"Water consumer no.",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"contactNo",label:"Contact no.",type:"text",inputValidation:["mobile","number"]},{isRequired:!0,isVisible:!0,name:"longitude",label:n("span",{children:["Longitude ",r("br",{}),r("small",{className:"text-blue-700",children:"(When you choose the photo1, it will be auto filled)"})]}),type:"text",placeholder:"Longitude"},{isRequired:!0,isVisible:!0,name:"latitude",label:n("span",{children:["Latitude ",r("br",{}),r("small",{className:"text-blue-700",children:"(When you choose the photo1, it will be auto filled)"})]}),type:"text",placeholder:"Latitude"},{isRequired:!0,isVisible:!0,name:"photo1Path",label:"Photo 1",type:"file"},{isRequired:!0,isVisible:!0,name:"photo2Path",label:"Photo 2",type:"file"},{isRequired:!0,isVisible:!0,name:"remarks",label:"Remarks",type:"textarea",inputValidation:["removeDoubleSpace"]}];function Oe(){var z,M,Y;const[N]=oe(),{AutoFocusErrorField:u}=ge(),x=N.get("id"),{titleStyle:a}=ce(),{api_UlbCircleList:p,api_locationByCircleList:b,api_addShops:S,api_getConstructionType:F}=v(),L=se(),{coords:d}=be(),[I,le]=C.useState(""),[j,re]=C.useState(""),$=he({}),k=(e,l)=>{T.dismiss(),l=="success"&&T.success(e),l=="error"&&T.error(e)},i=ue({initialValues:H.reduce((e,l)=>(e[l.name]="",e),{}),enableReinitialize:!0,onSubmit:async e=>{await ie(e)},validationSchema:ae().shape({electricityNo:R().when("electricity",{is:e=>e==1,then:()=>R().required("This field is required")}),waterConsumerNo:R().when("water",{is:e=>e==1,then:()=>R().required("This field is required")}),...H.reduce((e,l)=>(l.isRequired&&(e[l.name]=R().required("This field is required")),e),{})})}),B=_({api:p,options:{enabled:!0}});_({api:b,config:{circleId:i.values.circle},value:[i.values.circle],options:{enabled:!!i.values.circle}});const O=_({api:F,options:{enabled:!0}}),g=_({api:(z=v())==null?void 0:z.getUlbByWard,config:{},options:{enabled:!0}}),m=A({api:`${v().shopById}?id=${x}`,options:{enabled:!!x}});A({api:v().circleApi,options:{enabled:!0}}),A({api:`${(M=v())==null?void 0:M.marketApi}?location_id=${i.values.circle}`,options:{enabled:!!i.values.circle}});const w=A({api:v().assetsBuildingDropdown,options:{enabled:!0}});C.useEffect(()=>{var e;if((e=m==null?void 0:m.data)!=null&&e.data&&x){const l=m.data.data;i.setValues({...i.values,circle:l.asset_id||"",market:l.floor_id||"",floorName:(l==null?void 0:l.floorName)||"",assetName:(l==null?void 0:l.assetName)||"",wardNo:l.ward_no||"",location:l.location||"",building_name:(l==null?void 0:l.building_name)||"",ulbId:(l==null?void 0:l.ulb_id)||"",shopNo:(l==null?void 0:l.shop_no)||"",allottee:l.owner_name||"",address:l.address||"",rate:"",arrear:"",lastPayDt:"",lastPayAmt:"",allottedLength:l.length||"",allottedBreadth:l.breadth||"",allottedHeight:l.height||"",area:parseInt(l.length)*parseInt(l.breadth)||l.building_area||"",presentLength:"",presentBreadth:"",presentHeight:"",noOfFloors:l.no_of_floors||"",presentOccupier:l.name||"",tradeLicense:"",construction:"",electricity:"",electricityNo:"",water:"",waterConsumerNo:"",contactNo:"",longitude:"",latitude:"",photo1Path:"",photo2Path:"",remarks:""})}},[(Y=m==null?void 0:m.data)==null?void 0:Y.data,x]);const ie=async e=>{var f,c,V;let l,s;l=S,s={assetId:e==null?void 0:e.circle,assetName:e==null?void 0:e.assetName,floorName:e==null?void 0:e.floorName,floorId:e==null?void 0:e.market,allottee:e==null?void 0:e.allottee,ulbId:e==null?void 0:e.ulbId,wardNo:e==null?void 0:e.wardNo,marketName:e==null?void 0:e.building_name,circleName:e==null?void 0:e.location,shopNo:e==null?void 0:e.shopNo,address:e==null?void 0:e.address,rate:e==null?void 0:e.rate,arrear:e==null?void 0:e.arrear,lastPayDt:e==null?void 0:e.lastPayDt,lastPayAmt:e==null?void 0:e.lastPayAmt,allottedLength:e==null?void 0:e.allottedLength,allottedBreadth:e==null?void 0:e.allottedBreadth,allottedHeight:e==null?void 0:e.allottedHeight,area:e==null?void 0:e.area,presentLength:e==null?void 0:e.presentLength,presentBreadth:e==null?void 0:e.presentBreadth,presentHeight:e==null?void 0:e.presentHeight,noOfFloors:e==null?void 0:e.noOfFloors,presentOccupier:e==null?void 0:e.presentOccupier,tradeLicense:e==null?void 0:e.tradeLicense,construction:e==null?void 0:e.construction,electricity:e==null?void 0:e.electricity,electricityNo:e==null?void 0:e.electricityNo,water:e==null?void 0:e.water,waterConsumerNo:e==null?void 0:e.waterConsumerNo,contactNo:e==null?void 0:e.contactNo,longitude:e==null?void 0:e.longitude,latitude:e==null?void 0:e.latitude,photo1Path:e==null?void 0:e.photo1Path,photo2Path:e==null?void 0:e.photo2Path,remarks:e==null?void 0:e.remarks};try{const o=await $.mutateAsync({api:l,data:s});(f=o==null?void 0:o.data)!=null&&f.status?(k(((c=o==null?void 0:o.data)==null?void 0:c.message)||"Data saved successfully","success"),L("/shopList")):k(((V=o==null?void 0:o.data)==null?void 0:V.message)||"Data not saved","error")}catch(o){k(o||"Data not saved","error")}},te=async(e,l)=>{const s=e.target.files[0],f=await me(s),c=new File([f],s==null?void 0:s.name,{type:s==null?void 0:s.type});l==="photo1Path"?(i.setFieldValue("photo1Path",c),i.setFieldValue("latitude",d==null?void 0:d.latitude),i.setFieldValue("longitude",d==null?void 0:d.longitude),le(URL.createObjectURL(c))):(i.setFieldValue("photo2Path",c),re(URL.createObjectURL(c)))};E.useEffect(()=>{i.values.electricity==0&&i.setFieldValue("electricityNo",""),i.values.water==0&&i.setFieldValue("waterConsumerNo","")},[i.values.electricity,i.values.water]),E.useEffect(()=>{i.values.allottedLength&&i.values.allottedBreadth&&i.setFieldValue("area",parseInt(i.values.allottedLength)*parseInt(i.values.allottedBreadth))},[i.values.allottedLength,i.values.allottedBreadth]);const{submitCount:K,errors:U,isSubmitting:W,isValid:ne}=i;return E.useEffect(()=>{u({submitCount:K,isSubmitting:W,errors:U,isValid:ne})},[U,K,W]),B!=null&&B.isLoading?r(P,{children:r(ye,{})}):n(P,{children:[$.isLoading&&r(fe,{}),r("div",{className:"bg-[#eff2f0] ",children:n("div",{className:" container mx-auto p-4",children:[n("div",{className:"grid grid-cols-1 md:grid-cols-12 lg:grid-cols-12 p-4 border-b",children:[n("div",{className:"col-span-6 flex space-x-3",children:[r("img",{src:"https://cdn-icons-png.flaticon.com/128/2981/2981313.png",className:"h-10 -mt-2"}),r("h1",{className:`${a}`,children:"Add Shops"})]}),r("div",{className:"col-span-6 flex space-x-3 justify-end"})]}),r(pe,{formik:i,children:n("div",{className:"bg-[#fdfdfd]  rounded-2xl shadow-md p-2",children:[r("div",{className:"p-2",children:H.map((e,l)=>{var s,f,c,V,o,D,G,Q,J,X;if(e.name==="circle")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,selectedText:"assetName",children:[r("option",{selected:!0,children:"select"}),(f=(s=w==null?void 0:w.data)==null?void 0:s.data)==null?void 0:f.map(t=>r("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.building_name},t.id))]})},l);if(e.name==="market")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,selectedText:"floorName",children:[r("option",{selected:!0,children:"select"}),(V=(c=w==null?void 0:w.data)==null?void 0:c.data)==null?void 0:V.map(t=>{var Z,ee;if((t==null?void 0:t.id)==((Z=i==null?void 0:i.values)==null?void 0:Z.circle))return(ee=t==null?void 0:t.floor_data)==null?void 0:ee.map(h=>r("option",{value:h==null?void 0:h.id,children:h==null?void 0:h.floor},h==null?void 0:h.id))})]})},l);if(e.name==="ulbId")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),(D=(o=g==null?void 0:g.data)==null?void 0:o.data)==null?void 0:D.map(t=>r("option",{value:t==null?void 0:t.ward_name,children:t==null?void 0:t.ward_name},t.id))]})},l);if(e.name==="wardNo")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),(Q=(G=g==null?void 0:g.data)==null?void 0:G.data)==null?void 0:Q.map(t=>r("option",{value:t==null?void 0:t.ward_name,children:t==null?void 0:t.ward_name},t.id))]})},l);if(e.name==="electricity")return n(P,{children:[r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),e.options.map(t=>r("option",{value:t.value,children:t.label},t.value))]})},l),i.values.electricity==1&&r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(q,{name:"electricityNo",formik:i,label:" Electricity No"})},l)]});if(e.name==="water")return n(P,{children:[r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),e.options.map(t=>r("option",{value:t.value,children:t.label},t.value))]})},l),i.values.water==1&&r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(q,{name:"waterConsumerNo",formik:i,label:" Consumer No"})},l)]});if(e.name==="construction")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(y,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),(X=(J=O==null?void 0:O.data)==null?void 0:J.data)==null?void 0:X.map(t=>r("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.construction_type},t.id))]})},l);if(e.type==="text"&&e.isVisible)return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(q,{name:e.name,formik:i,label:e.label,inputValidation:e.inputValidation,placeholder:e.placeholder,disabled:e.name==="latitude"||e.name==="longitude"?!0:e==null?void 0:e.isDisabled})},l);if(e.type==="date")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(q,{name:e.name,formik:i,label:e.label,type:"date"})},l);if(e.type==="file")return n("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:[r(q,{name:e.name,label:e.label,type:"file",onChange:t=>te(t,e.name)}),r("p",{className:"text-red-600 text-xs",children:(i==null?void 0:i.touched[e.name])&&(i==null?void 0:i.errors[e.name])}),e.name==="photo1Path"&&I&&r("img",{src:I,className:"h-20"}),e.name==="photo2Path"&&j&&r("img",{src:j,className:"h-20"})]},l);if(e.type==="textarea")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(de,{name:e.name,formik:i,label:e.label,inputValidation:e.inputValidation})},l)})}),r("div",{className:"pb-8",children:r("button",{type:"submit",className:"bg-[#6AB783] px-7 py-2 text-white font-semibold rounded leading-5 shadow-lg w-full",children:"Save"})})]})})]})})]})}export{Oe as default};
