import{Q as g,j as t,b as p,P as N,R as P,F as k,u as V}from"./index-0e94f450.js";import{u as T}from"./formik.esm-3041fe88.js";import{c as v,a as x,f as $}from"./index.esm-53d0ef34.js";import{F as O,T as q,L as D,P as F}from"./LoadingButton-41bf7b10.js";import{u as R}from"./useCustomQuery-b7ab1a67.js";import"./ThemeStyle-994f51bc.js";import"./index.esm-7ab12b54.js";import"./ApiHeader2-b363f7b8.js";const A=v({mobile:x().required("Enter mobile number")});function j({next:h,data:e,setData:u}){const{mutateAsync:s}=R({}),{send_otp:b}=N(),m=T({enableReinitialize:!0,initialValues:{mobile:e.mobile||""},validationSchema:A,onSubmit:async(l,{})=>{var d,a,f;try{const i=await s({api:b,data:{mobile:l.mobile}});(d=i==null?void 0:i.data)!=null&&d.status?(h({...e,mobile:l.mobile}),g.success((a=i==null?void 0:i.data)==null?void 0:a.message)):g.error((f=i==null?void 0:i.data)==null?void 0:f.message)}catch(i){g.error(i==null?void 0:i.message)}}});return t("div",{className:"py-10",children:p(O,{formik:m,children:[p("div",{className:"mb-5",children:[t(q,{label:"Mobile",name:"mobile",type:"text",formik:m,placeholder:"Enter your register mobile no"})," "]}),t(D,{type:m.isSubmitting?"button":"submit",disabled:m.isSubmitting,loading:m.isSubmitting,children:"SEND OTP"})]})})}const I=h=>{const[e,u]=P.useState(0),[s,b]=P.useState(!1);P.useEffect(()=>{let a;return s?(u(60*h),a=setInterval(()=>{u(f=>f-1)},1e3)):clearInterval(a),()=>clearInterval(a)},[s]),P.useEffect(()=>{e<0&&s&&(b(!1),u(0))},[e,s]);const m=()=>b(a=>!a),l=String(e%60).padStart(2,0);return{minutes:String(Math.floor(e/60)).padStart(2,0),seconds:l,togglerTimer:m,runTimer:s}},L=I,z=v().shape({otp:x().required("OTP is required")});function M({next:h,data:e,setData:u,prev:s}){const{minutes:b,seconds:m,togglerTimer:l,runTimer:d}=L(.5),{verify_otp:a}=N(),{mutateAsync:f,isLoading:i}=R({}),r=T({enableReinitialize:!0,initialValues:{mobile:(e==null?void 0:e.mobile)||"",otp:(e==null?void 0:e.otp)||""},validationSchema:z,onSubmit:async(w,{})=>{var S,y,n,C,E;try{const o=await f({api:a,data:{mobile:w==null?void 0:w.mobile,Otp:w==null?void 0:w.otp}});(S=o==null?void 0:o.data)!=null&&S.status?(h({...e,otp:w.otp,token:(n=(y=o==null?void 0:o.data)==null?void 0:y.data)==null?void 0:n.token}),g.success((C=o==null?void 0:o.data)==null?void 0:C.message)):g.error((E=o==null?void 0:o.data)==null?void 0:E.message)}catch(o){g.error(o==null?void 0:o.message)}}});P.useEffect(()=>(l(),()=>{l()}),[]);const c=async()=>{var w,S,y;try{const n=await f({api:a,data:{mobile:e==null?void 0:e.mobile}});(w=n==null?void 0:n.data)!=null&&w.status?(g.success((S=n==null?void 0:n.data)==null?void 0:S.message),u({...e,otp:""}),r.setFieldValue("otp",""),l()):g.error((y=n==null?void 0:n.data)==null?void 0:y.message)}catch(n){g.error(n==null?void 0:n.message)}};return t("div",{className:"py-2",children:p(O,{formik:r,children:[p("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number",r==null?void 0:r.values.mobile," ",t("span",{className:"text-sm text-blue-700",onClick:()=>s({mobile:r==null?void 0:r.values.mobile,otp:""}),children:"Edit"})]}),t("div",{className:"mb-5",children:t(q,{label:"Verify OTP",name:"otp",type:"text",formik:r})}),t(D,{type:r.isSubmitting?"button":"submit",disabled:r.isSubmitting,loading:r.isSubmitting,className:"mb-5",children:"Verify OTP"}),p("div",{className:"text-center  text-sm",children:["Didn't receive the code?"," ",i?t("small",{className:"text-gray-700 text-sm",children:"Please wait..."}):t(k,{children:d?p("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",b,":",m]}):t("span",{className:"text-blue-700 cursor-pointer",onClick:c,children:"Resend OTP"})})]})]})})}const _=v().shape({newPassword:x().required("New Password is required"),confirmPassword:x().required("Confirm Password is required").oneOf([$("newPassword"),null],"Passwords must match")});function B({next:h,data:e,setData:u,prev:s}){const b=V(),{reset_password:m}=N(),{mutateAsync:l}=R({}),d=T({enableReinitialize:!0,initialValues:{newPassword:"",confirmPassword:""},validationSchema:_,onSubmit:async(a,{})=>{var f,i,r;try{const c=await l({api:m,data:{token:e==null?void 0:e.token,password:a==null?void 0:a.newPassword}});(f=c==null?void 0:c.data)!=null&&f.status?(h(a,!0),g.success((i=c==null?void 0:c.data)==null?void 0:i.message),b("/")):g.error((r=c==null?void 0:c.data)==null?void 0:r.message)}catch(c){g.error(c==null?void 0:c.message)}}});return t("div",{className:"py-10",children:p(O,{formik:d,children:[t("h1",{className:"text-lg mt-5 mb-4 font-semibold",children:"Create New Password"}),t(F,{label:"New Password",name:"newPassword",formik:d}),t(F,{label:"Confirm Password",name:"confirmPassword",formik:d}),t(D,{type:d.isSubmitting?"button":"submit",disabled:d.isSubmitting,loading:d.isSubmitting,children:"RESET PASSWORD"})]})})}function Y(){const[h,e]=P.useState(0),[u,s]=P.useState({mobile:"",otp:"",newPassword:"",confirmPassword:"",token:""}),b=(l,d=!1)=>{s({...u,...l}),!d&&e(h+1)},m=l=>{s({...u,...l}),e(h-1)};return t(k,{children:t("div",{children:{0:t(j,{next:b,data:u,setData:s}),1:t(M,{next:b,prev:m,data:u,setData:s}),2:t(B,{next:b,prev:m,data:u,setData:s})}[h]})})}export{Y as default};
