import{x as J,f as U,b as K,o as O,j as e,F as X,C as Z,y as ee,B as ae,c as se,d as re,g as v,_ as N,r,s as _,a1 as le,a2 as ne,a3 as te,t as ce,v as oe,A as de,w as ie,D as xe,z as b,a4 as he,S as me,k as ue}from"./index-0_eOYziX.js";import{P as je}from"./index-DThTelrn.js";import{T as ge,a as fe,b as E,c,d as pe,e as o}from"./table-COa44yxU.js";import{P as Ne}from"./index-u3PxukHO.js";import{S as be}from"./index-C276sS_p.js";import{S as ve}from"./Spinner-BmvVMya1.js";import{g as Se}from"./services-KQnp_8oA.js";const we=se().shape({comment:re()});function ye({currentWorkflowId:l,currentWorkflowName:n,complaintId:m}){const i=J({}),u=U(),d=K({resolver:O(we)}),j=async x=>{let g={complaintId:m,workflowId:l,userId:null,comment:x==null?void 0:x.comment};try{const t=await i.mutateAsync({api:v.transferComplaintToUlb,data:g});t.data.success?(N.success(t.data.message),u("/grievance/dashboard/complaint-workflow")):N.error(t.data.message)}catch(t){N.error(Se(t))}};return e.jsx(X,{methods:d,onSubmit:d.handleSubmit(j),children:e.jsxs("div",{className:"gap-x-2 gap-y-4 px-10 py-10",children:[e.jsxs("div",{children:[e.jsxs(Z,{className:"text-2xl font-bold",children:["Transfer Complaint to ",e.jsx("span",{className:"text-amber-600",children:n})," Workflow"]}),e.jsx(ee,{className:"mt-6 bg-background w-full rounded-md p-4 h-40 border",name:"comment",placeholder:"Comment"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ae,{isLoading:d.formState.isSubmitting,type:"submit",className:" w-full",children:"Transfer"})})]})})}function Ce(l){var y,C,k,P,T,$,W,I,A,L,F;const[n,m]=r.useState(1),[i,u]=r.useState(100),[d,j]=r.useState(""),[x,g]=r.useState(""),[t,Y]=r.useState(""),[q,D]=r.useState(!1),h=new URLSearchParams(ue().search),S=U(),f=h.get("parentId"),Q=h.get("levelSerial"),V=h.get("parentName"),w=h.get("complaintId"),z=h.get("complaintRefNo"),p=_({api:`${v.checkWfActions}/${w}`,key:"actionPermission",options:{enabled:!0}}),s=_({api:`${v.getUlbSpecificWorkFlow}?page=${n}&limit=${i}&q=${d}&parentId=${f}&levelSerial=${Q}`,key:"getAllWorkFlow",value:[n,i,f],options:{enabled:!0}});return r.useEffect(()=>{l==null||l.settitle(V)},[f]),e.jsx(e.Fragment,{children:e.jsxs(le,{children:[e.jsx(ne,{}),e.jsx(te,{className:"sm:max-w-[425px]",children:e.jsx("div",{className:"py-4",children:q&&e.jsx(ye,{currentWorkflowId:x,currentWorkflowName:t,complaintId:w,complaintRefNo:z})})}),e.jsx("main",{className:"grid items-start",children:e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(be,{search:d,setSearch:j,refetch:s.refetch,isFetching:s.isLoading})}),e.jsx("div",{})]}),e.jsxs(ce,{children:[e.jsx(oe,{className:"px-7",children:e.jsxs(de,{children:["Work Flow Role List (",(C=(y=s.data)==null?void 0:y.data)==null?void 0:C.totalDocs,")"]})}),e.jsx(ie,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ve,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsxs(E,{children:[e.jsx(c,{className:"",children:"#"}),e.jsx(c,{className:"",children:"Work Flow Name"}),e.jsx(c,{className:"",children:"Ulb Name"}),e.jsx(c,{className:"",children:"Module Name"}),e.jsx(c,{className:"",children:"Level Serial"}),e.jsx(c,{className:"",children:"Created at"}),e.jsx(c,{children:"Action"})]})}),e.jsx(pe,{children:(T=(P=(k=s==null?void 0:s.data)==null?void 0:k.data)==null?void 0:P.docs)==null?void 0:T.map((a,G)=>{var M,R,B,H;return e.jsxs(E,{children:[e.jsx(o,{children:G+1}),e.jsx(o,{children:a==null?void 0:a.workFlowName}),e.jsx(o,{children:(M=a==null?void 0:a.ulb)==null?void 0:M.ulbName}),e.jsx(o,{children:(R=a==null?void 0:a.module)==null?void 0:R.moduleName}),e.jsx(o,{children:a==null?void 0:a.levelSerial}),e.jsx(o,{children:xe(a.createdAt).format("DD-MM-YYYY")}),e.jsxs(o,{className:"space-x-2",children:[e.jsx(b,{variant:"secondary",onClick:()=>{S(`/grievance/dashboard/members-details?parentId=${a==null?void 0:a._id}`)},children:"Members"}),((H=(B=p==null?void 0:p.data)==null?void 0:B.permission)==null?void 0:H.canViewChildWorkflow)&&e.jsx(b,{variant:"secondary",className:"md:ml-5",onClick:()=>{S(`/grievance/dashboard/transfer-complaint?parentId=${a==null?void 0:a._id}&levelSerial=${(a==null?void 0:a.levelSerial)+1}&parentName=${a==null?void 0:a.workFlowName}`)},children:"View"}),e.jsx(he,{onClick:()=>{g(a==null?void 0:a._id),Y(a==null?void 0:a.workFlowName),D(!0)},asChild:!0,children:e.jsx(b,{name:"bts",type:"button",className:"mr-4",children:"Transfer"})})]})]},a._id)})})]}),e.jsx(me,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(Ne,{page:n,perPage:i,totalPage:(W=($=s==null?void 0:s.data)==null?void 0:$.data)==null?void 0:W.totalDocs,hasNextPage:(A=(I=s==null?void 0:s.data)==null?void 0:I.data)==null?void 0:A.hasNextPage,hasPrevPage:(F=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:F.hasPrevPage,setPage:m,setPerPage:u})})]})})]})]})})]})})}function Fe(){const[l,n]=r.useState("Workflow Master List");return e.jsx(je,{title:l||"Select Workflow to Transfer",subTitle:"Choose workflow from below list",children:e.jsx("div",{className:"",children:e.jsx(Ce,{settitle:n})})})}export{Fe as default};
