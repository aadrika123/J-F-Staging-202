import{r as m,a as ke,u as _e,f as Re,s as b,g as u,b as $e,o as Ee,T as Ge,U as Ce,V as Me,W as Be,j as o,F as ze,X as Pe,Y as Ue,Z as Ve,$ as qe,a0 as i,J as g,y as A,A as He,R as p,K as Oe,I as je,B as Je,c as Ke,d as c,M as Qe,k as We,_ as be}from"./index-CYZxF7_B.js";import{P as Xe}from"./index-qF0KnRQA.js";const Ye=Ke().shape({ulbId:c().required("ULB  is required"),moduleId:c(),citizenName:c(),mobileNo:c(),email:c(),complaintTypeId:c(),priorityId:c(),targetTypeId:c(),complaintTitle:c(),complaintDescription:c().required("complaint description is required"),complaintDocument:Qe().nullable(),tempNo:c(),fixedNo:c(),isTransactionIssue:c(),transactionNo:c(),extraInfo:c(),extraBasicInfo:c()});function Ze(){var _,R,$,E,G,C,M,B,z,P,U,V,q,H,O,J,K,Q,W,X,Y,Z,ee,oe,se,re,le,ne,ie,ce;const[ge,Ie]=m.useState(!1),[F,fe]=m.useState(""),[S,we]=m.useState(""),[ve,ye]=m.useState(!1),[Te,Le]=m.useState(!1),{user:n}=ke(),Ae=_e({}),D=Re(),d=new URLSearchParams(We().search).get("complaintId"),{data:s,refetch:Fe}=b({api:`${(_=u)==null?void 0:_.getComplaintDetailsById}/${d}`,key:"getApplicationDetails",options:{enabled:!!d}}),r=$e({resolver:Ee(Ye),defaultValues:{ulbId:(n==null?void 0:n.roleId)===Ge||(n==null?void 0:n.roleId)===Ce||(n==null?void 0:n.roleId)===Me||(n==null?void 0:n.roleId)===Be?"":n==null?void 0:n.userUlbId,moduleName:""}}),Se=async e=>{var h,j,t,x,I,f;try{const l=new FormData;l.append("citizenName",(e==null?void 0:e.citizenName)||""),l.append("email",(e==null?void 0:e.email)||""),l.append("mobileNo",(e==null?void 0:e.mobileNo)||""),l.append("complaintTitle",(e==null?void 0:e.complaintTitle)||""),l.append("complaintDescription",e==null?void 0:e.complaintDescription),l.append("ulbName",e==null?void 0:e.ulbName),e!=null&&e.moduleId&&l.append("moduleId",e==null?void 0:e.moduleId),l.append("ulbId",e==null?void 0:e.ulbId),l.append("imageUrl",e==null?void 0:e.complaintDocument),(e==null?void 0:e.tempNo)!==""&&(e==null?void 0:e.tempNo)!==void 0&&l.append("tempNo",e==null?void 0:e.tempNo),(e==null?void 0:e.fixedNo)!==""&&(e==null?void 0:e.fixedNo)!==void 0&&l.append("fixedNo",e==null?void 0:e.fixedNo),(e==null?void 0:e.tempNoLabel)!==""&&(e==null?void 0:e.tempNoLabel)!==void 0&&l.append("tempNoLabel",e==null?void 0:e.tempNoLabel),(e==null?void 0:e.fixedNoLabel)!==""&&(e==null?void 0:e.fixedNoLabel)!==void 0&&l.append("fixedNoLabel",e==null?void 0:e.fixedNoLabel),e!=null&&e.complaintTypeId&&l.append("complaintTypeId",e==null?void 0:e.complaintTypeId),e!=null&&e.priorityId&&l.append("priorityId",e==null?void 0:e.priorityId),e!=null&&e.targetTypeId&&l.append("targetTypeId",e==null?void 0:e.targetTypeId),l.append("isCitizen","2"),l.append("moduleName",(e==null?void 0:e.moduleName)||""),l.append("problemTypeId",(e==null?void 0:e.problemTypeId)||""),l.append("wardNo",(e==null?void 0:e.wardNo)||""),l.append("area",(e==null?void 0:e.area)||""),l.append("latitude",(e==null?void 0:e.latitude)||""),l.append("longitude",(e==null?void 0:e.longitude)||""),l.append("holdingNo",(e==null?void 0:e.holdingNo)||""),l.append("safNo",(e==null?void 0:e.safNo)||""),l.append("consumerNo",(e==null?void 0:e.consumerNo)||""),l.append("grievanceLocation",(e==null?void 0:e.grievanceLocation)||"");let w=u.createComplaintApplication;d&&(l.append("id",d),w=u.updateComplaintApplication);const a=await Ae.mutateAsync({api:w,data:l});if((h=a.data)!=null&&h.success){if(be.success((j=a==null?void 0:a.data)==null?void 0:j.message),d)return Fe(),D(`/grievance/dashboard/workflow-details?complaintId=${d}`);D(`/grievance/dashboard/management-complaint-success?complaintRefNo=${(x=(t=a==null?void 0:a.data)==null?void 0:t.data)==null?void 0:x.complaintRefNo}&complaintId=${(f=(I=a==null?void 0:a.data)==null?void 0:I.data)==null?void 0:f._id}`)}else be.error("Grievance not created successfully");r.reset({ulbId:"",moduleId:""})}catch(l){console.log(l)}};m.useEffect(()=>{var e,h,j,t,x,I,f,l,w,a,pe,ae,te,me,de,Ne,xe,ue,he;d&&s?r.reset({ulbId:((e=s==null?void 0:s.data)==null?void 0:e.ulbId)||"",moduleId:((h=s==null?void 0:s.data)==null?void 0:h.moduleId)||"",fixedNo:((j=s==null?void 0:s.data)==null?void 0:j.fixedNo)||"",tempNo:((t=s==null?void 0:s.data)==null?void 0:t.tempNo)||"",citizenName:((x=s==null?void 0:s.data)==null?void 0:x.citizenName)||"",mobileNo:((I=s==null?void 0:s.data)==null?void 0:I.mobileNo)||"",email:((f=s==null?void 0:s.data)==null?void 0:f.email)||"",complaintTypeId:((l=s==null?void 0:s.data)==null?void 0:l.complaintTypeId)||"",priorityId:((w=s==null?void 0:s.data)==null?void 0:w.priorityId)||"",targetTypeId:((a=s==null?void 0:s.data)==null?void 0:a.targetTypeId)||"",complaintTitle:((pe=s==null?void 0:s.data)==null?void 0:pe.complaintTitle)||"",complaintDescription:((ae=s==null?void 0:s.data)==null?void 0:ae.complaintDescription)||"",problemTypeId:((te=s==null?void 0:s.data)==null?void 0:te.problemTypeId)||"",wardNo:((me=s==null?void 0:s.data)==null?void 0:me.wardNo)||"",area:((de=s==null?void 0:s.data)==null?void 0:de.area)||"",holdingNo:((Ne=s==null?void 0:s.data)==null?void 0:Ne.holdingNo)||"",safNo:((xe=s==null?void 0:s.data)==null?void 0:xe.safNo)||"",consumerNo:((ue=s==null?void 0:s.data)==null?void 0:ue.consumerNo)||"",grievanceLocation:((he=s==null?void 0:s.data)==null?void 0:he.grievanceLocation)||""}):(r.reset({ulbId:""}),r.reset({moduleId:""}),r.reset({citizenName:""}),r.reset({mobileNo:""}),r.reset({email:""}),r.reset({complaintTypeId:""}),r.reset({priorityId:""}),r.reset({targetTypeId:""}),r.reset({complaintTitle:""}),r.reset({complaintDescription:""}),r.reset({problemTypeId:""}),r.reset({wardNo:""}),r.reset({area:""}),r.reset({holdingNo:""}),r.reset({safNo:""}),r.reset({consumerNo:""}),r.reset({grievanceLocation:""}))},[d,s]);const N=b({api:`${(R=u)==null?void 0:R.getAllUlbDirect}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}}),k=b({api:`${($=u)==null?void 0:$.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}}),v=b({api:`${(E=u)==null?void 0:E.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),y=b({api:`${(G=u)==null?void 0:G.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}}),T=b({api:`${(C=u)==null?void 0:C.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}}),De=b({api:`${u.getAllProblemDirect}?page=1&limit=10000`,key:"getProblemData",options:{enabled:!0,refetchOnMount:!1}}),L=[{wardNo:"1"},{wardNo:"2"},{wardNo:"3"},{wardNo:"4"},{wardNo:"5"},{wardNo:"6"},{wardNo:"7"},{wardNo:"8"},{wardNo:"9"},{wardNo:"10"},{wardNo:"11"},{wardNo:"12"},{wardNo:"13"},{wardNo:"14"},{wardNo:"15"},{wardNo:"16"},{wardNo:"17"},{wardNo:"18"},{wardNo:"19"},{wardNo:"20"},{wardNo:"21"},{wardNo:"22"},{wardNo:"23"},{wardNo:"24"},{wardNo:"25"},{wardNo:"26"},{wardNo:"27"},{wardNo:"28"},{wardNo:"29"},{wardNo:"30"},{wardNo:"31"},{wardNo:"32"},{wardNo:"33"},{wardNo:"34"},{wardNo:"35"},{wardNo:"36"},{wardNo:"37"},{wardNo:"38"},{wardNo:"39"},{wardNo:"40"},{wardNo:"41"},{wardNo:"42"},{wardNo:"43"},{wardNo:"44"},{wardNo:"45"},{wardNo:"46"},{wardNo:"47"},{wardNo:"48"},{wardNo:"49"},{wardNo:"50"}];return m.useEffect(()=>{var e,h,j;if(r.watch("moduleId")){const t=(j=(h=(e=k.data)==null?void 0:e.data)==null?void 0:h.docs)==null?void 0:j.find(x=>(x==null?void 0:x._id)===(r==null?void 0:r.watch("moduleId")));we(t==null?void 0:t.fixedNoLabel),fe(t==null?void 0:t.tempNoLabel)}},[r.watch("moduleId")]),m.useEffect(()=>{ye(r.watch("extraInfo"))},[r.watch("extraInfo")]),m.useEffect(()=>{Le(r.watch("extraBasicInfo"))},[r.watch("extraBasicInfo")]),m.useEffect(()=>{Ie(r.watch("isTransactionIssue"))},[r.watch("isTransactionIssue")]),o.jsx(ze,{methods:r,onSubmit:r.handleSubmit(Se),children:o.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 bg-background p-10",children:[o.jsxs("div",{className:`${((n==null?void 0:n.roleId)===Pe||(n==null?void 0:n.roleId)===Ue||(n==null?void 0:n.roleId)===Ve||(n==null?void 0:n.roleId)===qe)&&"hidden"}`,children:[o.jsxs(i,{htmlFor:"ulbId",children:[o.jsx("span",{className:"text-red-500",children:"*"}),"ULB"]}),o.jsx(g,{className:"bg-background cursor-pointer",name:"ulbId",data:Array.isArray((M=N==null?void 0:N.data)==null?void 0:M.data)&&((z=(B=N==null?void 0:N.data)==null?void 0:B.data)==null?void 0:z.lenght)!==0?(U=(P=N==null?void 0:N.data)==null?void 0:P.data)==null?void 0:U.map(e=>({value:e._id,label:e.ulbName})):[]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Grievance Info"}),o.jsx(A,{className:"col-span-4"}),o.jsxs("div",{className:"col-span-3",children:[o.jsxs(i,{htmlFor:"complaintDescription",children:[o.jsx("span",{className:"text-red-500",children:"*"}),"Grievance Description"]}),o.jsx(He,{className:"bg-background w-full rounded-md p-4 h-20 border",name:"complaintDescription",placeholder:"write Grievance"})]}),o.jsx("div",{className:"col-span-4"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(p,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"extraInfo",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Give More Information"})]}),o.jsx("div",{className:"col-span-4"}),ve&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(i,{children:"Grievance Location"}),o.jsx(p,{name:"grievanceLocation",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Grievance Type"}),o.jsx(g,{selectedText:"problem",className:"bg-background cursor-pointer",name:"problemTypeId",data:((H=(q=(V=De.data)==null?void 0:V.data)==null?void 0:q.docs)==null?void 0:H.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.problem})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"moduleId",children:"Module"}),o.jsx(g,{selectedText:"moduleName",className:"bg-background cursor-pointer",name:"moduleId",data:((K=(J=(O=k.data)==null?void 0:O.data)==null?void 0:J.docs)==null?void 0:K.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.moduleName})))??[]})]}),S&&o.jsxs("div",{children:[o.jsxs(i,{children:[S,o.jsx("span",{className:"text-xs opacity-80"})]}),o.jsx(p,{name:"fixedNo",placeholder:""})]}),F&&o.jsxs("div",{children:[o.jsxs(i,{children:[F,o.jsx("span",{className:"text-xs opacity-80"})]}),o.jsx(p,{name:"tempNo",placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"complaintTypeId",children:"Grievance Type"}),o.jsx(g,{className:"bg-background cursor-pointer",name:"complaintTypeId",data:((X=(W=(Q=v==null?void 0:v.data)==null?void 0:Q.data)==null?void 0:W.docs)==null?void 0:X.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"priorityId",children:"Priority"}),o.jsx(g,{className:"bg-background cursor-pointer",name:"priorityId",data:((ee=(Z=(Y=y==null?void 0:y.data)==null?void 0:Y.data)==null?void 0:Z.docs)==null?void 0:ee.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"targetTypeId",children:"Target Type"}),o.jsx(g,{className:"bg-background cursor-pointer",name:"targetTypeId",data:((re=(se=(oe=T==null?void 0:T.data)==null?void 0:oe.data)==null?void 0:se.docs)==null?void 0:re.map(e=>({value:e._id,label:e==null?void 0:e.targetType})))??[]})]}),o.jsxs("div",{className:"col-span-2 flex",children:[o.jsxs("div",{children:[o.jsxs(i,{children:["Grievance Document",o.jsx("span",{className:"text-xs opacity-80",children:"(acceptable formats are jpg, jpeg, png, pdf)"})]}),o.jsx(Oe,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"complaintDocument",placeholder:"Select document"})]}),o.jsxs("div",{className:"",children:[(((le=r.watch("complaintDocument"))==null?void 0:le.type)=="image/png"||((ne=r.watch("complaintDocument"))==null?void 0:ne.type)=="image/jpg"||((ie=r.watch("complaintDocument"))==null?void 0:ie.type)=="image/jpeg")&&o.jsx(je,{className:"w-28",src:URL.createObjectURL(r.watch("complaintDocument"))}),((ce=r.watch("complaintDocument"))==null?void 0:ce.type)=="application/pdf"&&o.jsx(je,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]})]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Basic Info"}),o.jsx(A,{className:"col-span-4"}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"citizenName",children:"Citizen Name"}),o.jsx(p,{className:"bg-background",name:"citizenName",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Mobile No."}),o.jsx(p,{name:"mobileNo",inputValidation:["mobile","number"],placeholder:""})]}),o.jsx("div",{className:"col-span-4"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(p,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"extraBasicInfo",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Give More Information"})]}),o.jsx("div",{className:"col-span-4"}),Te&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(i,{children:"Email"}),o.jsx(p,{inputValidation:["email"],name:"email",placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Ward"}),o.jsx(g,{selectedText:"ward",className:"bg-background cursor-pointer",name:"wardNo",data:(L==null?void 0:L.map(e=>({value:e==null?void 0:e.wardNo,label:e==null?void 0:e.wardNo})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Area"}),o.jsx(p,{name:"area",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Holding No."}),o.jsx(p,{name:"holdingNo",maxLength:20,placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Saf No."}),o.jsx(p,{name:"safNo",maxLength:20,placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Consumer No."}),o.jsx(p,{name:"consumerNo",maxLength:20,placeholder:""})]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Financial Info"}),o.jsx(A,{className:"col-span-4"}),o.jsxs("div",{className:"col-span-2  flex items-center space-x-2",children:[o.jsx(p,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"isTransactionIssue",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Is issue related with financial transaction"})]}),o.jsx("div",{className:"col-span-4"}),ge&&o.jsxs("div",{children:[o.jsx(i,{children:"Transaction No."}),o.jsx(p,{name:"transactionNo",placeholder:""})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("div",{className:"col-span-4",children:o.jsx(Je,{isLoading:r.formState.isSubmitting,type:"submit",className:" w-auto rounded-xl px-10 float-right",children:d?"Update":"Submit"})})]})})}function lo(){return o.jsx(Xe,{title:"Grievance Details",subTitle:"Grievance Registration Form",children:o.jsx("div",{className:"",children:o.jsx(Ze,{})})})}export{lo as default};
