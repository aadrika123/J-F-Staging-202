import{N as Se,u as Pe,r as l,b as oe,o as ie,s as H,g as b,j as e,F as he,t as ue,v as me,G as xe,w as ge,S as pe,H as je,O as Ae,x as D,c as fe,d as F,k as be,P as ye,_ as m,y as Ne,D as Re,J as $e,B as Fe,A as z,Q as Ie}from"./index-BMcvsOkR.js";import{P as We}from"./index-CEWR6hKA.js";import{T as Me,a as we,b as O,c as x,d as ke,e as g}from"./table-CPpC1vYc.js";import{g as de}from"./services-KQnp_8oA.js";import{P as ve}from"./index-BKB_jo_T.js";import{S as Ue}from"./index-C70ZP9Rc.js";import{D as qe}from"./index-DIu5uhbX.js";import{q as Ce}from"./switch-BK9z2AKW.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Se("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=fe().shape({ulbId:F().required("ulb is required"),moduleId:F().required("Module  is required"),workFlowName:F().required("workFlow Name is required"),parentId:F().notRequired(),levelSerial:F().notRequired()});function Be({open:p,setOpen:i,title:I,edit:k,setEdit:W,refetch:y}){var $,c,r,d,V,G,C,L,_,B,T;const P=Pe({}),[N,A]=l.useState(1),[n,h]=l.useState(10),[U]=l.useState("");let R=new URLSearchParams(be().search).get("parentId");const u=oe({resolver:ie(_e)}),M=async()=>{},a=H({api:`${b.getAllUser}?page=${N}&limit=${n}&q=${U}`,key:"getAllUserData",value:[N,n],options:{enabled:!0}}),q=j=>{ye("Are you sure ?","Please confirm",async()=>{var E,Y;const f=await P.mutateAsync({api:b.createWFUserMapping,data:{workflowId:R,userId:j}});(E=f.data)!=null&&E.success?(y(),m.success((Y=f==null?void 0:f.data)==null?void 0:Y.message)):m.error("workflow user not created successfully")}),i(!1)};return e.jsx(qe,{open:p,setOpen:i,title:I,setEdit:W,edit:k,isLoading:a==null?void 0:a.isFetching,children:e.jsx(he,{methods:u,onSubmit:u.handleSubmit(M),children:e.jsx("div",{className:"grid gap-x-2 gap-y-4",children:e.jsxs(ue,{children:[e.jsx(me,{className:"px-7",children:e.jsxs(xe,{children:["Workflow Member List (",(c=($=a.data)==null?void 0:$.data)==null?void 0:c.totalDocs,")"]})}),e.jsx(ge,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(pe,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(we,{children:e.jsxs(O,{children:[e.jsx(x,{className:"",children:"#"}),e.jsx(x,{className:"",children:"User Name"}),e.jsx(x,{className:"",children:"Created at"}),e.jsx(x,{children:"Action"})]})}),e.jsx(ke,{children:(V=(d=(r=a==null?void 0:a.data)==null?void 0:r.data)==null?void 0:d.docs)==null?void 0:V.map((j,f)=>e.jsxs(O,{children:[e.jsx(g,{children:f+1}),e.jsx(g,{children:j.fullName}),e.jsx(g,{children:je(j.createdAt).format("DD-MM-YYYY")}),e.jsx(g,{className:"",children:e.jsx(Ae,{className:"bg-primary ",onClick:()=>q(j._id),children:"Add Member"})})]},j._id))})]}),e.jsx(D,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ve,{page:N,perPage:n,totalPage:(C=(G=a==null?void 0:a.data)==null?void 0:G.data)==null?void 0:C.totalDocs,hasNextPage:(_=(L=a==null?void 0:a.data)==null?void 0:L.data)==null?void 0:_.hasNextPage,hasPrevPage:(T=(B=a==null?void 0:a.data)==null?void 0:B.data)==null?void 0:T.hasPrevPage,setPage:A,setPerPage:h})})]})})]})})})})}const Te=fe().shape({roleName:F().required("Role Name is required")});function Ee({open:p,setOpen:i,title:I,id:k,wrkId:W,edit:y,setEdit:P,refetch:N}){var v,R,u,M;const A=Ne({}),{data:n}=H({api:`${b.getWFUserMappingById}/${W}`,key:"getWFUserMappingById",options:{enabled:y}}),h=oe({defaultValues:{roleName:((v=n==null?void 0:n.data)==null?void 0:v._id)||""},resolver:ie(Te)}),U=async a=>{var q,$;try{const c=await A.mutateAsync({api:`${b.updateWFUserAndMemberMapping}/${k}`,data:{workflowUserMappingId:k,workflowRoleId:a==null?void 0:a.roleName}});(q=c.data)!=null&&q.success?m.success(($=c==null?void 0:c.data)==null?void 0:$.message):m.error("Member Role not updated successfully"),i(!1),P(!1),N()}catch(c){console.log(c)}};l.useEffect(()=>{var a;y?h.reset({roleName:(a=n==null?void 0:n.data)==null?void 0:a._id}):h.reset({roleName:""})},[y,n]);const Q=H({api:`${b.getAllWorkFlowRole}?page=1&limit=1000`,key:"getAllWorkFlowRole",options:{enabled:!0}});return e.jsx(Re,{open:p,setOpen:i,title:I,setEdit:P,edit:y,children:e.jsx(he,{methods:h,onSubmit:h.handleSubmit(U),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx($e,{name:"roleName",data:((M=(u=(R=Q.data)==null?void 0:R.data)==null?void 0:u.docs)==null?void 0:M.map(a=>({value:a._id,label:a.workFlowRoleName})))??[]})}),e.jsx(D,{}),e.jsx("div",{children:e.jsx(Fe,{isLoading:h.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ye(p){var C,L,_,B,T,j,f,E,Y,J,K,X,Z,ee,ae;const[i,I]=l.useState(1),[k,W]=l.useState(10),[y,P]=l.useState(""),[N,A]=l.useState(!1),[n,h]=l.useState(!1),[U,Q]=l.useState(""),[v,R]=l.useState(""),[u,M]=l.useState(!1),a=Ne({}),c=new URLSearchParams(be().search).get("parentId"),r=H({api:`${b.getAllWFUserMapping}?workflowId=${c}`,key:"getAllWFUserMapping",value:[i,k,c],options:{enabled:!0}}),d=H({api:`${b.checkGeneralActions}`,key:"generalActionPermission",options:{enabled:!0}}),V=async s=>{var S,o,w,se,re,te,le,ne,ce;try{const t=await a.mutateAsync({api:`${(S=b)==null?void 0:S.updateWFUserMappingStatus}/${s}`,data:{id:v}});(o=t==null?void 0:t.data)!=null&&o.success?(r.refetch(),((se=(w=t==null?void 0:t.data)==null?void 0:w.data)==null?void 0:se.status)==1&&m.success((re=t.data)==null?void 0:re.message),((le=(te=t==null?void 0:t.data)==null?void 0:te.data)==null?void 0:le.status)==0&&m.error((ne=t.data)==null?void 0:ne.message)):m.error((ce=t.data)==null?void 0:ce.message)}catch(t){m.error(de(t))}};l.useEffect(()=>{p==null||p.settitle()},[]);const G=s=>{ye("Are you sure ?","Please confirm",async()=>{var S;Ie.delete(`${(S=b)==null?void 0:S.deleteWFUserMapping}/${s}`).then(o=>{var w;m.success((w=o==null?void 0:o.data)==null?void 0:w.message),r.refetch()}).catch(o=>{m.error(de(o))})})};return e.jsxs("main",{className:"grid items-start",children:[N&&e.jsx(Be,{open:N,setOpen:A,title:u?"Edit Workflow Member":"Add Workflow Member",id:v,edit:u,setEdit:M,refetch:r.refetch}),e.jsx(Ee,{open:n,setOpen:h,title:u?"Edit Workflow Member Role":"Add Workflow Member Role",id:v,wrkId:U,edit:u,setEdit:M,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Ue,{search:y,setSearch:P,refetch:r.refetch,isFetching:r.isLoading})}),((L=(C=d==null?void 0:d.data)==null?void 0:C.permission)==null?void 0:L.canModifyMembers)&&e.jsx("div",{children:e.jsx(z,{className:"flex items-center gap-2",onClick:()=>A(!0),children:"Add New"})})]}),e.jsxs(ue,{children:[e.jsx(me,{className:"px-7",children:e.jsxs(xe,{children:["Workflow Member List (",(B=(_=r.data)==null?void 0:_.data)==null?void 0:B.totalDocs,")"]})}),e.jsx(ge,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(pe,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(we,{children:e.jsxs(O,{children:[e.jsx(x,{className:"",children:"#"}),e.jsx(x,{className:"",children:"Workflow Member"}),e.jsx(x,{className:"",children:"Role"}),((j=(T=d==null?void 0:d.data)==null?void 0:T.permission)==null?void 0:j.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"",children:"Created at"}),e.jsx(x,{className:"",children:"Status"}),e.jsx(x,{children:"Action"})]})]})}),e.jsx(ke,{children:(Y=(E=(f=r==null?void 0:r.data)==null?void 0:f.data)==null?void 0:E.docs)==null?void 0:Y.map((s,S)=>{var o,w;return e.jsxs(O,{children:[e.jsxs(g,{children:[S+1," "]}),e.jsx(g,{className:"font-semibold",children:s.UserName}),e.jsx(g,{children:s.workflowRoleName||"N/A"}),((w=(o=d==null?void 0:d.data)==null?void 0:o.permission)==null?void 0:w.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(g,{children:je(s.createdAt).format("DD-MM-YYYY")}),e.jsx(g,{children:e.jsxs(Ce,{checked:(s==null?void 0:s.status)==1,onChange:()=>V(s._id),className:`${s!=null&&s.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${s!=null&&s.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),e.jsxs(g,{className:"space-x-5 ",children:[e.jsx(z,{type:"button",className:"",variant:"secondary",onClick:()=>{R(s._id),Q(s==null?void 0:s.workflowRoleId),h(!0),M(!!s.workflowRoleId)},children:s.workflowRoleName?e.jsx("div",{children:" Update Member Role "}):e.jsx("div",{className:"ml-5",children:"Add Member Role"})}),e.jsx(z,{className:"bg-red-500 hover:bg-red-700  pt-2",onClick:()=>G(s._id),children:e.jsx(Le,{size:18})})]})]})]},s._id)})})]}),e.jsx(D,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ve,{page:i,perPage:k,totalPage:(K=(J=r==null?void 0:r.data)==null?void 0:J.data)==null?void 0:K.totalDocs,hasNextPage:(Z=(X=r==null?void 0:r.data)==null?void 0:X.data)==null?void 0:Z.hasNextPage,hasPrevPage:(ae=(ee=r==null?void 0:r.data)==null?void 0:ee.data)==null?void 0:ae.hasPrevPage,setPage:I,setPerPage:W})})]})})]})]})]})}function Ke(){const[p,i]=l.useState("Workflow Member List");return e.jsx(We,{title:p||"Workflow Member List",subTitle:"Manage all the work Flow List here",children:e.jsx("div",{className:"py-12",children:e.jsx(Ye,{settitle:i})})})}export{Ke as default};
