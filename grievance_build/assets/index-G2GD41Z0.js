import{u as ee,x as Z,s as F,g as b,a as ae,b as se,o as le,r as f,j as e,F as re,R as E,G as Q,P as K,Q as O,V as L,H as de,y as ne,B as ie,c as oe,d as j,J as te,_ as h,z as W,t as ce,v as ue,A as pe,w as xe,I as he,D as me,S as ge}from"./index-0_eOYziX.js";import{P as je}from"./index-DThTelrn.js";import{T as fe,a as be,b as X,c as u,d as Ne,e as p}from"./table-COa44yxU.js";import{D as ye}from"./index-DsasrNQW.js";import{g as Ie}from"./services-KQnp_8oA.js";import{P as ve}from"./index-u3PxukHO.js";import{S as Ue}from"./index-C276sS_p.js";import{S as Se}from"./Spinner-BmvVMya1.js";import{q as we}from"./switch-DCGhywId.js";const Pe=oe().shape({fullName:j().required("Full Name is required"),mobile:j().required().min(10).max(10).label("Mobile"),email:j().required("Email is required"),password:j().required("Password is required"),roleId:j().required("Role is required"),ulbId:j(),address:j(),imageUrl:te().nullable()});function Ae({open:C,setOpen:m,title:M,id:x,edit:t,setEdit:N,refetch:R}){var I,v,U,S,w,P,A;const T=ee({}),y=Z({}),{data:o,isFetching:q}=F({api:`${b.getUserById}/${x}`,key:"getUserById",options:{enabled:t}}),{user:l}=ae(),c=se({defaultValues:{fullName:"",mobile:"",email:"",password:"",roleId:"",address:""},resolver:le(Pe)}),r=async s=>{var $,D,a,g;const d=new FormData;(l==null?void 0:l.roleId)===L&&d.append("ulbId",l==null?void 0:l.userUlbId),((l==null?void 0:l.roleId)===O||(l==null?void 0:l.roleId)===K)&&(s==null?void 0:s.roleId)===L&&d.append("ulbId",s==null?void 0:s.ulbId),d.append("fullName",s.fullName),d.append("mobile",s.mobile),d.append("roleId",s.roleId),d.append("address",String(s==null?void 0:s.address)),d.append("imageUrl",s.imageUrl);try{if(t&&s){const n=await y.mutateAsync({api:`${b.updateUser}/${x}`,data:d});($=n.data)!=null&&$.success?h.success((D=n==null?void 0:n.data)==null?void 0:D.message):h.error("User not updated successfully")}else{d.append("email",s.email),d.append("password",s.password);const n=await T.mutateAsync({api:b.createUser,data:d});(a=n.data)!=null&&a.success?h.success((g=n==null?void 0:n.data)==null?void 0:g.message):h.error("User not created successfully"),c.reset({fullName:"",mobile:"",email:"",password:"",roleId:"",address:""})}m(!1),N(!1),R()}catch(n){console.log(n)}};f.useEffect(()=>{t&&o?c.reset({fullName:o.userDetails.fullName,mobile:o.userDetails.mobile,email:o.userDetails.email,password:o.userDetails.password,roleId:o.userDetails.roleId,ulbId:o.userDetails.ulbId,address:o.userDetails.address,imageUrl:o.userDetails.imageUrl}):c.reset({fullName:"",mobile:"",email:"",password:"",roleId:"",address:""})},[t,o]);const B=F({api:`${(I=b)==null?void 0:I.getAllRoleByPermission}?page=1&limit=10000`,key:"getAllRoleByPermission",options:{enabled:!0}}),k=F({api:`${b.getAllUlb}?page=1&limit=1000`,key:"getAllUlb",options:{enabled:!0}});return e.jsx(ye,{open:C,setOpen:m,title:M,setEdit:N,edit:t,isLoading:q,children:e.jsxs(re,{methods:c,onSubmit:c.handleSubmit(r),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx("div",{children:e.jsx(E,{name:"fullName",placeholder:"Enter your Full Name ",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"]})}),e.jsx("div",{children:e.jsx(E,{name:"mobile",placeholder:"Enter your Mobile no.",inputValidation:["mobile","number"]})}),e.jsx("div",{children:e.jsx(E,{name:"email",placeholder:"Enter your Email",inputValidation:["removeSpace"]})}),!t&&e.jsx("div",{children:e.jsx(E,{name:"password",placeholder:"Enter your Password"})}),e.jsx("div",{children:e.jsx(Q,{name:"roleId",data:((S=(U=(v=B.data)==null?void 0:v.data)==null?void 0:U.docs)==null?void 0:S.map(s=>({value:s._id,label:s.roleName})))??[],disabled:t})}),((l==null?void 0:l.roleId)===K||(l==null?void 0:l.roleId)===O)&&c.watch("roleId")===L&&e.jsx("div",{children:e.jsx(Q,{name:"ulbId",data:((A=(P=(w=k.data)==null?void 0:w.data)==null?void 0:P.docs)==null?void 0:A.map(s=>({value:s._id,label:s.ulbName})))??[],disabled:t})}),e.jsx("div",{children:e.jsx(de,{name:"imageUrl",placeholder:"Upload your Images"})}),e.jsx("div",{children:e.jsx(ne,{name:"address",placeholder:"Enter your Address",inputValidation:["removeDoubleSpace","UppercaseAfterSpace"]})}),e.jsx("div",{})]}),e.jsx("div",{className:"mt-5 justify-center items-center flex",children:e.jsx(ie,{isLoading:c.formState.isSubmitting,type:"submit",className:"h-11 w-full md:w-1/2 rounded-xl",children:"Submit"})})]})})}function $e(){var I,v,U,S,w,P,A,s,d,$,D;const C=Z({}),[m,M]=f.useState(1),[x,t]=f.useState(10),[N,R]=f.useState(""),[T,y]=f.useState(!1),[o,q]=f.useState(""),[l,c]=f.useState(!1),r=F({api:`${b.getAllUser}?page=${m}&limit=${x}&q=${N}`,key:"getAllUserData",value:[m,x],options:{enabled:!0}}),B=a=>{c(!0),y(!0),q(a)},k=async a=>{var g,n,_,H,V,Y,z,G,J;try{const i=await C.mutateAsync({api:`${(g=b)==null?void 0:g.updateUserStatus}/${a}`,data:{id:o}});(n=i==null?void 0:i.data)!=null&&n.success?(r.refetch(),((H=(_=i==null?void 0:i.data)==null?void 0:_.data)==null?void 0:H.status)==1&&h.success((V=i.data)==null?void 0:V.message),((z=(Y=i==null?void 0:i.data)==null?void 0:Y.data)==null?void 0:z.status)==0&&h.error((G=i.data)==null?void 0:G.message)):h.error((J=i.data)==null?void 0:J.message)}catch(i){h.error(Ie(i))}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(Ae,{open:T,setOpen:y,title:l?"Edit User":"Add User",id:o,edit:l,setEdit:c,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Ue,{search:N,setSearch:R,refetch:r.refetch,isFetching:r.isLoading})}),e.jsx("div",{children:e.jsx(W,{className:"flex items-center gap-2",onClick:()=>y(!0),children:"Add New"})})]}),e.jsxs(ce,{children:[e.jsx(ue,{className:"px-7",children:e.jsxs(pe,{children:["Users List (",(v=(I=r.data)==null?void 0:I.data)==null?void 0:v.totalDocs,")"]})}),e.jsx(xe,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(Se,{})}):e.jsxs("div",{children:[e.jsxs(fe,{className:"",children:[e.jsx(be,{children:e.jsxs(X,{children:[e.jsx(u,{className:"",children:"#"}),e.jsx(u,{className:"",children:"Images"}),e.jsx(u,{className:"",children:"Users Name"}),e.jsx(u,{className:"",children:"Mobile"}),e.jsx(u,{className:"",children:"Email"}),e.jsx(u,{className:"",children:"Role"}),e.jsx(u,{className:"",children:"ULB"}),e.jsx(u,{className:"",children:"Created at"}),e.jsx(u,{className:"",children:"Status"}),e.jsx(u,{children:"Action"})]})}),e.jsx(Ne,{children:(w=(S=(U=r==null?void 0:r.data)==null?void 0:U.data)==null?void 0:S.docs)==null?void 0:w.map((a,g)=>e.jsxs(X,{children:[e.jsx(p,{children:m*x-x+g+1}),e.jsx(p,{style:{margin:5,width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",padding:0},children:e.jsx(he,{src:a==null?void 0:a.fullImgUrl,alt:a==null?void 0:a.imageUrl,className:"h-12 w-12 rounded-full"})}),e.jsx(p,{children:a==null?void 0:a.fullName}),e.jsx(p,{children:a==null?void 0:a.mobile}),e.jsx(p,{children:a==null?void 0:a.email}),e.jsx(p,{children:a==null?void 0:a.role}),e.jsx(p,{children:a==null?void 0:a.ulb}),e.jsx(p,{children:me(a==null?void 0:a.createdAt).format("DD-MM-YYYY")}),e.jsx(p,{children:e.jsxs(we,{checked:(a==null?void 0:a.status)==1,onChange:()=>k(a==null?void 0:a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(p,{children:e.jsx(W,{className:"bg-primary",onClick:()=>B(a._id),children:"Edit"})})]},a._id))})]}),e.jsx(ge,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ve,{page:m,perPage:x,totalPage:(A=(P=r==null?void 0:r.data)==null?void 0:P.data)==null?void 0:A.totalDocs,hasNextPage:(d=(s=r==null?void 0:r.data)==null?void 0:s.data)==null?void 0:d.hasNextPage,hasPrevPage:(D=($=r==null?void 0:r.data)==null?void 0:$.data)==null?void 0:D.hasPrevPage,setPage:M,setPerPage:t})})]})})]})]})]})}function ke(){return e.jsx(je,{title:"Users List",subTitle:"Manage all the Users List here",children:e.jsx("div",{className:"",children:e.jsx($e,{})})})}export{ke as default};
