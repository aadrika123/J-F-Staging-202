import{r as b,a as ue,u as xe,f as Ne,s as h,g as x,b as be,o as he,T as ge,U as je,V as Ie,W as fe,j as s,F as ye,y as le,X as Te,Y as ve,Z as Le,$ as Ae,a0 as c,J as f,R as N,A as Fe,K as De,I as ie,B as we,c as ke,d as r,M as Ce,k as Se,_ as oe}from"./index-CofEzg_5.js";import{P as _e}from"./index-BmDnkvLo.js";const Re=ke().shape({ulbId:r().required("ULB  is required"),moduleId:r().required("Module  is required"),citizenName:r().required("citizen name is required"),mobileNo:r().required("mobile no. is required"),email:r().required("email is required"),complaintTypeId:r(),priorityId:r(),targetTypeId:r(),complaintTitle:r().required("complaint title is required"),complaintDescription:r().required("complaint description is required"),complaintDocument:Ce().nullable(),tempNo:r(),fixedNo:r(),isTransactionIssue:r(),transactionNo:r()});function qe(){var w,k,C,S,_,R,q,$,U,M,z,E,P,B,V,H,G,O,J,K,Q,W,X,Y,Z;const[ne,ce]=b.useState(!1),[L,re]=b.useState(""),[A,pe]=b.useState(""),{user:i}=ue(),te=xe({}),F=Ne(),a=new URLSearchParams(Se().search).get("complaintId"),{data:l,refetch:ae}=h({api:`${(w=x)==null?void 0:w.getComplaintDetailsById}/${a}`,key:"getApplicationDetails",options:{enabled:!!a}}),o=be({resolver:he(Re),defaultValues:{ulbId:(i==null?void 0:i.roleId)===ge||(i==null?void 0:i.roleId)===je||(i==null?void 0:i.roleId)===Ie||(i==null?void 0:i.roleId)===fe?"":i==null?void 0:i.userUlbId,moduleName:""}}),me=async e=>{var d,u,t,m,g,j;try{const n=new FormData;n.append("citizenName",e==null?void 0:e.citizenName),n.append("email",e==null?void 0:e.email),n.append("mobileNo",e==null?void 0:e.mobileNo),n.append("complaintTitle",e==null?void 0:e.complaintTitle),n.append("complaintDescription",e==null?void 0:e.complaintDescription),n.append("ulbName",e==null?void 0:e.ulbName),n.append("moduleId",e==null?void 0:e.moduleId),n.append("ulbId",e==null?void 0:e.ulbId),n.append("imageUrl",e==null?void 0:e.complaintDocument),(e==null?void 0:e.tempNo)!==""&&(e==null?void 0:e.tempNo)!==void 0&&n.append("tempNo",e==null?void 0:e.tempNo),(e==null?void 0:e.fixedNo)!==""&&(e==null?void 0:e.fixedNo)!==void 0&&n.append("fixedNo",e==null?void 0:e.fixedNo),(e==null?void 0:e.tempNoLabel)!==""&&(e==null?void 0:e.tempNoLabel)!==void 0&&n.append("tempNoLabel",e==null?void 0:e.tempNoLabel),(e==null?void 0:e.fixedNoLabel)!==""&&(e==null?void 0:e.fixedNoLabel)!==void 0&&n.append("fixedNoLabel",e==null?void 0:e.fixedNoLabel),e!=null&&e.complaintTypeId&&n.append("complaintTypeId",e==null?void 0:e.complaintTypeId),e!=null&&e.priorityId&&n.append("priorityId",e==null?void 0:e.priorityId),e!=null&&e.targetTypeId&&n.append("targetTypeId",e==null?void 0:e.targetTypeId),n.append("isCitizen","2"),n.append("moduleName",e==null?void 0:e.moduleName);let I=x.createComplaintApplication;a&&(n.append("id",a),I=x.updateComplaintApplication);const p=await te.mutateAsync({api:I,data:n});if((d=p.data)!=null&&d.success){if(oe.success((u=p==null?void 0:p.data)==null?void 0:u.message),a)return ae(),F(`/grievance/dashboard/workflow-details?complaintId=${a}`);F(`/grievance/dashboard/management-complaint-success?complaintRefNo=${(m=(t=p==null?void 0:p.data)==null?void 0:t.data)==null?void 0:m.complaintRefNo}&complaintId=${(j=(g=p==null?void 0:p.data)==null?void 0:g.data)==null?void 0:j._id}`)}else oe.error("Complaint not created successfully");o.reset({ulbId:"",moduleId:""})}catch(n){console.log(n)}};b.useEffect(()=>{var e,d,u,t,m,g,j,n,I,p,ee,se;a&&l?o.reset({ulbId:((e=l==null?void 0:l.data)==null?void 0:e.ulbId)||"",moduleId:((d=l==null?void 0:l.data)==null?void 0:d.moduleId)||"",fixedNo:((u=l==null?void 0:l.data)==null?void 0:u.fixedNo)||"",tempNo:((t=l==null?void 0:l.data)==null?void 0:t.tempNo)||"",citizenName:((m=l==null?void 0:l.data)==null?void 0:m.citizenName)||"",mobileNo:((g=l==null?void 0:l.data)==null?void 0:g.mobileNo)||"",email:((j=l==null?void 0:l.data)==null?void 0:j.email)||"",complaintTypeId:((n=l==null?void 0:l.data)==null?void 0:n.complaintTypeId)||"",priorityId:((I=l==null?void 0:l.data)==null?void 0:I.priorityId)||"",targetTypeId:((p=l==null?void 0:l.data)==null?void 0:p.targetTypeId)||"",complaintTitle:((ee=l==null?void 0:l.data)==null?void 0:ee.complaintTitle)||"",complaintDescription:((se=l==null?void 0:l.data)==null?void 0:se.complaintDescription)||""}):(o.reset({ulbId:""}),o.reset({moduleId:""}),o.reset({citizenName:""}),o.reset({mobileNo:""}),o.reset({email:""}),o.reset({complaintTypeId:""}),o.reset({priorityId:""}),o.reset({targetTypeId:""}),o.reset({complaintTitle:""}),o.reset({complaintDescription:""}))},[a,l]);const de=h({api:`${(k=x)==null?void 0:k.getAllUlb}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}}),D=h({api:`${(C=x)==null?void 0:C.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}}),y=h({api:`${(S=x)==null?void 0:S.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),T=h({api:`${(_=x)==null?void 0:_.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}}),v=h({api:`${(R=x)==null?void 0:R.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}});return b.useEffect(()=>{var e,d,u;if(o.watch("moduleId")){const t=(u=(d=(e=D.data)==null?void 0:e.data)==null?void 0:d.docs)==null?void 0:u.find(m=>(m==null?void 0:m._id)===(o==null?void 0:o.watch("moduleId")));pe(t==null?void 0:t.fixedNoLabel),re(t==null?void 0:t.tempNoLabel)}},[o.watch("moduleId")]),b.useEffect(()=>{ce(o.watch("isTransactionIssue"))},[o.watch("isTransactionIssue")]),s.jsx(ye,{methods:o,onSubmit:o.handleSubmit(me),children:s.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 bg-background p-10",children:[s.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Basic Info"}),s.jsx(le,{className:"col-span-4"}),s.jsxs("div",{className:`${((i==null?void 0:i.roleId)===Te||(i==null?void 0:i.roleId)===ve||(i==null?void 0:i.roleId)===Le||(i==null?void 0:i.roleId)===Ae)&&"hidden"}`,children:[s.jsxs(c,{htmlFor:"ulbId",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"ULB"]}),s.jsx(f,{className:"bg-background cursor-pointer",name:"ulbId",data:((U=($=(q=de.data)==null?void 0:q.data)==null?void 0:$.docs)==null?void 0:U.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.ulbName})))??[]})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"moduleId",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Module"]}),s.jsx(f,{selectedText:"moduleName",className:"bg-background cursor-pointer",name:"moduleId",data:((E=(z=(M=D.data)==null?void 0:M.data)==null?void 0:z.docs)==null?void 0:E.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.moduleName})))??[]})]}),A&&s.jsxs("div",{children:[s.jsxs(c,{children:[A,s.jsx("span",{className:"text-xs opacity-80"})]}),s.jsx(N,{name:"fixedNo",placeholder:""})]}),L&&s.jsxs("div",{children:[s.jsxs(c,{children:[L,s.jsx("span",{className:"text-xs opacity-80"})]}),s.jsx(N,{name:"tempNo",placeholder:""})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Citizen Name"]}),s.jsx(N,{className:"bg-background",name:"citizenName",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Mobile No."]}),s.jsx(N,{className:"bg-background",name:"mobileNo",inputValidation:["mobile","number"],placeholder:""})]}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Email"]}),s.jsx(N,{className:"bg-background",name:"email",inputValidation:["email"],placeholder:""})]}),s.jsxs("div",{children:[s.jsx(c,{htmlFor:"complaintTypeId",children:"Complaint Type"}),s.jsx(f,{className:"bg-background cursor-pointer",name:"complaintTypeId",data:((V=(B=(P=y==null?void 0:y.data)==null?void 0:P.data)==null?void 0:B.docs)==null?void 0:V.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),s.jsxs("div",{children:[s.jsx(c,{htmlFor:"priorityId",children:"Priority"}),s.jsx(f,{className:"bg-background cursor-pointer",name:"priorityId",data:((O=(G=(H=T==null?void 0:T.data)==null?void 0:H.data)==null?void 0:G.docs)==null?void 0:O.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),s.jsxs("div",{children:[s.jsx(c,{htmlFor:"targetTypeId",children:"Target Type"}),s.jsx(f,{className:"bg-background cursor-pointer",name:"targetTypeId",data:((Q=(K=(J=v==null?void 0:v.data)==null?void 0:J.data)==null?void 0:K.docs)==null?void 0:Q.map(e=>({value:e._id,label:e==null?void 0:e.targetType})))??[]})]}),s.jsx("div",{className:"col-span-4"}),s.jsxs("div",{className:"  flex items-center space-x-2",children:[s.jsx(N,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"isTransactionIssue",placeholder:""}),s.jsx(c,{className:"text-amber-600 opacity-80",children:"Is issue related with financial transaction"})]}),ne&&s.jsxs("div",{children:[s.jsx(c,{children:"Transaction No."}),s.jsx(N,{name:"transactionNo",placeholder:""})]}),s.jsx("div",{className:"col-span-4"}),s.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Complaint Info"}),s.jsx(le,{className:"col-span-4"}),s.jsxs("div",{children:[s.jsxs(c,{htmlFor:"complaintTitle",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Complain Title"]}),s.jsx(N,{className:"bg-background",name:"complaintTitle",placeholder:""})]}),s.jsx("div",{className:"col-span-4"}),s.jsxs("div",{className:"col-span-3",children:[s.jsxs(c,{htmlFor:"complaintDescription",children:[s.jsx("span",{className:"text-red-500",children:"*"}),"Complain Description"]}),s.jsx(Fe,{className:"bg-background w-full rounded-md p-4 h-20 border",name:"complaintDescription",placeholder:"write complaint"})]}),s.jsx("div",{className:"col-span-4"}),s.jsxs("div",{className:"col-span-1",children:[s.jsxs(c,{children:["Complaint Document",s.jsx("span",{className:"text-xs opacity-80",children:"(acceptable formats are jpg, jpeg, png, pdf)"})]}),s.jsx(De,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"complaintDocument",placeholder:"Select document"})]}),s.jsxs("div",{className:"col-span-1",children:[(((W=o.watch("complaintDocument"))==null?void 0:W.type)=="image/png"||((X=o.watch("complaintDocument"))==null?void 0:X.type)=="image/jpg"||((Y=o.watch("complaintDocument"))==null?void 0:Y.type)=="image/jpeg")&&s.jsx(ie,{className:"w-28",src:URL.createObjectURL(o.watch("complaintDocument"))}),((Z=o.watch("complaintDocument"))==null?void 0:Z.type)=="application/pdf"&&s.jsx(ie,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]}),s.jsx("div",{className:"col-span-4"}),s.jsx("div",{className:"col-span-4",children:s.jsx(we,{isLoading:o.formState.isSubmitting,type:"submit",className:" w-auto rounded-xl px-10 float-right",children:a?"Update":"Submit"})})]})})}function Ee(){return s.jsx(_e,{title:"Complaint Details",subTitle:"Complaint Registration Form",children:s.jsx("div",{className:"",children:s.jsx(qe,{})})})}export{Ee as default};
